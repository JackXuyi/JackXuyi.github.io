<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>奔跑的蜗牛</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="前端开发工程师">
<meta property="og:type" content="website">
<meta property="og:title" content="奔跑的蜗牛">
<meta property="og:url" content="http://example.com/index.html">
<meta property="og:site_name" content="奔跑的蜗牛">
<meta property="og:description" content="前端开发工程师">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="奔跑的蜗牛">
<meta property="article:tag" content="React、node、webpack">
<meta name="twitter:card" content="summary">
  
  
    <link rel="icon" href="0001.jpg#/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  
<link rel="stylesheet" href="/css/style.css">

  

<meta name="generator" content="Hexo 7.3.0"><link rel="alternate" href="/atom.xml" title="奔跑的蜗牛" type="application/atom+xml">
</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">奔跑的蜗牛</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">首页</a>
        
          <a class="main-nav-link" href="/archives">分类</a>
        
      </nav>
      <nav id="sub-nav">
        
        
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://example.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-正则" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2024/09/25/%E6%AD%A3%E5%88%99/" class="article-date">
  <time datetime="2024-09-24T18:19:52.000Z" itemprop="datePublished">2024-09-24</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2024/09/25/%E6%AD%A3%E5%88%99/">正则</a>
    </h1>
  


        <div style="color: #999; margin-top: 0.3rem" class="post-meta-item"> 共计
    888 字，约需阅读
    3.23
    分钟
</div>
      </header>
    
    
   

    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="有限状态机"><a href="#有限状态机" class="headerlink" title="有限状态机"></a>有限状态机</h2><h3 id="定义"><a href="#定义" class="headerlink" title="定义"></a>定义</h3><p>有限状态机是一个五元组 (Q, Σ ,δ, q0, F)：</p>
<ul>
<li>Q 是一个有穷集合，叫 状态集</li>
<li>Σ 是一个有穷集合，叫 字母表</li>
<li>δ : Q × Σ → Q 是 转移函数</li>
<li>q0 ∈ Q 是 起始状态.</li>
<li>F ⊆ Q 是 接受状态</li>
</ul>
<h3 id="执行流程"><a href="#执行流程" class="headerlink" title="执行流程"></a>执行流程</h3><p>从开始状态，根据不同的输入，自动进行状态转移的过程，直到进入接受状态为止</p>
<h3 id="确定有限状态自动机（DFA）"><a href="#确定有限状态自动机（DFA）" class="headerlink" title="确定有限状态自动机（DFA）"></a>确定有限状态自动机（DFA）</h3><p>DFA 的每一个状态对于字母表中的每一个符号总是恰好有一个转移箭头射出。其确定性在于，在一个状态下，输入一个符号，一定是转移到确定的状态，没有其他的可能性</p>
<h3 id="非确定有限状态自动机（NFA）"><a href="#非确定有限状态自动机（NFA）" class="headerlink" title="非确定有限状态自动机（NFA）"></a>非确定有限状态自动机（NFA）</h3><p>NFA 中每一个状态对于字母表的每一个符号（如：0&#x2F;1）可能有多个箭头射出。其不确定性在于，在一个状态下，输入一个符号，可能转移到 n 个状态，出现了多种状态转移。另外 NFA 中箭头的标号可以是 ε（空转移，即：未输入任何符号也可转移到另一个状态）</p>
<h2 id="组成部分"><a href="#组成部分" class="headerlink" title="组成部分"></a>组成部分</h2><ul>
<li>解析器：负责解析正则表达式字符串，将其转换为内部表示形式，如状态机、有向图等。</li>
<li>状态机：根据解析器生成的内部表示形式，构建一个有限状态自动机，用于在文本中搜索匹配项。</li>
<li>匹配器：利用状态机在输入文本中进行匹配，根据正则表达式的模式和规则，找到符合条件的子串。</li>
<li>捕获器：用于捕获匹配过程中产生的结果，如分组捕获、非捕获组等。</li>
<li>替换器：用于执行替换操作，根据正则表达式中的替换规则，将匹配的子串替换为新的内容。</li>
</ul>
<h2 id="执行流程-1"><a href="#执行流程-1" class="headerlink" title="执行流程"></a>执行流程</h2><p><img src="/images/regexp.png" alt="执行流程"></p>
<h2 id="代码实现思路"><a href="#代码实现思路" class="headerlink" title="代码实现思路"></a>代码实现思路</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Value</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">value</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">value</span> = value</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  equal = <span class="function">(<span class="params">char</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> char === <span class="variable language_">this</span>.<span class="property">value</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Token</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">value, meta</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">value</span> = <span class="keyword">new</span> <span class="title class_">Value</span>(value)</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">meta</span> = meta</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  matchMeta = <span class="function">(<span class="params">c</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">meta</span> &amp;&amp; <span class="variable language_">this</span>.<span class="property">value</span>.<span class="title function_">equal</span>(c)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  matchChar = <span class="function">(<span class="params">c</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> !<span class="variable language_">this</span>.<span class="property">meta</span> &amp;&amp; <span class="variable language_">this</span>.<span class="property">value</span>.<span class="title function_">equal</span>(c)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  match = <span class="function">(<span class="params">c</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="title function_">matchMeta</span>(<span class="string">&#x27;.&#x27;</span>)) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">typeof</span> c !== <span class="string">&#x27;undefined&#x27;</span></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">matchChar</span>(c)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyPattern</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">tokens, matchString</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">tokens</span> = tokens</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">matchString</span> = matchString</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  matchStar = <span class="function">(<span class="params">i, j</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> token = <span class="variable language_">this</span>.<span class="property">tokens</span>[i]</span><br><span class="line">    <span class="keyword">const</span> ch = <span class="variable language_">this</span>.<span class="property">matchString</span>[j]</span><br><span class="line">    <span class="keyword">if</span> (token &amp;&amp; token.<span class="title function_">match</span>(ch) &amp;&amp; <span class="variable language_">this</span>.<span class="title function_">matchStar</span>(i, j + <span class="number">1</span>)) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">matchStr</span>(i + <span class="number">2</span>, j)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  matchStr = <span class="function">(<span class="params">i, j</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> token = <span class="variable language_">this</span>.<span class="property">tokens</span>[i]</span><br><span class="line">    <span class="keyword">const</span> nextToken = <span class="variable language_">this</span>.<span class="property">tokens</span>[i + <span class="number">1</span>]</span><br><span class="line">    <span class="keyword">if</span> (token &amp;&amp; token.<span class="title function_">matchMeta</span>(<span class="string">&#x27;$&#x27;</span>)) &#123;</span><br><span class="line">      <span class="keyword">return</span> j &gt;= <span class="variable language_">this</span>.<span class="property">matchString</span>.<span class="property">length</span></span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (token &amp;&amp; nextToken &amp;&amp; nextToken.<span class="title function_">matchMeta</span>(<span class="string">&#x27;*&#x27;</span>)) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">matchStar</span>(i, j)</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (token &amp;&amp; token.<span class="title function_">match</span>(<span class="variable language_">this</span>.<span class="property">matchString</span>[j])) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">matchStr</span>(i + <span class="number">1</span>, j + <span class="number">1</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">match</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="title function_">matchStr</span>(<span class="number">1</span>, <span class="number">0</span>)) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyRegexp</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">regexp</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">regexp</span> = regexp</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  compile = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">tokens</span> = []</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="variable language_">this</span>.<span class="property">regexp</span>.<span class="property">length</span>; i++) &#123;</span><br><span class="line">      <span class="keyword">switch</span> (<span class="variable language_">this</span>.<span class="property">regexp</span>[i]) &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;*&#x27;</span>: &#123;</span><br><span class="line">          <span class="variable language_">this</span>.<span class="property">tokens</span>.<span class="title function_">push</span>(<span class="keyword">new</span> <span class="title class_">Token</span>(<span class="string">&#x27;*&#x27;</span>, <span class="literal">true</span>))</span><br><span class="line">          <span class="keyword">break</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;^&#x27;</span>: &#123;</span><br><span class="line">          <span class="variable language_">this</span>.<span class="property">tokens</span>.<span class="title function_">push</span>(<span class="keyword">new</span> <span class="title class_">Token</span>(<span class="string">&#x27;^&#x27;</span>, <span class="literal">true</span>))</span><br><span class="line">          <span class="keyword">break</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;$&#x27;</span>: &#123;</span><br><span class="line">          <span class="variable language_">this</span>.<span class="property">tokens</span>.<span class="title function_">push</span>(<span class="keyword">new</span> <span class="title class_">Token</span>(<span class="string">&#x27;$&#x27;</span>, <span class="literal">true</span>))</span><br><span class="line">          <span class="keyword">break</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;.&#x27;</span>: &#123;</span><br><span class="line">          <span class="variable language_">this</span>.<span class="property">tokens</span>.<span class="title function_">push</span>(<span class="keyword">new</span> <span class="title class_">Token</span>(<span class="string">&#x27;.&#x27;</span>, <span class="literal">true</span>))</span><br><span class="line">          <span class="keyword">break</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="attr">default</span>: &#123;</span><br><span class="line">          <span class="variable language_">this</span>.<span class="property">tokens</span>.<span class="title function_">push</span>(<span class="keyword">new</span> <span class="title class_">Token</span>(<span class="variable language_">this</span>.<span class="property">regexp</span>[i], <span class="literal">false</span>))</span><br><span class="line">          <span class="keyword">break</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  match = <span class="function">(<span class="params">str</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="variable language_">this</span>.<span class="property">tokens</span>) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="title function_">compile</span>()</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">MyPattern</span>(<span class="variable language_">this</span>.<span class="property">tokens</span>, str).<span class="title function_">match</span>()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><ul>
<li><a href="https://segmentfault.com/a/1190000021787021">https://segmentfault.com/a/1190000021787021</a></li>
<li><a href="https://cloud.baidu.com/article/3288942">https://cloud.baidu.com/article/3288942</a></li>
<li><a href="https://nxtech.gitbook.io/regexp/advanced/dfa-nfa">https://nxtech.gitbook.io/regexp/advanced/dfa-nfa</a></li>
<li><a href="https://github.com/lizzz0523/language/blob/master/javascript/%E5%AE%9E%E7%8E%B0%E4%B8%80%E4%B8%AA%E5%9F%BA%E4%BA%8Edfs%E7%AE%97%E6%B3%95%E7%9A%84%E7%AE%80%E5%8D%95%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F%E5%BC%95%E6%93%8E.md">实现一个基于 dfs 算法的简单正则表达式引擎</a></li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2024/09/25/%E6%AD%A3%E5%88%99/" data-id="cm1ghkbnj0051zodz0z6nfnz1" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/JavaScript/" rel="tag">JavaScript</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-AI" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2024/09/25/AI/" class="article-date">
  <time datetime="2024-09-24T18:00:44.000Z" itemprop="datePublished">2024-09-24</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2024/09/25/AI/">AI</a>
    </h1>
  


        <div style="color: #999; margin-top: 0.3rem" class="post-meta-item"> 共计
    24 字，约需阅读
    0.09
    分钟
</div>
      </header>
    
    
   

    <div class="article-entry" itemprop="articleBody">
      
        <ul>
<li>音乐生成 <a href="https://suno.com/">suno</a></li>
<li>图生代码 <a href="https://v0.dev/chat/IMgurZ6J3Ox">v0.dev</a></li>
<li>代码优化排版 <a href="https://www.reweb.so/project/9942?page=11994">reweb.so</a></li>
<li>流程编排 <a href="https://www.coze.cn/model/arena?bid=6drja1iss2g13">coze</a></li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2024/09/25/AI/" data-id="cm1ghkbma0001zodz3h7yf7hj" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/source/" rel="tag">资源</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-zustand" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2024/09/24/zustand/" class="article-date">
  <time datetime="2024-09-23T23:03:04.000Z" itemprop="datePublished">2024-09-23</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2024/09/24/zustand/">zustand</a>
    </h1>
  


        <div style="color: #999; margin-top: 0.3rem" class="post-meta-item"> 共计
    1.4k 字，约需阅读
    5.09
    分钟
</div>
      </header>
    
    
   

    <div class="article-entry" itemprop="articleBody">
      
        <p>一个精简、高效且可扩展的状态管理方案，它巧妙地运用了简化的 Flux 原则。该方案提供了一套基于 Hooks 的直观 API，既简洁易用，又避免了冗余代码和强制性的框架偏好，让开发者能够更专注于业务逻辑的实现。</p>
<h2 id="Flux-原则"><a href="#Flux-原则" class="headerlink" title="Flux 原则"></a>Flux 原则</h2><p>Flux 原则主要围绕“单向数据流”这一核心概念展开，旨在通过清晰的数据流和组件间的解耦来提高应用的可维护性和可扩展性。</p>
<h3 id="单向数据流"><a href="#单向数据流" class="headerlink" title="单向数据流"></a>单向数据流</h3><ul>
<li>定义：在 Flux 应用中，数据的变化严格遵循单一方向流动的原则，即数据只能从一个源头流出，经过一系列的处理后，最终更新到视图层进行展示。</li>
<li>作用：单向数据流有助于减少数据流向的复杂性，使得数据的变化更加可预测和易于追踪。</li>
</ul>
<h3 id="核心组成部分"><a href="#核心组成部分" class="headerlink" title="核心组成部分"></a>核心组成部分</h3><p>Flux 架构通常包括四个核心组成部分：View（视图）、Action（动作）、Dispatcher（分发器）和 Store（存储器）。</p>
<ul>
<li>View（视图）：负责渲染 UI 界面，并通过用户交互产生 Action。</li>
<li>Action（动作）：是一个包含了类型（type）和数据的对象，用于描述发生了什么。Action 是数据变化的唯一来源。</li>
<li>Dispatcher（分发器）：接收 Action，并将其分发给所有已注册的回调函数。Dispatcher 本身不存储任何数据或状态。</li>
<li>Store（存储器）：负责存储应用的状态，并根据接收到的 Action 来更新状态。Store 是应用状态的唯一来源。</li>
</ul>
<h3 id="工作流程"><a href="#工作流程" class="headerlink" title="工作流程"></a>工作流程</h3><p><img src="/images/zustand_flux.png" alt="工作流程"></p>
<ul>
<li>当用户在视图层进行交互时，会产生一个 Action。</li>
<li>Action 被发送到 Dispatcher。</li>
<li>Dispatcher 将 Action 广播给所有已注册的 Store。</li>
<li>Store 根据 Action 的类型和内容来更新自身的状态。</li>
<li>Store 更新状态后，会通知视图层进行相应的渲染。</li>
</ul>
<h3 id="优点"><a href="#优点" class="headerlink" title="优点"></a>优点</h3><ul>
<li>预测性：由于数据变化遵循严格的单向流动，因此可以更容易地预测应用的状态变化。</li>
<li>解耦：View、Action、Dispatcher 和 Store 之间相对独立，降低了组件间的耦合度。</li>
<li>可维护性：清晰的数据流和组件间的解耦使得应用更加容易维护和扩展。</li>
</ul>
<h2 id="Hooks"><a href="#Hooks" class="headerlink" title="Hooks"></a>Hooks</h2><p>内部通过 <a href="https://zh-hans.react.dev/reference/react/useSyncExternalStore#"><code>useSyncExternalStore</code></a> 实现，<code>useSyncExternalStore</code> 一个让你订阅外部 <code>store</code> 的 <code>React Hook</code></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// todoStore.js</span></span><br><span class="line"><span class="comment">// 这是一个第三方 store 的例子，</span></span><br><span class="line"><span class="comment">// 你可能需要把它与 React 集成。</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 如果你的应用完全由 React 构建，</span></span><br><span class="line"><span class="comment">// 我们推荐使用 React state 替代。</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> nextId = <span class="number">0</span></span><br><span class="line"><span class="keyword">let</span> todos = [&#123; <span class="attr">id</span>: nextId++, <span class="attr">text</span>: <span class="string">&#x27;Todo #1&#x27;</span> &#125;]</span><br><span class="line"><span class="keyword">let</span> listeners = []</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> todosStore = &#123;</span><br><span class="line">  <span class="title function_">addTodo</span>(<span class="params"></span>) &#123;</span><br><span class="line">    todos = [...todos, &#123; <span class="attr">id</span>: nextId++, <span class="attr">text</span>: <span class="string">&#x27;Todo #&#x27;</span> + nextId &#125;]</span><br><span class="line">    <span class="title function_">emitChange</span>()</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="title function_">subscribe</span>(<span class="params">listener</span>) &#123;</span><br><span class="line">    listeners = [...listeners, listener]</span><br><span class="line">    <span class="keyword">return</span> <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      listeners = listeners.<span class="title function_">filter</span>(<span class="function">(<span class="params">l</span>) =&gt;</span> l !== listener)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="title function_">getSnapshot</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> todos</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">emitChange</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> listener <span class="keyword">of</span> listeners) &#123;</span><br><span class="line">    <span class="title function_">listener</span>()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用</span></span><br><span class="line"><span class="keyword">import</span> &#123; useSyncExternalStore &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; todosStore &#125; <span class="keyword">from</span> <span class="string">&#x27;./todoStore.js&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">TodosApp</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> todos = <span class="title function_">useSyncExternalStore</span>(</span><br><span class="line">    todosStore.<span class="property">subscribe</span>,</span><br><span class="line">    todosStore.<span class="property">getSnapshot</span></span><br><span class="line">  )</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> todosStore.addTodo()&#125;&gt;Add todo<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">hr</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        &#123;todos.map((todo) =&gt; (</span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">li</span> <span class="attr">key</span>=<span class="string">&#123;todo.id&#125;</span>&gt;</span>&#123;todo.text&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        ))&#125;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/&gt;</span></span></span><br><span class="line">  )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h2><h3 id="支持能力"><a href="#支持能力" class="headerlink" title="支持能力"></a>支持能力</h3><ul>
<li>异步请求</li>
<li>组件外订阅更新</li>
<li>框架无关</li>
<li>Immer 支持</li>
<li>持久化</li>
<li>Reducer</li>
<li>devtools</li>
</ul>
<h3 id="函数式组件"><a href="#函数式组件" class="headerlink" title="函数式组件"></a>函数式组件</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; create &#125; <span class="keyword">from</span> <span class="string">&#x27;zustand&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> useBearStore = <span class="title function_">create</span>(<span class="function">(<span class="params">set</span>) =&gt;</span> (&#123;</span><br><span class="line">  <span class="attr">bears</span>: <span class="number">0</span>,</span><br><span class="line">  <span class="attr">increasePopulation</span>: <span class="function">() =&gt;</span> <span class="title function_">set</span>(<span class="function">(<span class="params">state</span>) =&gt;</span> (&#123; <span class="attr">bears</span>: state.<span class="property">bears</span> + <span class="number">1</span> &#125;)),</span><br><span class="line">  <span class="attr">removeAllBears</span>: <span class="function">() =&gt;</span> <span class="title function_">set</span>(&#123; <span class="attr">bears</span>: <span class="number">0</span> &#125;),</span><br><span class="line">&#125;))</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">BearCounter</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> bears = <span class="title function_">useBearStore</span>(<span class="function">(<span class="params">state</span>) =&gt;</span> state.<span class="property">bears</span>)</span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>&#123;bears&#125; around here ...<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="类组件"><a href="#类组件" class="headerlink" title="类组件"></a>类组件</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; create &#125; <span class="keyword">from</span> <span class="string">&#x27;zustand&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> useBearStore = <span class="title function_">create</span>(<span class="function">(<span class="params">set</span>) =&gt;</span> (&#123;</span><br><span class="line">  <span class="attr">bears</span>: <span class="number">0</span>,</span><br><span class="line">  <span class="attr">increasePopulation</span>: <span class="function">() =&gt;</span> <span class="title function_">set</span>(<span class="function">(<span class="params">state</span>) =&gt;</span> (&#123; <span class="attr">bears</span>: state.<span class="property">bears</span> + <span class="number">1</span> &#125;)),</span><br><span class="line">  <span class="attr">removeAllBears</span>: <span class="function">() =&gt;</span> <span class="title function_">set</span>(&#123; <span class="attr">bears</span>: <span class="number">0</span> &#125;),</span><br><span class="line">&#125;))</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">BearCounter</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.Component</span> &#123;</span><br><span class="line">  <span class="title function_">componentDidMount</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">unSub</span> = useBearStore.<span class="title function_">subscribe</span>(<span class="variable language_">this</span>.<span class="property">handleSubscribe</span>)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">componentWillUnmount</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">unSub</span>()</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  handleSubscribe = <span class="function">(<span class="params">store</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">setState</span>(&#123; <span class="attr">bears</span>: store.<span class="property">bears</span> &#125;)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; bears &#125; = <span class="variable language_">this</span>.<span class="property">state</span></span><br><span class="line">    <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>&#123;bears&#125; around here ...<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="实现"><a href="#实现" class="headerlink" title="实现"></a>实现</h2><h3 id="创建-store"><a href="#创建-store" class="headerlink" title="创建 store"></a>创建 store</h3><p>利用闭包构建一个 store ，通过发布订阅的方式实现更新的监听</p>
<p><img src="/images/zustand_store.png" alt="工作流程"></p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="attr">createStoreImpl</span>: <span class="title class_">CreateStoreImpl</span> = <span class="function">(<span class="params">createState</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">type</span> <span class="title class_">TState</span> = <span class="title class_">ReturnType</span>&lt;<span class="keyword">typeof</span> createState&gt;</span><br><span class="line">  <span class="keyword">type</span> <span class="title class_">Listener</span> = <span class="function">(<span class="params"><span class="attr">state</span>: <span class="title class_">TState</span>, <span class="attr">prevState</span>: <span class="title class_">TState</span></span>) =&gt;</span> <span class="built_in">void</span></span><br><span class="line">  <span class="comment">// 闭包记录 state</span></span><br><span class="line">  <span class="keyword">let</span> <span class="attr">state</span>: <span class="title class_">TState</span></span><br><span class="line">  <span class="comment">// 记录订阅的数组</span></span><br><span class="line">  <span class="keyword">const</span> <span class="attr">listeners</span>: <span class="title class_">Set</span>&lt;<span class="title class_">Listener</span>&gt; = <span class="keyword">new</span> <span class="title class_">Set</span>()</span><br><span class="line">  <span class="comment">// 更新 state ，触发事件监听，state 支持函数更新</span></span><br><span class="line">  <span class="keyword">const</span> <span class="attr">setState</span>: <span class="title class_">StoreApi</span>&lt;<span class="title class_">TState</span>&gt;[<span class="string">&#x27;setState&#x27;</span>] = <span class="function">(<span class="params">partial, replace</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> nextState =</span><br><span class="line">      <span class="keyword">typeof</span> partial === <span class="string">&#x27;function&#x27;</span></span><br><span class="line">        ? (partial <span class="title function_">as</span> (<span class="attr">state</span>: <span class="title class_">TState</span>) =&gt; <span class="title class_">TState</span>)(state)</span><br><span class="line">        : partial</span><br><span class="line">    <span class="keyword">if</span> (!<span class="title class_">Object</span>.<span class="title function_">is</span>(nextState, state)) &#123;</span><br><span class="line">      <span class="keyword">const</span> previousState = state</span><br><span class="line">      state =</span><br><span class="line">        replace ?? (<span class="keyword">typeof</span> nextState !== <span class="string">&#x27;object&#x27;</span> || nextState === <span class="literal">null</span>)</span><br><span class="line">          ? (nextState <span class="keyword">as</span> <span class="title class_">TState</span>)</span><br><span class="line">          : <span class="title class_">Object</span>.<span class="title function_">assign</span>(&#123;&#125;, state, nextState)</span><br><span class="line">      listeners.<span class="title function_">forEach</span>(<span class="function">(<span class="params">listener</span>) =&gt;</span> <span class="title function_">listener</span>(state, previousState))</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 获取 state 状态</span></span><br><span class="line">  <span class="keyword">const</span> <span class="attr">getState</span>: <span class="title class_">StoreApi</span>&lt;<span class="title class_">TState</span>&gt;[<span class="string">&#x27;getState&#x27;</span>] = <span class="function">() =&gt;</span> state</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 获取初始化状态</span></span><br><span class="line">  <span class="keyword">const</span> <span class="attr">getInitialState</span>: <span class="title class_">StoreApi</span>&lt;<span class="title class_">TState</span>&gt;[<span class="string">&#x27;getInitialState&#x27;</span>] = <span class="function">() =&gt;</span></span><br><span class="line">    initialState</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 订阅状态更新，返回移除事件监听</span></span><br><span class="line">  <span class="keyword">const</span> <span class="attr">subscribe</span>: <span class="title class_">StoreApi</span>&lt;<span class="title class_">TState</span>&gt;[<span class="string">&#x27;subscribe&#x27;</span>] = <span class="function">(<span class="params">listener</span>) =&gt;</span> &#123;</span><br><span class="line">    listeners.<span class="title function_">add</span>(listener)</span><br><span class="line">    <span class="comment">// Unsubscribe</span></span><br><span class="line">    <span class="keyword">return</span> <span class="function">() =&gt;</span> listeners.<span class="title function_">delete</span>(listener)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> api = &#123; setState, getState, getInitialState, subscribe &#125;</span><br><span class="line">  <span class="comment">// 初始化 state</span></span><br><span class="line">  <span class="keyword">const</span> initialState = (state = <span class="title function_">createState</span>(setState, getState, api))</span><br><span class="line">  <span class="keyword">return</span> api <span class="keyword">as</span> <span class="built_in">any</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="React-订阅更新"><a href="#React-订阅更新" class="headerlink" title="React 订阅更新"></a>React 订阅更新</h3><p>利用 useSyncExternalStore 订阅更新</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> useStore&lt;<span class="title class_">TState</span>, <span class="title class_">StateSlice</span>&gt;(</span><br><span class="line">  <span class="attr">api</span>: <span class="title class_">ReadonlyStoreApi</span>&lt;<span class="title class_">TState</span>&gt;,</span><br><span class="line">  <span class="attr">selector</span>: <span class="function">(<span class="params"><span class="attr">state</span>: <span class="title class_">TState</span></span>) =&gt;</span> <span class="title class_">StateSlice</span> = identity <span class="keyword">as</span> <span class="built_in">any</span></span><br><span class="line">) &#123;</span><br><span class="line">  <span class="comment">// 订阅更新，通过 selector 获取对应的数据</span></span><br><span class="line">  <span class="keyword">const</span> slice = <span class="title class_">React</span>.<span class="title function_">useSyncExternalStore</span>(</span><br><span class="line">    api.<span class="property">subscribe</span>,</span><br><span class="line">    <span class="function">() =&gt;</span> <span class="title function_">selector</span>(api.<span class="title function_">getState</span>()),</span><br><span class="line">    <span class="function">() =&gt;</span> <span class="title function_">selector</span>(api.<span class="title function_">getInitialState</span>())</span><br><span class="line">  )</span><br><span class="line">  <span class="comment">// debug 时使用，输出 store 数据</span></span><br><span class="line">  <span class="title class_">React</span>.<span class="title function_">useDebugValue</span>(slice)</span><br><span class="line">  <span class="keyword">return</span> slice</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="中间件"><a href="#中间件" class="headerlink" title="中间件"></a>中间件</h3><p>通过高阶函数的方式实现</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">reduxImpl</span> = (<span class="params">reducer, initial</span>) =&gt; <span class="function">(<span class="params">set, _get, api</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// 实现 dispatch</span></span><br><span class="line">  api.<span class="property">dispatch</span> = <span class="function">(<span class="params">action</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">set</span>(<span class="function">(<span class="params">state</span>) =&gt;</span> <span class="title function_">reducer</span>(state, action), <span class="literal">false</span>, action)</span><br><span class="line">    <span class="keyword">return</span> action</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 标识来源，目前主要用于 devtools 中</span></span><br><span class="line">  api.<span class="property">dispatchFromDevtools</span> = <span class="literal">true</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> &#123; <span class="attr">dispatch</span>: <span class="function">(<span class="params">...a</span>) =&gt;</span> api.<span class="title function_">dispatch</span>(...a), ...initial &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><ul>
<li><a href="https://juejin.cn/post/7274163003157790720">https://juejin.cn/post/7274163003157790720</a></li>
<li><a href="https://github.com/pmndrs/zustand/tree/main">https://github.com/pmndrs/zustand/tree/main</a></li>
<li><a href="https://zh-hans.react.dev/reference/react/useSyncExternalStore#">https://zh-hans.react.dev/reference/react/useSyncExternalStore#</a></li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2024/09/24/zustand/" data-id="cm1ghkbnd0047zodzaav9goys" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/other/" rel="tag">other</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-typescript自定义实现" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2024/09/22/typescript%E8%87%AA%E5%AE%9A%E4%B9%89%E5%AE%9E%E7%8E%B0/" class="article-date">
  <time datetime="2024-09-21T23:43:17.000Z" itemprop="datePublished">2024-09-21</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2024/09/22/typescript%E8%87%AA%E5%AE%9A%E4%B9%89%E5%AE%9E%E7%8E%B0/">typescript自定义实现</a>
    </h1>
  


        <div style="color: #999; margin-top: 0.3rem" class="post-meta-item"> 共计
    690 字，约需阅读
    2.51
    分钟
</div>
      </header>
    
    
   

    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h2><p>TypeScript 是微软开发推出的语言，是 JavaScript 的超集，补充了静态类型检查等功能<br>大多数情况下，TypeScript 需要编译为 JavaScript 再运行</p>
<h2 id="类型"><a href="#类型" class="headerlink" title="类型"></a>类型</h2><h3 id="模块"><a href="#模块" class="headerlink" title="模块"></a>模块</h3><p>用 import 和 export 来导入和创建模块</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// test.ts</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">test</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;hello world&#x27;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="命名空间"><a href="#命名空间" class="headerlink" title="命名空间"></a>命名空间</h3><p>用 namespace 将具有相似功能或属性的类、接口等进行分组，避免命名冲突的方式</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// test.ts</span></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">Test</span> &#123;</span><br><span class="line">  <span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">test</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;hello world&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用时</span></span><br><span class="line"><span class="comment">/// &lt;reference path=&quot;test.ts&quot; /&gt;</span></span><br><span class="line"><span class="title class_">Test</span>.<span class="title function_">test</span>()</span><br></pre></td></tr></table></figure>

<h3 id="类型守卫"><a href="#类型守卫" class="headerlink" title="类型守卫"></a>类型守卫</h3><p>运行时的类型断言</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="attr">test</span>: <span class="built_in">any</span> = <span class="string">&#x27;sss&#x27;</span></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">typeof</span> test === <span class="string">&#x27;string&#x27;</span>) &#123;</span><br><span class="line">  <span class="comment">// string 类型时</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Interface"><a href="#Interface" class="headerlink" title="Interface"></a>Interface</h3><p>接口定义，可以用来定义接口、函数和数组</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 函数</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">Fun</span> &#123;</span><br><span class="line">  (<span class="attr">a</span>: <span class="built_in">number</span>): <span class="built_in">void</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 数组</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">Arr</span> &#123;</span><br><span class="line">  [<span class="attr">index</span>: <span class="built_in">number</span>]: <span class="built_in">string</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="装饰器"><a href="#装饰器" class="headerlink" title="装饰器"></a>装饰器</h3><p>装饰器是一种特殊类型的声明，可以附加到类、方法、访问符、属性或参数上，以修改其行为。在 TypeScript 中，装饰器提供了一种在声明时定义如何处理类的方法、属性或参数的机制。</p>
<ul>
<li>类装饰器</li>
</ul>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> classDecorater&lt;T <span class="keyword">extends</span> &#123; <span class="title function_">new</span> (...<span class="attr">args</span>: <span class="built_in">any</span>): &#123;&#125; &#125;&gt;(<span class="attr">constructor</span>: T) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">class</span> <span class="title class_">extends</span> constructor &#123;</span><br><span class="line">    <span class="keyword">public</span> test = <span class="string">&#x27;xxxx&#x27;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@classDecorater</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Test</span> &#123;</span><br><span class="line">  <span class="keyword">public</span> aaa = <span class="string">&#x27;aaa&#x27;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>方法或属性装饰器</li>
</ul>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">propDecorater</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">function</span> (<span class="params"><span class="attr">obj</span>: <span class="built_in">any</span>, <span class="attr">key</span>: <span class="built_in">string</span>, <span class="attr">config</span>: <span class="title class_">PropertyDescriptor</span></span>) &#123;</span><br><span class="line">    <span class="comment">// 装饰器逻辑</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;obj&#x27;</span>, obj, <span class="string">&#x27;key&#x27;</span>, key, <span class="string">&#x27;config&#x27;</span>, config)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Test</span> &#123;</span><br><span class="line">  <span class="meta">@propDecorater</span>()</span><br><span class="line">  <span class="attr">aaa</span>: <span class="built_in">string</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="内置类型实现"><a href="#内置类型实现" class="headerlink" title="内置类型实现"></a>内置类型实现</h2><ul>
<li>Exclude</li>
</ul>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> <span class="title class_">MyExclude</span>&lt;T, K&gt; = T <span class="keyword">extends</span> K ? <span class="built_in">never</span> : T</span><br></pre></td></tr></table></figure>

<ul>
<li>Include</li>
</ul>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> <span class="title class_">MyInclude</span>&lt;T, K&gt; = T <span class="keyword">extends</span> K ? T : <span class="built_in">never</span></span><br></pre></td></tr></table></figure>

<ul>
<li>Omit</li>
</ul>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> <span class="title class_">MyOmit</span>&lt;T <span class="keyword">extends</span> <span class="title class_">Object</span>, K&gt; = <span class="title class_">Pick</span>&lt;T, <span class="title class_">Exclude</span>&lt;keyof T, K&gt;&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li>Partial</li>
</ul>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> <span class="title class_">MyPartial</span>&lt;T <span class="keyword">extends</span> <span class="title class_">Object</span>&gt; = &#123; [K <span class="keyword">in</span> keyof T]?: T[K] &#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>Pick</li>
</ul>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> <span class="title class_">MyPick</span>&lt;T <span class="keyword">extends</span> <span class="title class_">Object</span>, K&gt; = &#123;</span><br><span class="line">  [M <span class="keyword">in</span> <span class="title class_">MyInclude</span>&lt;keyof T, K&gt;]: T[M]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>Required</li>
</ul>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> <span class="title class_">MyRequired</span>&lt;T&gt; = &#123; [K <span class="keyword">in</span> keyof T]-?: T[K] &#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>Parameters</li>
</ul>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> <span class="title class_">MyParameters</span>&lt;T <span class="title function_">extends</span> (<span class="attr">arg</span>: <span class="built_in">any</span>) =&gt; <span class="built_in">any</span>&gt; = T <span class="title function_">extends</span> (<span class="attr">arg</span>: infer K) =&gt; <span class="built_in">any</span></span><br><span class="line">  ? K</span><br><span class="line">  : <span class="built_in">never</span></span><br></pre></td></tr></table></figure>

<ul>
<li>ConstructorParameters</li>
</ul>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> <span class="title class_">MyConstructorParameters</span>&lt;T <span class="keyword">extends</span> <span class="keyword">abstract</span> <span class="title function_">new</span>(<span class="attr">arg</span>: <span class="built_in">any</span>): <span class="built_in">any</span> &gt; = T <span class="keyword">extends</span> <span class="keyword">abstract</span> <span class="title function_">new</span>(<span class="attr">arg</span>: infer K): <span class="built_in">any</span> ? K : <span class="built_in">never</span></span><br></pre></td></tr></table></figure>

<ul>
<li>ReturnType</li>
</ul>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> <span class="title class_">MyReturnType</span>&lt;T <span class="title function_">extends</span> (<span class="attr">arg</span>: <span class="built_in">any</span>) =&gt; <span class="built_in">any</span>&gt; = T <span class="title function_">extends</span> (<span class="attr">arg</span>: <span class="built_in">any</span>) =&gt; infer K</span><br><span class="line">  ? K</span><br><span class="line">  : <span class="built_in">never</span></span><br></pre></td></tr></table></figure>

<h2 id="场景"><a href="#场景" class="headerlink" title="场景"></a>场景</h2><ul>
<li>提取对象中的值类型</li>
</ul>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> getPropType&lt;T, K <span class="keyword">extends</span> keyof T&gt;(<span class="attr">obj</span>: T, <span class="attr">key</span>: K) &#123;</span><br><span class="line">  <span class="keyword">return</span> obj[key]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>非空校验</li>
</ul>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> <span class="title class_">NotNull</span>&lt;T&gt; = T <span class="keyword">extends</span> <span class="literal">null</span> | <span class="literal">undefined</span> ? <span class="built_in">never</span> : T</span><br></pre></td></tr></table></figure>

<ul>
<li>模版字符串</li>
</ul>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> call&lt;T <span class="keyword">extends</span> <span class="string">`aaa_<span class="subst">$&#123;<span class="built_in">string</span>&#125;</span>`</span>&gt;(<span class="attr">a</span>: T) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;aa&#x27;</span>, a)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">call</span>(<span class="string">&#x27;xxx&#x27;</span>) <span class="comment">// Argument of type &#x27;&quot;xxx&quot;&#x27; is not assignable to parameter of type &#x27;`aaa_$&#123;string&#125;`&#x27;.</span></span><br></pre></td></tr></table></figure>

<ul>
<li>Infer</li>
</ul>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> test&lt;T <span class="keyword">extends</span> <span class="built_in">number</span>&gt; = <span class="string">`<span class="subst">$&#123;T&#125;</span>`</span> <span class="keyword">extends</span> <span class="string">`-<span class="subst">$&#123;infer M&#125;</span>`</span> ? <span class="built_in">never</span> : T</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> testCall&lt;T <span class="keyword">extends</span> <span class="built_in">number</span>&gt;(<span class="attr">a</span>: test&lt;T&gt;) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;testCall&#x27;</span>, a)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">testCall</span>(-<span class="number">1</span>) <span class="comment">// Argument of type &#x27;number&#x27; is not assignable to parameter of type &#x27;never&#x27;.</span></span><br></pre></td></tr></table></figure>

<p>参考</p>
<ul>
<li><a href="https://juejin.cn/post/7321542773076082699">https://juejin.cn/post/7321542773076082699</a></li>
<li><a href="https://www.typescriptlang.org/play/">https://www.typescriptlang.org/play/</a></li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2024/09/22/typescript%E8%87%AA%E5%AE%9A%E4%B9%89%E5%AE%9E%E7%8E%B0/" data-id="cm1ghkbnb0040zodz0ydr77fv" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/TypeScript/" rel="tag">TypeScript</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-业务-大牌试用" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2024/09/21/%E4%B8%9A%E5%8A%A1-%E5%A4%A7%E7%89%8C%E8%AF%95%E7%94%A8/" class="article-date">
  <time datetime="2024-09-20T21:43:43.000Z" itemprop="datePublished">2024-09-20</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2024/09/21/%E4%B8%9A%E5%8A%A1-%E5%A4%A7%E7%89%8C%E8%AF%95%E7%94%A8/">业务-大牌试用</a>
    </h1>
  


        <div style="color: #999; margin-top: 0.3rem" class="post-meta-item"> 共计
    546 字，约需阅读
    1.99
    分钟
</div>
      </header>
    
    
   

    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="商品"><a href="#商品" class="headerlink" title="商品"></a>商品</h2><h3 id="生命周期"><a href="#生命周期" class="headerlink" title="生命周期"></a>生命周期</h3><p><img src="/images/product_life.png" alt="商品生命周期"></p>
<h3 id="小样"><a href="#小样" class="headerlink" title="小样"></a>小样</h3><p><img src="/images/product_trial.png" alt="小样商品"></p>
<h2 id="频道定位"><a href="#频道定位" class="headerlink" title="频道定位"></a>频道定位</h2><p>试用频道是一个商城内派样的主阵地，通过派发小样商品引导商家投入更多资源，促进正装商品的销售</p>
<h2 id="价值"><a href="#价值" class="headerlink" title="价值"></a>价值</h2><h3 id="用户"><a href="#用户" class="headerlink" title="用户"></a>用户</h3><p>能够在频道内买到正品好价的大牌小样商品</p>
<h3 id="平台"><a href="#平台" class="headerlink" title="平台"></a>平台</h3><ul>
<li>更多的新客</li>
<li>更多的订单</li>
<li>更多的复访复购</li>
</ul>
<h3 id="商家"><a href="#商家" class="headerlink" title="商家"></a>商家</h3><ul>
<li>在平台上增加更多的派样订单</li>
<li>通过派样商品带来更多的会员，沉淀更多的私域用户</li>
<li>通过派样撬动更多的复访复购</li>
</ul>
<h3 id="指标"><a href="#指标" class="headerlink" title="指标"></a>指标</h3><ul>
<li>派样量（订单量）</li>
<li>入会用户数</li>
<li>复购规模（复购 GMV）</li>
</ul>
<h2 id="频道内容"><a href="#频道内容" class="headerlink" title="频道内容"></a>频道内容</h2><h3 id="商品-1"><a href="#商品-1" class="headerlink" title="商品"></a>商品</h3><h4 id="会员商品"><a href="#会员商品" class="headerlink" title="会员商品"></a>会员商品</h4><p>通过购买试用装引导用户入会，为商家带来更多的私域流量，后续通过发送会员券的方式来引导用户购买正装，促进用户的转化和复访复购</p>
<h4 id="无门槛商品"><a href="#无门槛商品" class="headerlink" title="无门槛商品"></a>无门槛商品</h4><ul>
<li>通过无门槛派样来建立品牌或商品在用户心里的口碑，促进正装商品的销售和用户的复访复购</li>
<li>通过控制各个环节的成本，把商品拆分成小样的方式进行销售以达到获利目的</li>
</ul>
<h3 id="流量来源"><a href="#流量来源" class="headerlink" title="流量来源"></a>流量来源</h3><ul>
<li>商城工具区等固定入口的流量</li>
<li>提单页、支付成功页、物流详情页等渠道的引流流量</li>
<li>抖音内的视频广告流等渠道的投流流量</li>
</ul>
<h3 id="商品来源"><a href="#商品来源" class="headerlink" title="商品来源"></a>商品来源</h3><ul>
<li>通过平台圈选的商品，频道商品的主要来源，但商品的质量和价格优势不明显</li>
<li>通过招商平台招商的商品，竞争力比较好，价格和质量都有保证</li>
</ul>
<h3 id="平台玩法"><a href="#平台玩法" class="headerlink" title="平台玩法"></a>平台玩法</h3><ul>
<li>普通的商品 feed 流</li>
<li>优质招商商品组成的限量购玩法</li>
<li>分人群发券引导用户购买试用装，通过发券的方式来提高商品的价格力和用户的转化</li>
<li>正在规划建设中的 N 元 M 件玩法，通过让商家把商品入库，试用频道组合出库的方式提高派样量，降低派样成本</li>
<li>大品牌新品上新活动</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2024/09/21/%E4%B8%9A%E5%8A%A1-%E5%A4%A7%E7%89%8C%E8%AF%95%E7%94%A8/" data-id="cm1ghkbne004ezodzf02u6lk1" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/other/" rel="tag">other</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-hexo升级" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2024/09/20/hexo%E5%8D%87%E7%BA%A7/" class="article-date">
  <time datetime="2024-09-19T21:10:11.000Z" itemprop="datePublished">2024-09-19</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2024/09/20/hexo%E5%8D%87%E7%BA%A7/">hexo升级</a>
    </h1>
  


        <div style="color: #999; margin-top: 0.3rem" class="post-meta-item"> 共计
    70 字，约需阅读
    0.25
    分钟
</div>
      </header>
    
    
   

    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="检查版本"><a href="#检查版本" class="headerlink" title="检查版本"></a>检查版本</h2><ul>
<li><a href="https://hexo.io/zh-cn/docs/">检查 <code>hexo</code> 目标版本的 <code>node</code> 版本依赖</a></li>
<li>检查 <code>node</code> 版本是否符合要求<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">node  -v</span><br></pre></td></tr></table></figure></li>
<li><a href="https://nodejs.org/zh-cn/download/package-manager">升级 <code>node</code> 版本</a></li>
</ul>
<h2 id="hexo-升级"><a href="#hexo-升级" class="headerlink" title="hexo 升级"></a>hexo 升级</h2><p>以 <code>yarn</code> 为例</p>
<ol>
<li>检查 hexo 版本</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npx hexo -v</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>执行升级命令更新到最新版本</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn upgrade --latest</span><br></pre></td></tr></table></figure>

<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><ul>
<li><a href="https://classic.yarnpkg.cn/docs/cli/upgrade/">yarn upgrade</a></li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2024/09/20/hexo%E5%8D%87%E7%BA%A7/" data-id="cm1ghkbmo000vzodz72060khz" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/other/" rel="tag">other</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-复盘" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2024/07/08/%E5%A4%8D%E7%9B%98/" class="article-date">
  <time datetime="2024-07-07T23:05:23.000Z" itemprop="datePublished">2024-07-07</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2024/07/08/%E5%A4%8D%E7%9B%98/">复盘</a>
    </h1>
  


        <div style="color: #999; margin-top: 0.3rem" class="post-meta-item"> 共计
    4 字，约需阅读
    0.01
    分钟
</div>
      </header>
    
    
   

    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><ul>
<li><a href="https://weread.qq.com/book-detail?type=1&senderVid=4957722&v=7cf32340724c43627cf2a01">复盘</a></li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2024/07/08/%E5%A4%8D%E7%9B%98/" data-id="cm1ghkbng004kzodzg2lce8fo" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/read-book/" rel="tag">读书</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-菜单设计" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2024/03/17/%E8%8F%9C%E5%8D%95%E8%AE%BE%E8%AE%A1/" class="article-date">
  <time datetime="2024-03-16T23:32:33.000Z" itemprop="datePublished">2024-03-16</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2024/03/17/%E8%8F%9C%E5%8D%95%E8%AE%BE%E8%AE%A1/">菜单设计</a>
    </h1>
  


        <div style="color: #999; margin-top: 0.3rem" class="post-meta-item"> 共计
    613 字，约需阅读
    2.23
    分钟
</div>
      </header>
    
    
   

    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h1><p>站点菜单存在需要修改的情况，每次修改之后都需要发布应用代码，严重影响了开发迭代的效率</p>
<h1 id="目标"><a href="#目标" class="headerlink" title="目标"></a>目标</h1><p>整体站点是一个经典的<code>顶部-侧边栏</code>，实现一个菜单配置的功能，需要具有如下能力</p>
<ul>
<li>用户能够自主申请接入</li>
<li>需要管理员进行审批才能生效</li>
<li>生效前只能管理员和菜单所有者才能看到对应配置</li>
<li>能够支持多级菜单</li>
<li>能够支持菜单的自由排序</li>
<li>菜单匹配需要支持精确匹配、前缀匹配和自定义匹配的方式</li>
</ul>
<h1 id="设计"><a href="#设计" class="headerlink" title="设计"></a>设计</h1><h2 id="整体流程"><a href="#整体流程" class="headerlink" title="整体流程"></a>整体流程</h2><p><img src="/images/menu_design.png" alt="整体流程"></p>
<h2 id="数据库"><a href="#数据库" class="headerlink" title="数据库"></a>数据库</h2><h3 id="选型"><a href="#选型" class="headerlink" title="选型"></a>选型</h3><ul>
<li>菜单数据量少</li>
<li>存在半结构化的数据类型（<code>owners</code> 可能支持多选和搜索）</li>
<li>无复杂查询场景</li>
<li>并发量不高</li>
</ul>
<h3 id="表设计"><a href="#表设计" class="headerlink" title="表设计"></a>表设计</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `Menu` (</span><br><span class="line">  `_id` number <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;菜单 id，默认生成的唯一 id&#x27;</span>,</span><br><span class="line">  `<span class="keyword">order</span>` number <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;菜单顺序&#x27;</span>,</span><br><span class="line">  `pid` string <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;父菜单 id，一级菜单的父 id 为 root&#x27;</span>,</span><br><span class="line">  `name` <span class="type">char</span>(<span class="number">64</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;菜单名称&#x27;</span>,</span><br><span class="line">  `path` <span class="type">char</span>(<span class="number">64</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;菜单路由&#x27;</span>,</span><br><span class="line">  `matchPrefix` <span class="type">boolean</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;是否前缀匹配&#x27;</span>,</span><br><span class="line">  `hiddenLeftMenu` <span class="type">boolean</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;是否隐藏左侧导航栏&#x27;</span>,</span><br><span class="line">  `owners` string[] <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;菜单所有者&#x27;</span>,</span><br><span class="line">  `status` tinyint(<span class="number">4</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="number">1</span> COMMENT <span class="string">&#x27;状态 1: 待上线  10: 已上线&#x27;</span>,</span><br><span class="line">  `createTime` datetime <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span> COMMENT <span class="string">&#x27;添加时间&#x27;</span>,</span><br><span class="line">  `updateTime` datetime <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span> COMMENT <span class="string">&#x27;更新时间&#x27;</span>,</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8 COMMENT<span class="operator">=</span><span class="string">&#x27;菜单管理&#x27;</span></span><br></pre></td></tr></table></figure>

<ul>
<li><code>order</code>： 一级菜单 100-999，二级菜单为一级菜单顺序 * 1000 + （1-1000）的范围</li>
<li><code>matchPrefix</code>： 是否前缀匹配，为了支持动态路由和其路径下的菜单匹配</li>
<li><code>hiddenLeftMenu</code>： 是否隐藏左侧导航栏，部分场景无需左侧的菜单</li>
</ul>
<h2 id="接口设计"><a href="#接口设计" class="headerlink" title="接口设计"></a>接口设计</h2><ul>
<li>菜单查询（分权限展示，未上线的菜单需要在菜单所有者和管理员的场景下能够展示出来）</li>
<li>菜单新增</li>
<li>菜单修改</li>
<li>菜单上线（管理员）</li>
<li>菜单删除（管理员）</li>
<li>菜单排序</li>
</ul>
<h2 id="前端界面设计"><a href="#前端界面设计" class="headerlink" title="前端界面设计"></a>前端界面设计</h2><p>需要支持以下功能</p>
<ul>
<li>支持菜单的叶子节点和非叶子节点</li>
<li>支持排序</li>
</ul>
<p>采用 <code>antd</code> 的 <a href="https://ant-design.antgroup.com/components/tree-cn?from=msidevs.net"><code>tree</code></a> 进行菜单的编辑功能</p>
<h1 id="备注"><a href="#备注" class="headerlink" title="备注"></a>备注</h1><p>菜单设计时需要考虑以下情况</p>
<ul>
<li>菜单设计时需要考虑排序</li>
<li>权限设计</li>
<li>路由匹配</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2024/03/17/%E8%8F%9C%E5%8D%95%E8%AE%BE%E8%AE%A1/" data-id="cm1ghkbnn005nzodz9szz6n1y" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/mysql/" rel="tag">mysql</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/node/" rel="tag">node</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-js打印分页" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2023/10/15/js%E6%89%93%E5%8D%B0%E5%88%86%E9%A1%B5/" class="article-date">
  <time datetime="2023-10-14T18:14:38.000Z" itemprop="datePublished">2023-10-14</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2023/10/15/js%E6%89%93%E5%8D%B0%E5%88%86%E9%A1%B5/">js打印分页</a>
    </h1>
  


        <div style="color: #999; margin-top: 0.3rem" class="post-meta-item"> 共计
    323 字，约需阅读
    1.17
    分钟
</div>
      </header>
    
    
   

    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="打印"><a href="#打印" class="headerlink" title="打印"></a>打印</h2><p>调用 <code>window.print()</code> 进行页面打印</p>
<h3 id="分页"><a href="#分页" class="headerlink" title="分页"></a>分页</h3><p><code>page-break-after</code> CSS 属性调整当前元素之后的分页符。</p>
<ul>
<li>auto:初始值。自动分页符（既不强制也不禁止）。</li>
<li>always: 始终在元素后强制分页。</li>
<li>avoid: 避免在元素后出现分页符。</li>
<li>left: 在元素之后足够的分页符，一直到一张空白的左页为止。</li>
<li>right: 在元素之后足够的分页符，一直到一张空白的右页为止。</li>
</ul>
<p><code>page-break-before</code> CSS 属性调整当前元素之后的分页符。</p>
<ul>
<li>auto:初始值。自动分页符（既不强制也不禁止）。</li>
<li>avoid: 避免在元素前出现分页符。</li>
</ul>
<p><code>page-break-inside</code> CSS 属性调整当前元素之后的分页符。</p>
<ul>
<li>auto:初始值。自动分页符（既不强制也不禁止）。</li>
<li>avoid: 避免在元素中出现分页符。</li>
</ul>
<h4 id="备注"><a href="#备注" class="headerlink" title="备注"></a>备注</h4><p>若遇到在某些浏览器设置 <code>page-break-after:always;</code> 无法生效时，可以参考以下配置</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;display: block;position: relative;&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span></span></span><br><span class="line"><span class="tag">    <span class="attr">style</span>=<span class="string">&quot;page-break-after:always;page-break-inside: avoid;-webkit-region-break-inside: avoid;&quot;</span></span></span><br><span class="line"><span class="tag">  &gt;</span></span><br><span class="line">    第一页</span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span></span></span><br><span class="line"><span class="tag">    <span class="attr">style</span>=<span class="string">&quot;page-break-after:always;page-break-inside: avoid;-webkit-region-break-inside: avoid;&quot;</span></span></span><br><span class="line"><span class="tag">  &gt;</span></span><br><span class="line">    第二页</span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><ul>
<li><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Window/print">print() 方法</a></li>
<li><a href="https://stackoverflow.com/questions/1630819/google-chrome-printing-page-breaks">page-break-after: always; 不生效</a></li>
<li><a href="https://developer.mozilla.org/zh-CN/docs/Web/CSS/page-break-after">page-break-after</a></li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2023/10/15/js%E6%89%93%E5%8D%B0%E5%88%86%E9%A1%B5/" data-id="cm1ghkbmx0022zodz8aek056h" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/JavaScript/" rel="tag">JavaScript</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-高德地图" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2022/11/28/%E9%AB%98%E5%BE%B7%E5%9C%B0%E5%9B%BE/" class="article-date">
  <time datetime="2022-11-27T19:55:24.000Z" itemprop="datePublished">2022-11-27</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2022/11/28/%E9%AB%98%E5%BE%B7%E5%9C%B0%E5%9B%BE/">高德地图</a>
    </h1>
  


        <div style="color: #999; margin-top: 0.3rem" class="post-meta-item"> 共计
    199 字，约需阅读
    0.72
    分钟
</div>
      </header>
    
    
   

    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="准备"><a href="#准备" class="headerlink" title="准备"></a>准备</h3><ol>
<li>注册账号并申请 Key ，参考 <a href="https://lbs.amap.com/api/jsapi-v2/guide/abc/prepare">官方链接</a></li>
<li>通过 <code>npm i @amap/amap-jsapi-loader</code> 安装 <code>SDK</code></li>
</ol>
<h3 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h3><ol>
<li>配置 <code>securityJsCode</code></li>
</ol>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">window</span>.<span class="property">_AMapSecurityConfig</span> = &#123;</span><br><span class="line">  <span class="attr">securityJsCode</span>: <span class="string">&#x27;你的 secret&#x27;</span>,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>初始化 <code>SDK</code></li>
</ol>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">AMapLoader</span> <span class="keyword">from</span> <span class="string">&#x27;@amap/amap-jsapi-loader&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="title class_">AMapLoader</span>.<span class="title function_">load</span>(&#123;</span><br><span class="line">  <span class="attr">key</span>: <span class="string">&#x27;你的 key&#x27;</span>, <span class="comment">// 申请好的Web端开发者Key，首次调用 load 时必填</span></span><br><span class="line">  <span class="attr">version</span>: <span class="string">&#x27;2.0&#x27;</span>, <span class="comment">// 指定要加载的 JSAPI 的版本，缺省时默认为 1.4.15</span></span><br><span class="line">  <span class="attr">plugins</span>: [], <span class="comment">// 需要使用的的插件列表，如比例尺&#x27;AMap.Scale&#x27;等</span></span><br><span class="line">&#125;).<span class="title function_">then</span>(<span class="function">(<span class="params"><span class="title class_">AMap</span></span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// 初始化代码</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h3 id="注意"><a href="#注意" class="headerlink" title="注意"></a>注意</h3><ul>
<li>通过此种方式使用高德地图时，建议 <code>securityJsCode</code> 在使用前做简单的加密，如通过 <code>base64</code> 等方式加密等</li>
<li>当出现较大的误差时请检查 <code>key</code> 和 <code>securityJsCode</code> 是否匹配</li>
</ul>
<h3 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h3><ul>
<li><a href="https://lbs.amap.com/api/jsapi-v2/summary">高德地图</a></li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2022/11/28/%E9%AB%98%E5%BE%B7%E5%9C%B0%E5%9B%BE/" data-id="cm1ghkbnu007nzodz4yjz2exx" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/JavaScript/" rel="tag">JavaScript</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-pixi-js" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2022/11/28/pixi-js/" class="article-date">
  <time datetime="2022-11-27T19:20:55.000Z" itemprop="datePublished">2022-11-27</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2022/11/28/pixi-js/">pixi.js</a>
    </h1>
  


        <div style="color: #999; margin-top: 0.3rem" class="post-meta-item"> 共计
    351 字，约需阅读
    1.28
    分钟
</div>
      </header>
    
    
   

    <div class="article-entry" itemprop="articleBody">
      
        <p>Pixi 是一个非常快的 2D sprite 渲染引擎。</p>
<h3 id="特点"><a href="#特点" class="headerlink" title="特点"></a>特点</h3><ul>
<li>速度快：在 2D 渲染方面，PixiJS 是最快的。</li>
<li>灵活：友好的、功能丰富的 API 让 PixiJS 轻松处理基本问题，同时您可以专注于生成令人难以置信跨平台体验。</li>
<li>免费： PixiJS 永久开源，并拥有庞大的支持社区推动它的发展和演变。</li>
</ul>
<h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><p>通过 <code>npm</code> 安装最新的 6.5.8 版本，7.x 版本暂时还有一些问题，建议使用 6.x 版本</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i pixi.js@6.5.8</span><br></pre></td></tr></table></figure>

<h3 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h3><ol>
<li>创建应用，并把应用挂载到 dom 中</li>
</ol>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="variable constant_">PIXI</span>, &#123; <span class="title class_">Application</span>, <span class="title class_">Sprite</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;pixi.js&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> app = <span class="keyword">new</span> <span class="title class_">Application</span>(&#123;</span><br><span class="line">  <span class="attr">width</span>: <span class="number">500</span>,</span><br><span class="line">  <span class="attr">height</span>: <span class="number">500</span>,</span><br><span class="line">  <span class="attr">antialias</span>: <span class="literal">true</span>, <span class="comment">// default: false 反锯齿</span></span><br><span class="line">  <span class="attr">resolution</span>: <span class="number">1</span>, <span class="comment">// default: 1 分辨率</span></span><br><span class="line">&#125;)</span><br><span class="line">root.<span class="title function_">appendChild</span>(app.<span class="property">view</span> <span class="keyword">as</span> <span class="built_in">any</span>)</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>加载资源并把资源放在画布的中间</li>
</ol>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">app.<span class="property">loader</span>.<span class="title function_">add</span>(<span class="string">&#x27;bunny&#x27;</span>, logo).<span class="title function_">load</span>(<span class="function">(<span class="params">loader, resources</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// This creates a texture from a &#x27;bunny.png&#x27; image.</span></span><br><span class="line">  <span class="keyword">const</span> bunny = <span class="keyword">new</span> <span class="title class_">Sprite</span>(resources.<span class="property">bunny</span>.<span class="property">texture</span>)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Setup the position of the bunny</span></span><br><span class="line">  bunny.<span class="property">x</span> = app.<span class="property">renderer</span>.<span class="property">width</span> / <span class="number">2</span></span><br><span class="line">  bunny.<span class="property">y</span> = app.<span class="property">renderer</span>.<span class="property">height</span> / <span class="number">2</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// Rotate around the center</span></span><br><span class="line">  bunny.<span class="property">anchor</span>.<span class="property">x</span> = <span class="number">0.5</span></span><br><span class="line">  bunny.<span class="property">anchor</span>.<span class="property">y</span> = <span class="number">0.5</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// Add the bunny to the scene we are building.</span></span><br><span class="line">  app.<span class="property">stage</span>.<span class="title function_">addChild</span>(bunny)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>让图片运动起来</li>
</ol>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Listen for frame updates</span></span><br><span class="line">app.<span class="property">ticker</span>.<span class="title function_">add</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// each frame we spin the bunny around a bit</span></span><br><span class="line">  <span class="comment">// console.log(&#x27;bunny.anchor.x&#x27;, bunny.anchor)</span></span><br><span class="line">  <span class="keyword">if</span> (bunny.<span class="property">x</span> &gt;= app.<span class="property">renderer</span>.<span class="property">width</span>) &#123;</span><br><span class="line">    bunny.<span class="property">x</span> = <span class="number">0</span></span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    bunny.<span class="property">x</span> += <span class="number">1</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h3 id="示例图片"><a href="#示例图片" class="headerlink" title="示例图片"></a>示例图片</h3><p><img src="/images/2d/demo.jpg" alt="示例图片"></p>
<h3 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h3><p><a href="http://pixijs.huashengweilai.com/"> Pixi.js 中文网</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2022/11/28/pixi-js/" data-id="cm1ghkbn4002zzodz152v8jhz" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/JavaScript/" rel="tag">JavaScript</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-js获取方位信息" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2022/08/21/js%E8%8E%B7%E5%8F%96%E6%96%B9%E4%BD%8D%E4%BF%A1%E6%81%AF/" class="article-date">
  <time datetime="2022-08-20T22:56:47.000Z" itemprop="datePublished">2022-08-20</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2022/08/21/js%E8%8E%B7%E5%8F%96%E6%96%B9%E4%BD%8D%E4%BF%A1%E6%81%AF/">js获取方位信息</a>
    </h1>
  


        <div style="color: #999; margin-top: 0.3rem" class="post-meta-item"> 共计
    340 字，约需阅读
    1.24
    分钟
</div>
      </header>
    
    
   

    <div class="article-entry" itemprop="articleBody">
      
        <p>js 提供了获取方位信息的方法，整体可以分为以下几步</p>
<h3 id="前置检查"><a href="#前置检查" class="headerlink" title="前置检查"></a>前置检查</h3><p>通过判断 <code>window</code> 是否具有 <code>DeviceOrientationEvent</code> 这个属性来判断是否支持获取方位信息</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">checkOrientation</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title class_">Boolean</span>(<span class="variable language_">window</span>.<span class="property">DeviceOrientationEvent</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="获取方位信息"><a href="#获取方位信息" class="headerlink" title="获取方位信息"></a>获取方位信息</h3><p>通过监听事件实现对方位信息的获取</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">watchOrientation</span>(<span class="params"><span class="attr">callback</span>: (e: DeviceOrientationEvent) =&gt; <span class="built_in">void</span></span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="title function_">checkOrientation</span>()) &#123;</span><br><span class="line">    <span class="variable language_">window</span>.<span class="title function_">addEventListener</span>(<span class="string">&#x27;deviceorientation&#x27;</span>, callback, <span class="literal">true</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">window</span>.<span class="title function_">removeEventListener</span>(<span class="string">&#x27;deviceorientation&#x27;</span>, callback, <span class="literal">true</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> loop</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="参数"><a href="#参数" class="headerlink" title="参数"></a>参数</h4><h5 id="callback"><a href="#callback" class="headerlink" title="callback"></a><code>callback</code></h5><p>获取方位信息后的回调，类型为 <code>(e: DeviceOrientationEvent) =&gt; void</code></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> <span class="title class_">DeviceOrientationEvent</span> <span class="keyword">extends</span> <span class="title class_">Event</span> &#123;</span><br><span class="line">  <span class="keyword">readonly</span> <span class="attr">absolute</span>: <span class="built_in">boolean</span> <span class="comment">// 一个布尔值，指示设备是否绝对提供方向数据。</span></span><br><span class="line">  <span class="keyword">readonly</span> <span class="attr">alpha</span>: <span class="built_in">number</span> | <span class="literal">null</span> <span class="comment">// 表示设备绕z轴运动的数字，以度表示，值范围为0（包括）到360（不包括）。以正北方向为 0 度</span></span><br><span class="line">  <span class="keyword">readonly</span> <span class="attr">beta</span>: <span class="built_in">number</span> | <span class="literal">null</span> <span class="comment">// 表示设备绕x轴运动的数字，以度表示，值范围为-180（包括）到180（不包括）。这表示设备的前后运动。</span></span><br><span class="line">  <span class="keyword">readonly</span> <span class="attr">gamma</span>: <span class="built_in">number</span> | <span class="literal">null</span> <span class="comment">// 表示设备绕y轴运动的数字，以度表示，值范围为-90（包括）到90（不包括）。这表示设备从左到右的运动。</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="注意"><a href="#注意" class="headerlink" title="注意"></a>注意</h3><ul>
<li>需要当前页面为 <code>HTTPS</code> 才被允许获取方位信息</li>
<li>可以通过<a href="https://sensorbox.glitch.me/">当前页面</a>检测设备是否支持获取方位信息</li>
</ul>
<h3 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h3><ul>
<li><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Geolocation/getCurrentPosition">Geolocation 获取位置</a></li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2022/08/21/js%E8%8E%B7%E5%8F%96%E6%96%B9%E4%BD%8D%E4%BF%A1%E6%81%AF/" data-id="cm1ghkbmy0029zodzdliabbsf" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/JavaScript/" rel="tag">JavaScript</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-js获取位置信息" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2022/08/20/js%E8%8E%B7%E5%8F%96%E4%BD%8D%E7%BD%AE%E4%BF%A1%E6%81%AF/" class="article-date">
  <time datetime="2022-08-19T22:36:09.000Z" itemprop="datePublished">2022-08-19</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2022/08/20/js%E8%8E%B7%E5%8F%96%E4%BD%8D%E7%BD%AE%E4%BF%A1%E6%81%AF/">js获取位置信息</a>
    </h1>
  


        <div style="color: #999; margin-top: 0.3rem" class="post-meta-item"> 共计
    910 字，约需阅读
    3.31
    分钟
</div>
      </header>
    
    
   

    <div class="article-entry" itemprop="articleBody">
      
        <p>项目中需要获取定位信息，js 提供了对于的接口去获取，整体可以分为以下几步</p>
<h3 id="前置检查"><a href="#前置检查" class="headerlink" title="前置检查"></a>前置检查</h3><p>通过判断 <code>navigator</code> 是否具有 <code>geolocation</code> 这个属性来判断是否支持获取定位信息</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">checkGeolocation</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="string">&#x27;geolocation&#x27;</span> <span class="keyword">in</span> navigator</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="权限校验"><a href="#权限校验" class="headerlink" title="权限校验"></a>权限校验</h3><p>通过接口获取当前浏览器的定位授权状态</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">checkPermission</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> res = <span class="keyword">await</span> navigator?.<span class="property">permissions</span>?.<span class="title function_">query</span>(&#123; <span class="attr">name</span>: <span class="string">&#x27;geolocation&#x27;</span> &#125;)</span><br><span class="line">  <span class="keyword">return</span> res?.<span class="property">state</span> || <span class="string">&#x27;prompt&#x27;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>授权状态共有 <code>denied</code>、<code>granted</code>、<code>prompt</code> 三种状态</p>
<ul>
<li><code>denied</code>：拒绝授权</li>
<li><code>granted</code>： 已经授权</li>
<li><code>prompt</code>：需要用户手动授权</li>
</ul>
<h3 id="获取位置"><a href="#获取位置" class="headerlink" title="获取位置"></a>获取位置</h3><h4 id="一次获取位置"><a href="#一次获取位置" class="headerlink" title="一次获取位置"></a>一次获取位置</h4><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">navigator.<span class="property">geolocation</span>.<span class="title function_">getCurrentPosition</span>(callback, handleError, options)</span><br></pre></td></tr></table></figure>

<h4 id="监听位置变化"><a href="#监听位置变化" class="headerlink" title="监听位置变化"></a>监听位置变化</h4><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 注册事件监听</span></span><br><span class="line"><span class="keyword">const</span> geoWatchID = navigator.<span class="property">geolocation</span>.<span class="title function_">watchPosition</span>(</span><br><span class="line">  callback,</span><br><span class="line">  handleError,</span><br><span class="line">  options</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 清楚监听事件</span></span><br><span class="line">navigator.<span class="property">geolocation</span>.<span class="title function_">clearWatch</span>(geoWatchID)</span><br></pre></td></tr></table></figure>

<h4 id="参数"><a href="#参数" class="headerlink" title="参数"></a>参数</h4><h5 id="callback"><a href="#callback" class="headerlink" title="callback"></a><code>callback</code></h5><p>获取位置信息后的回调，类型为 <code>(position: GeolocationPosition) =&gt; void</code></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> <span class="title class_">GeolocationCoordinates</span> &#123;</span><br><span class="line">  <span class="keyword">readonly</span> <span class="attr">accuracy</span>: <span class="built_in">number</span> <span class="comment">// 表示纬度和经度属性精度的双精度值，以米为单位</span></span><br><span class="line">  <span class="keyword">readonly</span> <span class="attr">altitude</span>: <span class="built_in">number</span> | <span class="literal">null</span> <span class="comment">// 海拔高度</span></span><br><span class="line">  <span class="keyword">readonly</span> <span class="attr">altitudeAccuracy</span>: <span class="built_in">number</span> | <span class="literal">null</span> <span class="comment">// 一个双精度值，表示以米为单位的高度精度。此值可以为空。</span></span><br><span class="line">  <span class="keyword">readonly</span> <span class="attr">heading</span>: <span class="built_in">number</span> | <span class="literal">null</span> <span class="comment">// 返回表示设备运行方向的双精度值。该值以度为单位，表示设备偏离正北方航向的距离。0度表示正北方，方向为顺时针方向（即东90度，西270度）。如果速度为0，航向为NaN。如果设备无法提供航向信息，则该值为空。</span></span><br><span class="line">  <span class="keyword">readonly</span> <span class="attr">latitude</span>: <span class="built_in">number</span> <span class="comment">// 维度</span></span><br><span class="line">  <span class="keyword">readonly</span> <span class="attr">longitude</span>: <span class="built_in">number</span> <span class="comment">// 经度</span></span><br><span class="line">  <span class="keyword">readonly</span> <span class="attr">speed</span>: <span class="built_in">number</span> | <span class="literal">null</span> <span class="comment">// 返回表示设备速度的双精度值，单位为米/秒。此值可以为空。</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/** Available only in secure contexts. */</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">GeolocationPosition</span> &#123;</span><br><span class="line">  <span class="keyword">readonly</span> <span class="attr">coords</span>: <span class="title class_">GeolocationCoordinates</span> <span class="comment">// 表示设备在地球上的位置和海拔，以及计算这些属性的精确度</span></span><br><span class="line">  <span class="keyword">readonly</span> <span class="attr">timestamp</span>: <span class="title class_">EpochTimeStamp</span> <span class="comment">// 表示获取到的位置的时间</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="handleError"><a href="#handleError" class="headerlink" title="handleError"></a><code>handleError</code></h5><p>获取位置信息失败的回调，类型为 <code>(error: GeolocationPositionError) =&gt; void</code></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> <span class="title class_">GeolocationPositionError</span> &#123;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 错误原因</span></span><br><span class="line"><span class="comment">   * 1 -&gt; PERMISSION_DENIED: 地理位置信息的获取失败，因为该页面没有获取地理位置信息的权限。</span></span><br><span class="line"><span class="comment">   * 2 -&gt; POSITION_UNAVAILABLE:	地理位置获取失败，因为至少有一个内部位置源返回一个内部错误。</span></span><br><span class="line"><span class="comment">   * 3 -&gt; TIMEOUT: 获取地理位置超时，通过定义PositionOptions.timeout 来设置获取地理位置的超时时长。</span></span><br><span class="line"><span class="comment">   **/</span></span><br><span class="line">  <span class="keyword">readonly</span> <span class="attr">code</span>: <span class="built_in">number</span></span><br><span class="line">  <span class="keyword">readonly</span> <span class="attr">message</span>: <span class="built_in">string</span> <span class="comment">// 描述错误的详细信息</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="options"><a href="#options" class="headerlink" title="options"></a><code>options</code></h5><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> <span class="title class_">PositionOptions</span> &#123;</span><br><span class="line">  enableHighAccuracy?: <span class="built_in">boolean</span> <span class="comment">// 表示应用程序希望接收最佳可能结果。如果为真，并且如果设备能够提供更准确的位置，它将这样做。请注意，这可能导致响应时间变慢或功耗增加（例如，使用移动设备上的GPS芯片）。另一方面，如果为假，则设备可以通过更快地响应和/或使用更少的功率来自由节省资源。默认值：false。</span></span><br><span class="line">  maximumAge?: <span class="built_in">number</span> <span class="comment">// 可接受返回的可能缓存位置的最大时间（以毫秒为单位）。如果设置为0，则表示设备无法使用缓存位置，必须尝试检索实际当前位置。如果设置为无穷大，则设备必须返回缓存位置，而不管其使用年限如何。默认值：0。</span></span><br><span class="line">  timeout?: <span class="built_in">number</span> <span class="comment">// 表示设备返回位置所允许的最大时间长度（以毫秒为单位）。默认值为无穷大，这意味着getCurrentPosition（）在位置可用之前不会返回。</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="注意"><a href="#注意" class="headerlink" title="注意"></a>注意</h3><ul>
<li><code>iOS</code>或部分 <code>Android</code> 设备需要当前页面为 <code>HTTPS</code> 才被允许获取位置信息</li>
<li>可以通过<a href="https://sensorbox.glitch.me/">当前页面</a>检测设备是否支持获取位置信息</li>
</ul>
<h3 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h3><ul>
<li><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Geolocation/getCurrentPosition">Geolocation 获取位置</a></li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2022/08/20/js%E8%8E%B7%E5%8F%96%E4%BD%8D%E7%BD%AE%E4%BF%A1%E6%81%AF/" data-id="cm1ghkbmz002czodz9fl45smu" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/JavaScript/" rel="tag">JavaScript</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-merge和rebase" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2022/05/29/merge%E5%92%8Crebase/" class="article-date">
  <time datetime="2022-05-28T21:55:56.000Z" itemprop="datePublished">2022-05-28</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2022/05/29/merge%E5%92%8Crebase/">git merge和rebase</a>
    </h1>
  


        <div style="color: #999; margin-top: 0.3rem" class="post-meta-item"> 共计
    318 字，约需阅读
    1.16
    分钟
</div>
      </header>
    
    
   

    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="相同点"><a href="#相同点" class="headerlink" title="相同点"></a>相同点</h3><ul>
<li>都是用来合并分支，将不同分支的代码融合在一起</li>
</ul>
<h3 id="不同点"><a href="#不同点" class="headerlink" title="不同点"></a>不同点</h3><h4 id="生成的代码树不同"><a href="#生成的代码树不同" class="headerlink" title="生成的代码树不同"></a>生成的代码树不同</h4><ul>
<li><p>merge 生成的代码树记录了所有的历史操作过程<br><img src="/images/git/merge.png" alt="merge 生成的代码树"></p>
</li>
<li><p>rebase 生成的代码树是一条直线，通过对目标分支进行 “嫁接”，把新提交的 commit 代码添加到源分支的最后<br><img src="/images/git/rebase.png" alt="rebase 生成的代码树"></p>
</li>
</ul>
<h4 id="处理冲突的方式"><a href="#处理冲突的方式" class="headerlink" title="处理冲突的方式"></a>处理冲突的方式</h4><ul>
<li>merge 命令合并分支，只需解决一次冲突，但是会产生一个新的 commit</li>
<li>rebase 命令合并分支，解决完冲突，执行 git add .和 git rebase –continue，不会产生额外的 commit，但是需要重复处理多次冲突。</li>
</ul>
<h3 id="附录"><a href="#附录" class="headerlink" title="附录"></a>附录</h3><h4 id="使用建议"><a href="#使用建议" class="headerlink" title="使用建议"></a>使用建议</h4><p>当满足以下条件时：</p>
<ul>
<li>能够定期 rebase（避免 rebase 时出现大量冲突需要解决）</li>
<li>开发的分支只是自己使用（避免其他人拉去代码时本地产生冲突）</li>
<li>非基础公共分支</li>
</ul>
<p>使用 rebase，其它使用 merge</p>
<h4 id="基本使用"><a href="#基本使用" class="headerlink" title="基本使用"></a>基本使用</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git rebase [<span class="built_in">source</span>] [target]</span><br><span class="line"><span class="comment"># source 分支作为基线，把 target 分支的 commit 嫁接到 source 分支上，若 target 分支参数不存在则使用当前所在分支</span></span><br></pre></td></tr></table></figure>

<h4 id="小技巧"><a href="#小技巧" class="headerlink" title="小技巧"></a>小技巧</h4><p>如果你不熟悉 git rebase，可以随时在临时分支中执行 rebase。</p>
<h3 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h3><ul>
<li><a href="https://zhuanlan.zhihu.com/p/57872388">Merge vs Rebase</a></li>
<li><a href="https://git-scm.com/docs/git-rebase/">git-rebase </a></li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2022/05/29/merge%E5%92%8Crebase/" data-id="cm1ghkbn0002izodz6qn00an3" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/git/" rel="tag">git</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-黑客增长" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2022/05/09/%E9%BB%91%E5%AE%A2%E5%A2%9E%E9%95%BF/" class="article-date">
  <time datetime="2022-05-08T22:30:27.000Z" itemprop="datePublished">2022-05-08</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2022/05/09/%E9%BB%91%E5%AE%A2%E5%A2%9E%E9%95%BF/">黑客增长</a>
    </h1>
  


        <div style="color: #999; margin-top: 0.3rem" class="post-meta-item"> 共计
    50 字，约需阅读
    0.18
    分钟
</div>
      </header>
    
    
   

    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="目标"><a href="#目标" class="headerlink" title="目标"></a>目标</h3><p>已极低甚至为零的成本，实现发展的跃迁</p>
<h3 id="概念"><a href="#概念" class="headerlink" title="概念"></a>概念</h3><h4 id="AARRR-漏斗模型"><a href="#AARRR-漏斗模型" class="headerlink" title="AARRR 漏斗模型"></a>AARRR 漏斗模型</h4><h3 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h3><ul>
<li><a href="https://www.sohu.com/a/487162563_121124370">一文了解增长黑客 </a></li>
<li><a href="https://zhuanlan.zhihu.com/p/480814512">《硅谷增长黑客实战笔记》学习笔记</a></li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2022/05/09/%E9%BB%91%E5%AE%A2%E5%A2%9E%E9%95%BF/" data-id="cm1ghkbnu007pzodzaqvtbp7d" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/other/" rel="tag">other</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="js-js中浮点数精度问题" class="article article-type-js" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2022/01/17/js%E4%B8%AD%E6%B5%AE%E7%82%B9%E6%95%B0%E7%B2%BE%E5%BA%A6%E9%97%AE%E9%A2%98/" class="article-date">
  <time datetime="2022-01-16T17:46:51.000Z" itemprop="datePublished">2022-01-16</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2022/01/17/js%E4%B8%AD%E6%B5%AE%E7%82%B9%E6%95%B0%E7%B2%BE%E5%BA%A6%E9%97%AE%E9%A2%98/">js中浮点数精度问题</a>
    </h1>
  


        <div style="color: #999; margin-top: 0.3rem" class="post-meta-item"> 共计
    547 字，约需阅读
    1.99
    分钟
</div>
      </header>
    
    
   

    <div class="article-entry" itemprop="articleBody">
      
        <p>在商品的价格计算中，由于精度的需要，要把用户输入的价格从元转化为分，其转化规则如下</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> price = <span class="title class_">Number</span>(inputPrice) * <span class="number">100</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(price)</span><br></pre></td></tr></table></figure>

<p>但是在测试过程中发现，输入 <code>2.01</code> 时，输出结果不为 <code>201</code> ，而是 <code>200.99999999999997</code><br>通过研究发现和 js 的数字存储方式 <code>IEEE 754</code> 有关，计算机存储数字时，由于存储方式的原因，存储的并不是准确的数字，而是有一定误差的数字，如经典的</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">0.1</span> + <span class="number">0.2</span> === <span class="number">0.3</span></span><br><span class="line"><span class="literal">false</span></span><br></pre></td></tr></table></figure>

<h2 id="IEEE-754-浮点数"><a href="#IEEE-754-浮点数" class="headerlink" title="IEEE 754 浮点数"></a>IEEE 754 浮点数</h2><p><img src="/images/js/float-num.webp" alt="IEEE 754 浮点数表示"></p>
<p>IEEE 754 浮点数由三个域组成，分别为 sign bit (符号位)、exponent bias (指数偏移值) 和 fraction (尾数)。64 位中，sign bit 占 1 位，exponent bias 占 11 位，fraction 占 52 位。</p>
<h3 id="0-1-转换为二进制表示"><a href="#0-1-转换为二进制表示" class="headerlink" title="0.1 转换为二进制表示"></a>0.1 转换为二进制表示</h3><p>小数转二进制用乘 R 取整的方法，运算如下</p>
<table>
<thead>
<tr>
<th>小数</th>
<th>x2 的结果</th>
<th>整数部分</th>
</tr>
</thead>
<tbody><tr>
<td>0.1</td>
<td>0.2</td>
<td>0</td>
</tr>
<tr>
<td>0.2</td>
<td>0.4</td>
<td>0</td>
</tr>
<tr>
<td>0.4</td>
<td>0.8</td>
<td>0</td>
</tr>
<tr>
<td>0.8</td>
<td>1.6</td>
<td>1</td>
</tr>
<tr>
<td>0.6</td>
<td>1.2</td>
<td>1</td>
</tr>
<tr>
<td>0.2</td>
<td>0.4</td>
<td>0</td>
</tr>
<tr>
<td>0.4</td>
<td>0.8</td>
<td>0</td>
</tr>
<tr>
<td>0.8</td>
<td>1.6</td>
<td>1</td>
</tr>
<tr>
<td>0.6</td>
<td>1.2</td>
<td>1</td>
</tr>
<tr>
<td>0.2</td>
<td>0.4</td>
<td>0</td>
</tr>
<tr>
<td>…</td>
<td>…</td>
<td>…</td>
</tr>
</tbody></table>
<p>结果 <code>0.00011001100110011…</code>(循环 <code>0011</code>), 将转换后的二进制通过科学计数法表示 <code>0.00011...</code>(无限重复 <code>0011</code>) 通过科学计数法表示则是 <code>1.10011001...(重复 1001)*2</code> - 4(偏移 4 位)</p>
<h5 id="指数偏移值"><a href="#指数偏移值" class="headerlink" title="指数偏移值"></a>指数偏移值</h5><p>双精度浮点数固定偏移值 (2^(11-1)-1) 加上指数实际值(即 2^-4 中的 -4) 的 11 位二进制表示。</p>
<h6 id="注：-exponent-bias-在-64-位中占-11-位"><a href="#注：-exponent-bias-在-64-位中占-11-位" class="headerlink" title="注： exponent bias 在 64 位中占 11 位"></a>注： exponent bias 在 64 位中占 11 位</h6><h5 id="尾数"><a href="#尾数" class="headerlink" title="尾数"></a>尾数</h5><p>fraction 占 52 位所以抽取 52 位小数（多出来的采用四舍五入制）</p>
<h4 id="结果"><a href="#结果" class="headerlink" title="结果"></a>结果</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1001...(中间有 11 个 1001)...1010 (请注意最后四位，是 1010 而不是 1001，因为四舍五入有进位）</span><br></pre></td></tr></table></figure>

<h3 id="处理办法"><a href="#处理办法" class="headerlink" title="处理办法"></a>处理办法</h3><p>可以通过四舍五入的方式进行取整，保证数据的准确性</p>
<h4 id="toFixed"><a href="#toFixed" class="headerlink" title="toFixed"></a><code>toFixed</code></h4><p>具备自动四舍五入的能力</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> price = <span class="title class_">Number</span>((<span class="title class_">Number</span>(inputPrice) * <span class="number">100</span>).<span class="title function_">toFixed</span>())</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(price)</span><br></pre></td></tr></table></figure>

<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><ul>
<li><a href="https://zhuanlan.zhihu.com/p/227951185">0.1 + 0.2 为什么不等于 0.3–奇怪的相等与不等</a></li>
<li><a href="https://segmentfault.com/a/1190000016884479">为什么 JavaScript 里面 0.1+0.2 &#x3D;&#x3D;&#x3D; 0.3 是 false</a></li>
<li><a href="https://baike.baidu.com/item/IEEE%20754/3869922?fr=aladdin">IEEE 754</a></li>
<li><a href="https://zhidao.baidu.com/question/1831743003782686540.html">十进制变二进制小数乘二取整是什么意思</a></li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2022/01/17/js%E4%B8%AD%E6%B5%AE%E7%82%B9%E6%95%B0%E7%B2%BE%E5%BA%A6%E9%97%AE%E9%A2%98/" data-id="cm1ghkbmp0012zodzdb2z24m9" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/JavaScript/" rel="tag">JavaScript</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-antd中form表单联动" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2022/01/02/antd%E4%B8%ADform%E8%A1%A8%E5%8D%95%E8%81%94%E5%8A%A8/" class="article-date">
  <time datetime="2022-01-02T15:19:35.000Z" itemprop="datePublished">2022-01-02</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2022/01/02/antd%E4%B8%ADform%E8%A1%A8%E5%8D%95%E8%81%94%E5%8A%A8/">antd中form表单联动</a>
    </h1>
  


        <div style="color: #999; margin-top: 0.3rem" class="post-meta-item"> 共计
    466 字，约需阅读
    1.69
    分钟
</div>
      </header>
    
    
   

    <div class="article-entry" itemprop="articleBody">
      
        <p>日常开发过程中，经常涉及到 <code>form</code> 表单的联动，在 <code>A</code> 选项中的某个值选中时出现 <code>BCE</code> 选项，其它值选中时不显示</p>
<p><img src="/images/form/form-a.png" alt="选中 A 时无选项"></p>
<p>切换选项后新增选项</p>
<p><img src="/images/form/form-a-more.jpg" alt="切换选项后新增选项"></p>
<h3 id="监听选项的-onChange-事件实现"><a href="#监听选项的-onChange-事件实现" class="headerlink" title="监听选项的 onChange 事件实现"></a>监听选项的 <code>onChange</code> 事件实现</h3><figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">CustomForm</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> [a, setA] = <span class="title function_">useState</span>()</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">Form.Item</span> <span class="attr">name</span>=<span class="string">&quot;testa&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">Radio.Group</span> <span class="attr">onChange</span>=<span class="string">&#123;(e)</span> =&gt;</span> setA(e.target.value)&#125;&gt;</span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">Radio</span> <span class="attr">value</span>=<span class="string">&quot;A&quot;</span>&gt;</span>A<span class="tag">&lt;/<span class="name">Radio</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">Radio</span> <span class="attr">value</span>=<span class="string">&quot;B&quot;</span>&gt;</span>B<span class="tag">&lt;/<span class="name">Radio</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">Radio.Group</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">Form.Item</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      &#123;a === &#x27;B&#x27; &amp;&amp; <span class="tag">&lt;<span class="name">Form.Item</span> <span class="attr">name</span>=<span class="string">&quot;testb&quot;</span>&gt;</span>表单项<span class="tag">&lt;/<span class="name">Form.Item</span>&gt;</span>&#125;</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/&gt;</span></span></span><br><span class="line">  )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>通过监听表单项的 <code>onChange</code> 事件来修改 <code>state</code> ，<code>state</code> 值来驱动表单项的显示，官方已不建议在 form 表单中使用 <code>onChange</code> 事件</p>
<h3 id="监听表单的-onValuesChange-事件实现"><a href="#监听表单的-onValuesChange-事件实现" class="headerlink" title="监听表单的 onValuesChange 事件实现"></a>监听表单的 <code>onValuesChange</code> 事件实现</h3><figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">CustomForm</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> [a, setA] = <span class="title function_">useState</span>()</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">Form</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">onValuesChange</span>=<span class="string">&#123;(_,</span> <span class="attr">values</span>) =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-xml">        const &#123; testa &#125; = values</span></span><br><span class="line"><span class="language-xml">        setA(testa)</span></span><br><span class="line"><span class="language-xml">      &#125;&#125;</span></span><br><span class="line"><span class="language-xml">    &gt;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">Form.Item</span> <span class="attr">name</span>=<span class="string">&quot;testa&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">Radio.Group</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">Radio</span> <span class="attr">value</span>=<span class="string">&quot;A&quot;</span>&gt;</span>A<span class="tag">&lt;/<span class="name">Radio</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">Radio</span> <span class="attr">value</span>=<span class="string">&quot;B&quot;</span>&gt;</span>B<span class="tag">&lt;/<span class="name">Radio</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">Radio.Group</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">Form.Item</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      &#123;a === &#x27;B&#x27; &amp;&amp; <span class="tag">&lt;<span class="name">Form.Item</span> <span class="attr">name</span>=<span class="string">&quot;testb&quot;</span>&gt;</span>表单项<span class="tag">&lt;/<span class="name">Form.Item</span>&gt;</span>&#125;</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">Form</span>&gt;</span></span></span><br><span class="line">  )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>通过监听表单的 <code>onValuesChange</code> 事件来修改 <code>state</code> ，<code>state</code> 值来驱动表单项的显示</p>
<h3 id="自定义组件-children-的渲染实现"><a href="#自定义组件-children-的渲染实现" class="headerlink" title="自定义组件 children 的渲染实现"></a>自定义组件 <code>children</code> 的渲染实现</h3><figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">Advertise</span>(<span class="params"><span class="attr">props</span>: <span class="title class_">RadioGroupProps</span></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; value, children, defaultValue, ...otherProps &#125; = props</span><br><span class="line">  <span class="keyword">const</span> isShowChildren =</span><br><span class="line">    (<span class="title function_">isUndefined</span>(value) &amp;&amp; defaultValue === <span class="number">1</span>) || value === <span class="number">1</span></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">Radio.Group</span> &#123;<span class="attr">...otherProps</span>&#125; <span class="attr">value</span>=<span class="string">&#123;value&#125;</span> <span class="attr">defaultValue</span>=<span class="string">&#123;defaultValue&#125;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        &#123;AdActList.map((item) =&gt; (</span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">Radio</span> <span class="attr">key</span>=<span class="string">&#123;item.value&#125;</span> <span class="attr">value</span>=<span class="string">&#123;item.value&#125;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            &#123;item.label&#125;</span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;/<span class="name">Radio</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        ))&#125;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">Radio.Group</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      &#123;isShowChildren &amp;&amp; children&#125;</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/&gt;</span></span></span><br><span class="line">  )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>通过自定义的表单驱动其它元素的渲染，把逻辑收束到组件内</p>
<h5 id="提示：参考-antd-官方文档实现子定义表单控件"><a href="#提示：参考-antd-官方文档实现子定义表单控件" class="headerlink" title="提示：参考 antd 官方文档实现子定义表单控件"></a>提示：参考 <code>antd</code> 官方文档实现子定义表单控件</h5><h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><ul>
<li><a href="https://ant.design/components/form-cn/">antd form 表单</a></li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2022/01/02/antd%E4%B8%ADform%E8%A1%A8%E5%8D%95%E8%81%94%E5%8A%A8/" data-id="cm1ghkbmj000dzodzh6c8cimr" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/JavaScript/" rel="tag">JavaScript</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/antd/" rel="tag">antd</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/form/" rel="tag">form</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-chorme插件开发（一）" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2021/12/12/chorme%E6%8F%92%E4%BB%B6%E5%BC%80%E5%8F%91%EF%BC%88%E4%B8%80%EF%BC%89/" class="article-date">
  <time datetime="2021-12-12T15:10:30.000Z" itemprop="datePublished">2021-12-12</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2021/12/12/chorme%E6%8F%92%E4%BB%B6%E5%BC%80%E5%8F%91%EF%BC%88%E4%B8%80%EF%BC%89/">chorme插件开发（一）</a>
    </h1>
  


        <div style="color: #999; margin-top: 0.3rem" class="post-meta-item"> 共计
    866 字，约需阅读
    3.15
    分钟
</div>
      </header>
    
    
   

    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="概览"><a href="#概览" class="headerlink" title="概览"></a>概览</h3><p>谷歌浏览器插件是一种小型的用于定制浏览器体验的程序。每个插件必须在根目录包含 <code>manifest.json</code> 来描述插件，其文件结构如下</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">| 插件根目录</span><br><span class="line">|--- manifest.json // 插件描述文件</span><br><span class="line">|--- 其它文件（图标、js 、css 等）</span><br></pre></td></tr></table></figure>

<h4 id="manifest-json"><a href="#manifest-json" class="headerlink" title="manifest.json"></a><code>manifest.json</code></h4><p>用来描述插件信息，声明插件需要的权限及相关功能的路径</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="comment">// 必须</span></span><br><span class="line">  <span class="attr">&quot;manifest_version&quot;</span><span class="punctuation">:</span> <span class="number">3</span><span class="punctuation">,</span> <span class="comment">// 插件版本，建议使用最新版本 v3</span></span><br><span class="line">  <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;My Extension&quot;</span><span class="punctuation">,</span> <span class="comment">// 插件名称</span></span><br><span class="line">  <span class="attr">&quot;version&quot;</span><span class="punctuation">:</span> <span class="string">&quot;versionString&quot;</span><span class="punctuation">,</span> <span class="comment">// 插件版本</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// Recommended</span></span><br><span class="line">  <span class="attr">&quot;action&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span>...<span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;default_locale&quot;</span><span class="punctuation">:</span> <span class="string">&quot;en&quot;</span><span class="punctuation">,</span> <span class="comment">// 默认语言</span></span><br><span class="line">  <span class="attr">&quot;description&quot;</span><span class="punctuation">:</span> <span class="string">&quot;A plain text description&quot;</span><span class="punctuation">,</span> <span class="comment">// 插件描述</span></span><br><span class="line">  <span class="attr">&quot;icons&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span>...<span class="punctuation">&#125;</span><span class="punctuation">,</span> <span class="comment">// 插件图标</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// Optional</span></span><br><span class="line">  <span class="attr">&quot;author&quot;</span><span class="punctuation">:</span> ...<span class="punctuation">,</span> <span class="comment">// 作者</span></span><br><span class="line">  <span class="attr">&quot;automation&quot;</span><span class="punctuation">:</span> ...<span class="punctuation">,</span> <span class="comment">//</span></span><br><span class="line">  <span class="attr">&quot;background&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="comment">// Required</span></span><br><span class="line">    <span class="attr">&quot;service_worker&quot;</span><span class="punctuation">:</span> <span class="string">&quot;background.js&quot;</span><span class="punctuation">,</span> <span class="comment">// background js</span></span><br><span class="line">    <span class="comment">// Optional</span></span><br><span class="line">    <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> ...</span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line"><span class="comment">//   &quot;chrome_settings_overrides&quot;: &#123;...&#125;, // 已不再支持</span></span><br><span class="line"><span class="comment">//   &quot;chrome_url_overrides&quot;: &#123;...&#125;, //  已不再支持</span></span><br><span class="line">  <span class="attr">&quot;commands&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span>...<span class="punctuation">&#125;</span><span class="punctuation">,</span> <span class="comment">// 插件自定义右键菜单</span></span><br><span class="line">  <span class="attr">&quot;content_capabilities&quot;</span><span class="punctuation">:</span> ...<span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;content_scripts&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">&#123;</span>...<span class="punctuation">&#125;</span><span class="punctuation">]</span><span class="punctuation">,</span> <span class="comment">// web 页面上下文中执行的 js ，可通过其实现页面与插件其它 js 的通信</span></span><br><span class="line">  <span class="attr">&quot;content_security_policy&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span>...<span class="punctuation">&#125;</span><span class="punctuation">,</span> <span class="comment">// 安全策略</span></span><br><span class="line"><span class="comment">//   &quot;converted_from_user_script&quot;: ...,</span></span><br><span class="line"><span class="comment">//   &quot;cross_origin_embedder_policy&quot;: &#123;&quot;value&quot;: &quot;require-corp&quot;&#125;,</span></span><br><span class="line"><span class="comment">//   &quot;cross_origin_opener_policy&quot;: &#123;&quot;value&quot;: &quot;same-origin&quot;&#125;,</span></span><br><span class="line"><span class="comment">//   &quot;current_locale&quot;: ...,</span></span><br><span class="line"><span class="comment">//   &quot;declarative_net_request&quot;: ...,</span></span><br><span class="line">  <span class="attr">&quot;devtools_page&quot;</span><span class="punctuation">:</span> <span class="string">&quot;devtools.html&quot;</span><span class="punctuation">,</span> <span class="comment">// 自定义的开发者工具页面</span></span><br><span class="line"><span class="comment">//   &quot;differential_fingerprint&quot;: ...,</span></span><br><span class="line"><span class="comment">//   &quot;event_rules&quot;: [&#123;...&#125;],</span></span><br><span class="line"><span class="comment">//   &quot;externally_connectable&quot;: &#123;</span></span><br><span class="line"><span class="comment">//     &quot;matches&quot;: [&quot;*://*.example.com/*&quot;]</span></span><br><span class="line"><span class="comment">//   &#125;,</span></span><br><span class="line"><span class="comment">//   &quot;file_browser_handlers&quot;: [...],</span></span><br><span class="line"><span class="comment">//   &quot;file_system_provider_capabilities&quot;: &#123;</span></span><br><span class="line"><span class="comment">//     &quot;configurable&quot;: true,</span></span><br><span class="line"><span class="comment">//     &quot;multiple_mounts&quot;: true,</span></span><br><span class="line"><span class="comment">//     &quot;source&quot;: &quot;network&quot;</span></span><br><span class="line"><span class="comment">//   &#125;,</span></span><br><span class="line">  <span class="attr">&quot;homepage_url&quot;</span><span class="punctuation">:</span> <span class="string">&quot;https://path/to/homepage&quot;</span><span class="punctuation">,</span> <span class="comment">// 插件首页</span></span><br><span class="line"><span class="comment">//   &quot;host_permissions&quot;: [...],</span></span><br><span class="line"><span class="comment">//   &quot;import&quot;: [&#123;&quot;id&quot;: &quot;aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa&quot;&#125;],</span></span><br><span class="line"><span class="comment">//   &quot;incognito&quot;: &quot;spanning, split, or not_allowed&quot;,</span></span><br><span class="line"><span class="comment">//   &quot;input_components&quot;: ...,</span></span><br><span class="line"><span class="comment">//   &quot;key&quot;: &quot;publicKey&quot;,</span></span><br><span class="line"><span class="comment">//   &quot;minimum_chrome_version&quot;: &quot;versionString&quot;,</span></span><br><span class="line"><span class="comment">//   &quot;nacl_modules&quot;: [...],</span></span><br><span class="line"><span class="comment">//   &quot;natively_connectable&quot;: ...,</span></span><br><span class="line"><span class="comment">//   &quot;oauth2&quot;: ...,</span></span><br><span class="line"><span class="comment">//   &quot;offline_enabled&quot;: true,</span></span><br><span class="line"><span class="comment">//   &quot;omnibox&quot;: &#123;</span></span><br><span class="line"><span class="comment">//     &quot;keyword&quot;: &quot;aString&quot;</span></span><br><span class="line"><span class="comment">//   &#125;,</span></span><br><span class="line">  <span class="attr">&quot;optional_permissions&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;tabs&quot;</span><span class="punctuation">]</span><span class="punctuation">,</span> <span class="comment">// 可选的权限</span></span><br><span class="line">  <span class="attr">&quot;options_page&quot;</span><span class="punctuation">:</span> <span class="string">&quot;options.html&quot;</span><span class="punctuation">,</span> <span class="comment">// option 页面</span></span><br><span class="line">  <span class="attr">&quot;options_ui&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;chrome_style&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;page&quot;</span><span class="punctuation">:</span> <span class="string">&quot;options.html&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;permissions&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;tabs&quot;</span><span class="punctuation">]</span><span class="punctuation">,</span> <span class="comment">// 插件需要的权限，需要在这里声明之后才能使用相关权限</span></span><br><span class="line"><span class="comment">//   &quot;platforms&quot;: ...,</span></span><br><span class="line"><span class="comment">//   &quot;replacement_web_app&quot;: ...,</span></span><br><span class="line"><span class="comment">//   &quot;requirements&quot;: &#123;...&#125;,</span></span><br><span class="line"><span class="comment">//   &quot;sandbox&quot;: [...],</span></span><br><span class="line"><span class="comment">//   &quot;short_name&quot;: &quot;Short Name&quot;,</span></span><br><span class="line"><span class="comment">//   &quot;storage&quot;: &#123;</span></span><br><span class="line"><span class="comment">//     &quot;managed_schema&quot;: &quot;schema.json&quot;</span></span><br><span class="line"><span class="comment">//   &#125;,</span></span><br><span class="line"><span class="comment">//   &quot;system_indicator&quot;: ...,</span></span><br><span class="line"><span class="comment">//   &quot;tts_engine&quot;: &#123;...&#125;,</span></span><br><span class="line"><span class="comment">//   &quot;update_url&quot;: &quot;https://path/to/updateInfo.xml&quot;,</span></span><br><span class="line"><span class="comment">//   &quot;version_name&quot;: &quot;aString&quot;,</span></span><br><span class="line"><span class="comment">//   &quot;web_accessible_resources&quot;: [...]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h5 id="content-scripts"><a href="#content-scripts" class="headerlink" title="content_scripts"></a><code>content_scripts</code></h5><p><code>Chrome</code> 插件中向页面注入脚本的一种形式（虽然名为 <code>script</code>，其实还可以包括 <code>css</code> 的），借助 <code>content-scripts</code> 我们可以实现通过配置的方式轻松向指定页面注入 <code>JS</code> 和 <code>CSS</code></p>
<h5 id="background"><a href="#background" class="headerlink" title="background"></a><code>background</code></h5><p>一个常驻的页面，它的生命周期是插件中所有类型页面中最长的，它随着浏览器的打开而打开，随着浏览器的关闭而关闭，所以通常把需要一直运行的、启动就运行的、全局的代码放在 <code>background</code> 里面。</p>
<h5 id="popup"><a href="#popup" class="headerlink" title="popup"></a><code>popup</code></h5><p>点击 <code>browser_action</code> 或者 <code>page_action</code> 图标时打开的一个小窗口网页，焦点离开网页就立即关闭，一般用来做一些临时性的交互。</p>
<h5 id="homepage-url"><a href="#homepage-url" class="headerlink" title="homepage_url"></a><code>homepage_url</code></h5><p>开发者或者插件主页设置</p>
<h3 id="开发"><a href="#开发" class="headerlink" title="开发"></a>开发</h3><ol>
<li>创建好插件文件夹，添加 <code>manifest.json</code>，输入如下内容</li>
</ol>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;manifest_version&quot;</span><span class="punctuation">:</span> <span class="number">3</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;插件测试&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;version&quot;</span><span class="punctuation">:</span> <span class="string">&quot;0.0.1&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<ol start="2">
<li>在浏览器中访问 <code>chrome://extensions</code>，打开开发者模式。<br><img src="/images/chrome/plugins-develop-mode.png" alt="charles 代理转发"></li>
<li>加载解压的插件<br><img src="/images/chrome/plugins-develop-load.png" alt="charles 代理转发"></li>
</ol>
<h3 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h3><ul>
<li><a href="https://www.cnblogs.com/liuxianan/p/chrome-plugin-develop.html">【干货】Chrome 插件(扩展)开发全攻略</a></li>
<li><a href="https://developer.chrome.com/docs/extensions/mv3/manifest/">manifest 文件概览</a></li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/12/12/chorme%E6%8F%92%E4%BB%B6%E5%BC%80%E5%8F%91%EF%BC%88%E4%B8%80%EF%BC%89/" data-id="cm1ghkbml000jzodzail2164h" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/JavaScript/" rel="tag">JavaScript</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E6%8F%92%E4%BB%B6/" rel="tag">插件</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E6%B5%8F%E8%A7%88%E5%99%A8/" rel="tag">浏览器</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-代理" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2021/10/24/%E4%BB%A3%E7%90%86/" class="article-date">
  <time datetime="2021-10-23T21:30:23.000Z" itemprop="datePublished">2021-10-23</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2021/10/24/%E4%BB%A3%E7%90%86/">代理</a>
    </h1>
  


        <div style="color: #999; margin-top: 0.3rem" class="post-meta-item"> 共计
    601 字，约需阅读
    2.19
    分钟
</div>
      </header>
    
    
   

    <div class="article-entry" itemprop="articleBody">
      
        <p>前端开发时，需要 <code>mock</code> 或请求对应的数据，选择一种合适的方式获取数据可以大大提高开发效率</p>
<h2 id="获取数据方式"><a href="#获取数据方式" class="headerlink" title="获取数据方式"></a>获取数据方式</h2><h3 id="本地-mock"><a href="#本地-mock" class="headerlink" title="本地 mock"></a>本地 mock</h3><ul>
<li>页面接口请求到达 <code>dev server</code> 之后会转发到 <code>mock</code> 服务上，然后返回 <code>mock</code> 数据</li>
<li>页面静态资源请求会到达 <code>dev server</code> ，然后直接返回静态资源</li>
</ul>
<p><img src="/images/api/dev_server_mock.svg" alt="本地 mock 数据请求流程"></p>
<h4 id="优点"><a href="#优点" class="headerlink" title="优点"></a>优点</h4><ul>
<li><code>mock</code> 数据只需要配置一次，无需后续的额外操作</li>
</ul>
<h4 id="缺点"><a href="#缺点" class="headerlink" title="缺点"></a>缺点</h4><ul>
<li>无法服用线上接口数据</li>
<li>项目中可能会出现许多 <code>mock</code> 数据相关的代码</li>
<li>接口之间无关联性</li>
</ul>
<h3 id="直接请求线上数据"><a href="#直接请求线上数据" class="headerlink" title="直接请求线上数据"></a>直接请求线上数据</h3><ul>
<li>页面静态资源请求会到达 <code>dev server</code> ，然后直接返回静态资源</li>
<li>通过绝对地址或者浏览器代理的方式转发请求到线上服务</li>
</ul>
<p><img src="/images/api/online_server.svg" alt="直接请求线上数据"></p>
<h4 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h4><ul>
<li>通过硬编码绝对路径的方式对代码入侵较大，可以通过浏览器代理插件的方式实现对接口的转发</li>
<li>当接口需要登陆时，可在浏览器插件中实现注入对应环境 <code>cookie</code> 的功能</li>
</ul>
<h4 id="优点-1"><a href="#优点-1" class="headerlink" title="优点"></a>优点</h4><ul>
<li>可以复用线上接口数据</li>
<li>接口之间存在联动和业务逻辑</li>
</ul>
<h4 id="缺点-1"><a href="#缺点-1" class="headerlink" title="缺点"></a>缺点</h4><ul>
<li>需要安装额外的插件</li>
<li>需要在项目之外做额外的配置</li>
</ul>
<h3 id="devServer-代理转发"><a href="#devServer-代理转发" class="headerlink" title="devServer 代理转发"></a>devServer 代理转发</h3><ul>
<li>页面静态资源请求会到达 <code>dev server</code> ，然后直接返回静态资源</li>
<li>通过 <code>dve server</code> 把接口代理转发到对应服务上</li>
</ul>
<p><img src="/images/api/dev_server_proxy.svg" alt="devServer 代理转发请求线上数据"></p>
<h4 id="问题-1"><a href="#问题-1" class="headerlink" title="问题"></a>问题</h4><ul>
<li>当接口需要登陆时，可在浏览器插件中实现把对应环境 <code>cookie</code> 注入到开发服务页面下的功能</li>
</ul>
<h4 id="优点-2"><a href="#优点-2" class="headerlink" title="优点"></a>优点</h4><ul>
<li>可以复用线上接口数据</li>
<li>接口之间存在联动和业务逻辑</li>
</ul>
<h4 id="缺点-2"><a href="#缺点-2" class="headerlink" title="缺点"></a>缺点</h4><ul>
<li>需要安装额外的插件</li>
<li>需要在项目之外做额外的配置</li>
</ul>
<h3 id="charles-代理转发"><a href="#charles-代理转发" class="headerlink" title="charles 代理转发"></a>charles 代理转发</h3><ul>
<li>页面静态资源会按照规则转发到 <code>dev server</code>上，然后直接返回静态资源</li>
<li>接口请求会按照规则转发到远端服务</li>
</ul>
<p><img src="/images/api/charles_proxy.svg" alt="charles 代理转发"></p>
<h4 id="问题-2"><a href="#问题-2" class="headerlink" title="问题"></a>问题</h4><ul>
<li>当接口需要登陆时，本地服务转发需要先注入对应环境的 <code>cookie</code> 才可以请求</li>
</ul>
<h4 id="优点-3"><a href="#优点-3" class="headerlink" title="优点"></a>优点</h4><ul>
<li>可以复用线上接口数据</li>
<li>接口之间存在联动和业务逻辑</li>
<li>便于切换环境和账号</li>
</ul>
<h4 id="缺点-3"><a href="#缺点-3" class="headerlink" title="缺点"></a>缺点</h4><ul>
<li>需要安装额外的软件</li>
<li>需要学习 charles 相关的配置</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/10/24/%E4%BB%A3%E7%90%86/" data-id="cm1ghkbnf004izodz9tj7bw75" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/node/" rel="tag">node</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/network/" rel="tag">计算机网络</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-计算机网络-DNS" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2021/08/16/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C-DNS/" class="article-date">
  <time datetime="2021-08-15T23:05:40.000Z" itemprop="datePublished">2021-08-15</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2021/08/16/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C-DNS/">计算机网络-DNS</a>
    </h1>
  


        <div style="color: #999; margin-top: 0.3rem" class="post-meta-item"> 共计
    640 字，约需阅读
    2.33
    分钟
</div>
      </header>
    
    
   

    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h2><p>通常通过 <code>baidu.com</code> 访问百度的服务，这个 <code>baidu.com</code> 就是百度持有的域名（Domain Name），然而在网络中能够识别的只有 <code>IP</code> ，那就需要把域名转化为对应的 <code>IP</code> 地址。</p>
<h2 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h2><p><code>DNS</code> 全名叫做 <code>Domain Name System</code>, 中文叫做 <code>域名服务系统</code>，主要作用是把域名转化为网络中对应的 <code>IP</code> 地址。</p>
<h2 id="工作原理（以浏览器为例）"><a href="#工作原理（以浏览器为例）" class="headerlink" title="工作原理（以浏览器为例）"></a>工作原理（以浏览器为例）</h2><p><img src="/images/network/dns.svg" alt="浏览器解析域名流程"></p>
<ol>
<li>浏览器解析出地址栏中的域名</li>
<li>在浏览器缓存中查找是否有缓存此域名的地址</li>
<li>在系统中是否有缓存此域名的地址</li>
<li>通过 <code>UDP</code> 的方式向系统中配置的 <code>DNS</code> 服务器查找域名对应的 <code>IP</code> 地址</li>
<li><code>DNS</code> 服务器通过 <code>UDP</code> 向根域名服务器查找域名地址，根域名服务器返回下一个查找的顶级域名服务器的 <code>IP</code> 地址</li>
<li><code>DNS</code> 服务器通过 <code>UDP</code> 向顶级域名服务器查找域名地址，顶级域名服务器返回下一个查找域名服务器的 <code>IP</code> 地址，不断查找，直到找到域名对应的 <code>IP</code> 地址为止</li>
<li><code>DNS</code> 服务器返回域名服务器的地址</li>
</ol>
<h4 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h4><ul>
<li>域名分别在浏览器、操作系统、域名服务器三个层级做了缓存以提高访问速度</li>
<li>获取域名时浏览器调用了操作系统的能力委托操作系统到操作系统配置的域名服务器上进行域名查找</li>
<li>浏览器通过递归的方式分别去浏览器、操作系统和域名服务器上查找，而域名服务器是通过迭代的方式去各级域名服务器上进行查找的</li>
</ul>
<h3 id="各层级域名节点"><a href="#各层级域名节点" class="headerlink" title="各层级域名节点"></a>各层级域名节点</h3><ul>
<li>域名服务器具有层级关系</li>
<li>每个层级的域名服务器都存储了根域名服务器的地址信息，这样方便快速查找域名服务的信息</li>
<li>每个层级的域名服务器都需要注册到其对应的上一级域名服务器中</li>
</ul>
<p><img src="/images/network/dns-node.svg" alt="域名服务器节点关系图"></p>
<h2 id="域名服务数据更新"><a href="#域名服务数据更新" class="headerlink" title="域名服务数据更新"></a>域名服务数据更新</h2><p>当域名服务系统数据有变化时就需要去更新对应的数据</p>
<ul>
<li>当根域名服务器地址有变化时，各级域名服务需要通过 <code>TCP</code> 的方式更新对应的数据</li>
<li>当有新的子域名服务器注册或者域名信息注销时需要子域名通过 <code>TCP</code> 的方式把更新信息同步到当前域名服务</li>
</ul>
<p><img src="/images/network/dns-update.svg" alt="域名服务器更新数据图"></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/08/16/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C-DNS/" data-id="cm1ghkbnn005pzodza9285pdm" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/network/" rel="tag">计算机网络</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-服务端渲染" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2021/08/08/%E6%9C%8D%E5%8A%A1%E7%AB%AF%E6%B8%B2%E6%9F%93/" class="article-date">
  <time datetime="2021-08-08T13:14:02.000Z" itemprop="datePublished">2021-08-08</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2021/08/08/%E6%9C%8D%E5%8A%A1%E7%AB%AF%E6%B8%B2%E6%9F%93/">服务端渲染</a>
    </h1>
  


        <div style="color: #999; margin-top: 0.3rem" class="post-meta-item"> 共计
    580 字，约需阅读
    2.11
    分钟
</div>
      </header>
    
    
   

    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="同构应用"><a href="#同构应用" class="headerlink" title="同构应用"></a>同构应用</h2><h3 id="环境区分"><a href="#环境区分" class="headerlink" title="环境区分"></a>环境区分</h3><p>服务端和客户端所处环境有些许区别，打包时要根据不同环境打包出对应的资源</p>
<h4 id="路由代码"><a href="#路由代码" class="headerlink" title="路由代码"></a>路由代码</h4><ul>
<li>服务端从请求对象中获取路径，需要先从请求对象中提取出路径之后再通过上下文传递进应用之中</li>
<li>客户端从全局路由对象中获取路径进行匹配</li>
</ul>
<h4 id="打包"><a href="#打包" class="headerlink" title="打包"></a>打包</h4><ul>
<li>服务端的依赖可以直接从依赖中获取，而客户端则需要把所有依赖打包到对应的 <code>chunk</code> 中</li>
<li>服务端不关心样式问题，而客户端需要加载对应的样式</li>
<li>分环境进行打包时，会导致部分资源重复打包和覆盖</li>
</ul>
<h3 id="注水和脱水"><a href="#注水和脱水" class="headerlink" title="注水和脱水"></a>注水和脱水</h3><p>服务端渲染时可能会通过接口请求数据，并保存准备好的数据状态，避免客户端做重复的请求</p>
<ul>
<li>脱水：服务端返回 <code>HTML</code> 时需要把数据状态通过字符串的形式保存在 <code>HTML</code> 字符串中。</li>
<li>注水：客户端通过 <code>HTML</code> 中格式化后的数据初始化状态。</li>
</ul>
<h4 id="服务端请求"><a href="#服务端请求" class="headerlink" title="服务端请求"></a>服务端请求</h4><ul>
<li>通过配置文件的方式统一声明服务端需要请求的数据</li>
<li>通过组件静态方法统一处理请求（需要框架遍历每个组件的属性去请求数据）</li>
</ul>
<h3 id="请求认证"><a href="#请求认证" class="headerlink" title="请求认证"></a>请求认证</h3><p>服务端请求时不会自动携带客户端传递来的信息（例如 <code>cookie</code>） ，需要手动把请求中的字段提取出来放入服务端的请求中</p>
<h3 id="样式处理"><a href="#样式处理" class="headerlink" title="样式处理"></a>样式处理</h3><p>服务端渲染时不需要样式，但是客户端渲染时需要处理样式问题，若通过外部引入会造成在客户端样式的抖动</p>
<h3 id="meta-tags-处理"><a href="#meta-tags-处理" class="headerlink" title="meta tags 处理"></a>meta tags 处理</h3><p>客户端和服务端渲染时有时需要动态修改 <code>head</code> 里的信息（SEO）</p>
<h3 id="404-处理"><a href="#404-处理" class="headerlink" title="404 处理"></a>404 处理</h3><p>当服务端匹配不到页面时，应该返回一个 <code>404</code> 的状态码和对应的内容</p>
<h3 id="安全问题"><a href="#安全问题" class="headerlink" title="安全问题"></a>安全问题</h3><p>上述注水和脱水过程中容易存在 <code>script</code> 脚本注入的风险，在序列化之前需要对对象做转义</p>
<h3 id="性能优化"><a href="#性能优化" class="headerlink" title="性能优化"></a>性能优化</h3><ul>
<li>缓存</li>
<li>单服务改为服务集群</li>
<li>服务压力过大时改成客户端渲染</li>
<li>升级 <code>Nodejs</code></li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/08/08/%E6%9C%8D%E5%8A%A1%E7%AB%AF%E6%B8%B2%E6%9F%93/" data-id="cm1ghkbni004vzodze4qegplk" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/JavaScript/" rel="tag">JavaScript</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/node/" rel="tag">node</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/react/" rel="tag">react</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-简易的express中间件" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2021/08/07/%E7%AE%80%E6%98%93%E7%9A%84express%E4%B8%AD%E9%97%B4%E4%BB%B6/" class="article-date">
  <time datetime="2021-08-07T14:51:11.000Z" itemprop="datePublished">2021-08-07</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2021/08/07/%E7%AE%80%E6%98%93%E7%9A%84express%E4%B8%AD%E9%97%B4%E4%BB%B6/">简易的express中间件</a>
    </h1>
  


        <div style="color: #999; margin-top: 0.3rem" class="post-meta-item"> 共计
    269 字，约需阅读
    0.98
    分钟
</div>
      </header>
    
    
   

    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="express"><a href="#express" class="headerlink" title="express"></a>express</h2><p>基于 <code>Node.js</code> 平台，快速、开放、极简的 <code>Web</code> 开发框架</p>
<h3 id="中间件"><a href="#中间件" class="headerlink" title="中间件"></a>中间件</h3><p>从请求到相应过程中执行的一系列函数被称为中间件，使其具有了极高的扩展性</p>
<h4 id="注册"><a href="#注册" class="headerlink" title="注册"></a>注册</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">app.<span class="title function_">use</span>(<span class="keyword">function</span> <span class="title function_">middware1</span>(<span class="params">req, res, next</span>) &#123;</span><br><span class="line">  <span class="comment">// 业务逻辑</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">use</span>(<span class="string">&#x27;/test&#x27;</span>, <span class="keyword">function</span> <span class="title function_">middware2</span>(<span class="params">req, res, next</span>) &#123;</span><br><span class="line">  <span class="comment">// 业务逻辑</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h4 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h4><p>当请求 <code>/test</code> 时，会按照 <code>middware1</code> -&gt; <code>middware2</code> 的顺序依次执行注册的中间件</p>
<h4 id="简易实现"><a href="#简易实现" class="headerlink" title="简易实现"></a>简易实现</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">isMathch</span>(<span class="params">source, match</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> source.<span class="title function_">startsWith</span>(match)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> express = &#123;</span><br><span class="line">  <span class="attr">middwares</span>: [],</span><br><span class="line">  <span class="attr">use</span>: <span class="keyword">function</span> (<span class="params">path, fun</span>) &#123;</span><br><span class="line">    <span class="comment">// 把注册的中间件放入 middwares 数组中</span></span><br><span class="line">    <span class="keyword">let</span> handler = fun</span><br><span class="line">    <span class="keyword">let</span> matchPath = path</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> fun === <span class="string">&#x27;undefined&#x27;</span>) &#123;</span><br><span class="line">      matchPath = <span class="string">&#x27;/&#x27;</span></span><br><span class="line">      handler = path</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">middwares</span>.<span class="title function_">push</span>(&#123; handler, <span class="attr">path</span>: matchPath &#125;)</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">call</span>: <span class="keyword">function</span> (<span class="params">req, res</span>) &#123;</span><br><span class="line">    <span class="comment">// 从 middwares 中提取匹配的中间件执行</span></span><br><span class="line">    <span class="keyword">const</span> &#123; pathname = <span class="string">&#x27;/&#x27;</span> &#125; = req</span><br><span class="line">    <span class="keyword">const</span> middwares = <span class="variable language_">this</span>.<span class="property">middwares</span>.<span class="title function_">filter</span>(<span class="function">(<span class="params">item</span>) =&gt;</span></span><br><span class="line">      <span class="title function_">isMathch</span>(pathname, item.<span class="property">path</span>)</span><br><span class="line">    )</span><br><span class="line">    <span class="keyword">const</span> len = middwares.<span class="property">length</span></span><br><span class="line">    <span class="keyword">let</span> index = -<span class="number">1</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 通过 index 控制执行的中间件</span></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">next</span>(<span class="params">err</span>) &#123;</span><br><span class="line">      index++</span><br><span class="line">      <span class="keyword">if</span> (index &lt; len) &#123;</span><br><span class="line">        middwares[index].<span class="title function_">handler</span>(req, res, next)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">next</span>()</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>express 调度实现<a href="https://github.com/expressjs/express/blob/master/lib/router/route.js#L98">链接</a></li>
<li>express use 实现<a href="https://github.com/expressjs/express/blob/master/lib/application.js#L187">链接</a></li>
</ul>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><ul>
<li><a href="https://www.expressjs.com.cn/guide/writing-middleware.html">expressjs</a></li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/08/07/%E7%AE%80%E6%98%93%E7%9A%84express%E4%B8%AD%E9%97%B4%E4%BB%B6/" data-id="cm1ghkbnm005jzodzagtd1yih" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/JavaScript/" rel="tag">JavaScript</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/node/" rel="tag">node</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-跨域" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2021/08/06/%E8%B7%A8%E5%9F%9F/" class="article-date">
  <time datetime="2021-08-05T22:58:08.000Z" itemprop="datePublished">2021-08-05</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2021/08/06/%E8%B7%A8%E5%9F%9F/">跨域</a>
    </h1>
  


        <div style="color: #999; margin-top: 0.3rem" class="post-meta-item"> 共计
    1.3k 字，约需阅读
    4.73
    分钟
</div>
      </header>
    
    
   

    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="同源策略"><a href="#同源策略" class="headerlink" title="同源策略"></a>同源策略</h2><p>当”协议+域名+端口”三者相同时，才能够相互访问资源。保证用户信息的安全，防止恶意的网站窃取数据。</p>
<h3 id="限制"><a href="#限制" class="headerlink" title="限制"></a>限制</h3><ul>
<li>当前域下的 <code>js</code> 脚本不能够访问其他域下的 <code>cookie</code>、<code>localStorage</code> 和 <code>indexDB</code> 等本地存储</li>
<li>当前域下的 <code>js</code> 脚本不能够操作访问操作其他域下的 <code>DOM</code>。</li>
<li>当前域下 <code>ajax</code> 无法发送跨域请求。</li>
</ul>
<h2 id="跨域访问"><a href="#跨域访问" class="headerlink" title="跨域访问"></a>跨域访问</h2><h3 id="CORS"><a href="#CORS" class="headerlink" title="CORS"></a>CORS</h3><p>跨域资源共享(CORS) 是一种机制，它使用额外的 HTTP 头来告诉浏览器让运行在一个 origin (domain)上的 Web 应用被准许访问来自不同源服务器上的指定的资源。当一个资源从与该资源本身所在的服务器不同的域、协议或端口请求一个资源时，资源会发起一个跨域 HTTP 请求。</p>
<h4 id="简单请求"><a href="#简单请求" class="headerlink" title="简单请求"></a>简单请求</h4><p>简单请求不会触发 CORS 预检请求。需要满足以下条件才能成为简单请求</p>
<h5 id="请求方法"><a href="#请求方法" class="headerlink" title="请求方法"></a>请求方法</h5><ul>
<li>HEAD</li>
<li>GET</li>
<li>POST</li>
</ul>
<h5 id="HTTP-的头信息"><a href="#HTTP-的头信息" class="headerlink" title="HTTP 的头信息"></a>HTTP 的头信息</h5><p>不超出以下几种字段：</p>
<ul>
<li>Accept</li>
<li>Accept-Language</li>
<li>Content-Language</li>
<li>Last-Event-ID</li>
<li>Content-Type：只限于三个值 application&#x2F;x-www-form-urlencoded、multipart&#x2F;form-data、text&#x2F;plain</li>
</ul>
<h5 id="请求过程"><a href="#请求过程" class="headerlink" title="请求过程"></a>请求过程</h5><ol>
<li>浏览器会直接发出 CORS 请求，它会在请求的头信息中增加一个 Orign 字段，该字段用来说明本次请求来自哪个源（协议+端口+域名）</li>
<li>服务器会根据 origin 值来决定是否同意这次请求</li>
</ol>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">Access-Control-Allow-Origin:</span> <span class="string">http://api.baidu.com</span>  <span class="string">//</span> <span class="string">和</span> <span class="string">Orign</span> <span class="string">一致，必须要包含，可以为</span> <span class="string">*</span></span><br><span class="line"><span class="attr">Access-Control-Allow-Credentials:</span> <span class="literal">true</span>   <span class="string">//</span> <span class="string">表示是否允许发送Cookie</span></span><br><span class="line"><span class="attr">Access-Control-Expose-Headers:</span> <span class="string">FooBar</span>   <span class="string">//</span> <span class="string">指定返回其他字段的值</span></span><br></pre></td></tr></table></figure>

<h4 id="非简单请求过程"><a href="#非简单请求过程" class="headerlink" title="非简单请求过程"></a>非简单请求过程</h4><p>在正式通信之前进行一次 HTTP 查询请求，称为预检请求</p>
<h5 id="请求过程-1"><a href="#请求过程-1" class="headerlink" title="请求过程"></a>请求过程</h5><ol>
<li>使用 <code>OPTIONS</code> 方法向服务端发起预检请求</li>
</ol>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">Access-Control-Request-Method：该字段是必须的，用来列出浏览器的</span> <span class="string">CORS</span> <span class="string">请求会用到哪些</span> <span class="string">HTTP</span> <span class="string">方法。</span></span><br><span class="line"><span class="string">Access-Control-Request-Headers：</span> <span class="string">该字段是一个逗号分隔的字符串，指定浏览器</span> <span class="string">CORS</span> <span class="string">请求会额外发送的头信息字段。</span></span><br></pre></td></tr></table></figure>

<ol start="2">
<li>服务器在收到浏览器的预检请求之后，会根据头信息的三个字段来进行判断是否允许跨域</li>
</ol>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">Access-Control-Allow-Origin:</span> <span class="string">http://api.baidu.com</span>  <span class="string">//</span> <span class="string">允许跨域的源地址（必须）</span></span><br><span class="line"><span class="attr">Access-Control-Allow-Methods:</span> <span class="string">GET,</span> <span class="string">POST,</span> <span class="string">PUT</span> <span class="string">//</span> <span class="string">服务器支持的所有跨域请求的方法（必须）</span></span><br><span class="line"><span class="attr">Access-Control-Allow-Headers:</span> <span class="string">X-Custom-Header</span>  <span class="string">//</span> <span class="string">服务器支持的所有头信息字段（必须）</span></span><br><span class="line"><span class="attr">Access-Control-Allow-Credentials:</span> <span class="literal">true</span>   <span class="string">//</span> <span class="string">表示是否允许发送Cookie</span></span><br><span class="line"><span class="attr">Access-Control-Max-Age:</span> <span class="number">1728000</span>  <span class="string">//</span> <span class="string">用来指定本次预检请求的有效期，单位为秒</span></span><br></pre></td></tr></table></figure>

<h5 id="Cookie-相关问题"><a href="#Cookie-相关问题" class="headerlink" title="Cookie 相关问题"></a>Cookie 相关问题</h5><ol>
<li>默认情况下在跨域请求，浏览器是不带 cookie 的。但是我们可以通过设置 withCredentials 来进行传递 cookie.</li>
<li>Access-Control-Allow-Credentials 设置为 true</li>
<li>Access-Control-Allow-Origin 设置为非 <code>*</code></li>
</ol>
<h3 id="JSONP"><a href="#JSONP" class="headerlink" title="JSONP"></a>JSONP</h3><p>利用<code>&lt;script&gt;</code> 标签没有跨域限制，通过<code>&lt;script&gt;</code>标签 src 属性，发送带有 callback 参数的 GET 请求，服务端将接口返回数据拼凑到 callback 函数中，返回给浏览器，浏览器解析执行，从而前端拿到 callback 函数返回的数据。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> count = <span class="number">0</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">jsonp</span>(<span class="params">src, callback</span>) &#123;</span><br><span class="line">  count++</span><br><span class="line">  <span class="keyword">const</span> functionName = <span class="string">&#x27;jsonpCallback&#x27;</span> + count</span><br><span class="line">  <span class="comment">// 回调执行函数</span></span><br><span class="line">  <span class="variable language_">window</span>[functionName] = <span class="keyword">function</span> (<span class="params">res</span>) &#123;</span><br><span class="line">    callback &amp;&amp; <span class="title function_">callback</span>(res)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">const</span> script = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;script&#x27;</span>)</span><br><span class="line">  script.<span class="property">type</span> = <span class="string">&#x27;text/javascript&#x27;</span></span><br><span class="line">  <span class="comment">// 传参一个回调函数名给后端，方便后端返回时执行这个在前端定义的回调函数</span></span><br><span class="line">  <span class="keyword">const</span> realSrc = src.<span class="title function_">includes</span>(<span class="string">&#x27;?&#x27;</span>)</span><br><span class="line">    ? src + <span class="string">&#x27;&amp;callback=&#x27;</span> + functionName</span><br><span class="line">    : src + <span class="string">&#x27;?callback=&#x27;</span> + functionName</span><br><span class="line">  script.<span class="property">src</span> = realSrc</span><br><span class="line">  <span class="variable language_">document</span>.<span class="property">head</span>.<span class="title function_">appendChild</span>(script)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 服务端实现</span></span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/test&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; callback &#125; = req.<span class="property">query</span></span><br><span class="line">  res.<span class="title function_">send</span>(<span class="string">`<span class="subst">$&#123;callback&#125;</span>(&#123; test: &quot;a&quot; &#125;)`</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>通过 <code>script</code> 标签的形式获取到的数据会被自动执行，所以通过返回回调函数调用的方式自动执行代码</p>
<h4 id="缺点"><a href="#缺点" class="headerlink" title="缺点"></a>缺点</h4><ul>
<li>具有局限性， 仅支持 get 方法</li>
<li>不安全，可能会遭受 XSS 攻击</li>
</ul>
<h3 id="postMessage"><a href="#postMessage" class="headerlink" title="postMessage"></a>postMessage</h3><h4 id="特点"><a href="#特点" class="headerlink" title="特点"></a>特点</h4><ul>
<li>页面和其打开的新窗口的数据传递</li>
<li>多窗口之间消息传递</li>
<li>页面与嵌套的 iframe 消息传递</li>
<li>上面三个场景的跨域数据传递</li>
</ul>
<h3 id="服务代理"><a href="#服务代理" class="headerlink" title="服务代理"></a>服务代理</h3><p>服务端转发请求</p>
<h3 id="document-domain-iframe"><a href="#document-domain-iframe" class="headerlink" title="document.domain + iframe"></a>document.domain + iframe</h3><p>此方案仅限主域相同，子域不同的跨域应用场景。实现原理：两个页面都通过 js 强制设置 document.domain 为基础主域，就实现了同域。</p>
<h3 id="location-hash-iframe"><a href="#location-hash-iframe" class="headerlink" title="location.hash + iframe"></a>location.hash + iframe</h3><p>a 欲与 b 跨域相互通信，通过中间页 c 来实现。 三个页面，不同域之间利用 iframe 的 location.hash 传值，相同域之间直接 js 访问来通信。</p>
<h4 id="说明"><a href="#说明" class="headerlink" title="说明"></a>说明</h4><ul>
<li>A 与 B 不同域，A 向 B 传递消息时通过修改 B 页面的 hash 值，B 监听 hash 值的变化获取数据</li>
<li>A 与 C 同域，B 与 A 通信时通过修改 C 页面的 hash 值，C 通过各种手段通知 A hash 值的辩护</li>
</ul>
<h3 id="window-name-iframe"><a href="#window-name-iframe" class="headerlink" title="window.name + iframe"></a>window.name + iframe</h3><p>window.name 属性的独特之处：name 值在不同的页面（甚至不同域名）加载后依旧存在，并且可以支持非常长的 name 值（2MB）。</p>
<h3 id="WebSocket"><a href="#WebSocket" class="headerlink" title="WebSocket"></a>WebSocket</h3><p>通过 <code>WebSocket</code> 服务端中转通信</p>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><ul>
<li><a href="https://juejin.cn/post/6916157109906341902/#heading-55">如何解决跨越问题</a></li>
<li><a href="https://developer.mozilla.org/zh-CN/docs/Glossary/CORS">MDN CORS</a></li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/08/06/%E8%B7%A8%E5%9F%9F/" data-id="cm1ghkbnq0063zodz0q301k6r" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/JavaScript/" rel="tag">JavaScript</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-术语" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2021/07/26/%E6%9C%AF%E8%AF%AD/" class="article-date">
  <time datetime="2021-07-25T22:27:21.000Z" itemprop="datePublished">2021-07-25</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2021/07/26/%E6%9C%AF%E8%AF%AD/">术语</a>
    </h1>
  


        <div style="color: #999; margin-top: 0.3rem" class="post-meta-item"> 共计
    919 字，约需阅读
    3.34
    分钟
</div>
      </header>
    
    
   

    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="操作系统"><a href="#操作系统" class="headerlink" title="操作系统"></a>操作系统</h2><ul>
<li>进程：资源分配的最小单位</li>
<li>线程：CPU 调度的最小单位</li>
<li>协程：协程运行在线程之上，当一个协程执行完成后，可以选择主动让出，让另一个协程运行在当前线程之上。协程并没有增加线程数量，只是在线程的基础之上通过分时复用的方式运行多个协程，而且协程的切换在用户态完成，切换的代价比线程从用户态到内核态的代价小很多。</li>
</ul>
<h2 id="网络"><a href="#网络" class="headerlink" title="网络"></a>网络</h2><ul>
<li>URL: Uniform Resource Locator, 统一资源定位符</li>
<li>URI: Uniform Resource Identifier, 统一资源标识符</li>
<li>FTP: File Transfer Protocol, 文件传输协议</li>
<li>CGI: Common Gateway Interface, 通用网关接口</li>
<li>DNS: Domain Name System, 域名服务系统</li>
<li>协议栈: 操作系统内部的网络控制软件</li>
<li>MX: Mail eXchange, 邮件交换</li>
<li>UDP: User Datagram Protocol, 用户数据报协议</li>
<li>TCP: Transmission Control Protocol, 传输控制协议</li>
<li>ARP: Address Resolution Protocol, 地址解析协议</li>
<li>MTU: Maximum Transmission Unit, 最大传输单元</li>
<li>MSS: Maximum Segment Size, 最大分段大小</li>
<li>FCS: Frame Check Sequence, 帧校验序列</li>
<li>SFD: Start Frame Delimiter, 起始帧分界</li>
</ul>
<h2 id="其它"><a href="#其它" class="headerlink" title="其它"></a>其它</h2><ul>
<li>PaaS: Platform as a service, 平台即服务。PaaS 给用户提供的能力是使用由云服务提供商支持的编程语言、库、服务以及开发工具来创建、开发应用程序并部署在相关的基础设施上。用户无需管理底层的基础设施，包括网络、服务器，操作系统或者存储。他们只能控制部署在基础设施中操作系统上的应用程序，配置应用程序所托管的环境的可配置参数。常见的 PaaS 服务有数据库服务、web 应用以及容器服务。成熟的 PaaS 服务会简化开发人员，提供完备的 PC 端和移动端软件开发套件（SDK），拥有丰富的开发环境（Inteli、Eclipse、VS 等），完全可托管的数据库服务，可配置式的应用程序构建，支持多语言的开发，面向应用市场。</li>
<li>SaaS: Software as a Service, 软件即服务。SaaS 给用户提供的能力是使用在云基础架构上运行的云服务提供商的应用程序。可以通过轻量的客户端接口（诸如 web 浏览器（例如，基于 web 的电子邮件））或程序接口从各种客户端设备访问应用程序。 用户无需管理或控制底层云基础架构，包括网络，服务器，操作系统，存储甚至单独的应用程序功能，可能的例外是有限的用户特定应用程序配置设置。类似的服务有：各类的网盘(Dropbox、百度网盘等)，JIRA，GitLab 等服务。而这些应用的提供者不仅仅是云服务提供商，还有众多的第三方提供商（ISV: independent software provider）。</li>
<li>IaaS: Infrastructure as a service, 基础设施即服务。用户可以在云服务提供商提供的基础设施上部署和运行任何软件，包括操作系统和应用软件。用户没有权限管理和访问底层的基础设施，如服务器、交换机、硬盘等，但是有权管理操作系统、存储内容，可以安装管理应用程序，甚至是有权管理网络组件。简单的说用户使用 IaaS，有权管理操作系统之上的一切功能。我们常见的 IaaS 服务有虚拟机、虚拟网络、以及存储。</li>
</ul>
<h3 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h3><ul>
<li><a href="https://zhuanlan.zhihu.com/p/172471249">什么是协程？</a></li>
<li><a href="https://www.zhihu.com/question/25532384">线程和进程的区别是什么？</a></li>
<li><a href="https://www.zhihu.com/question/20387284">怎么理解 IaaS、SaaS 和 PaaS 的区别？</a></li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/07/26/%E6%9C%AF%E8%AF%AD/" data-id="cm1ghkbni004xzodz8zedabb5" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/other/" rel="tag">other</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-js沙箱" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2021/07/26/js%E6%B2%99%E7%AE%B1/" class="article-date">
  <time datetime="2021-07-25T21:06:01.000Z" itemprop="datePublished">2021-07-25</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2021/07/26/js%E6%B2%99%E7%AE%B1/">js沙箱</a>
    </h1>
  


        <div style="color: #999; margin-top: 0.3rem" class="post-meta-item"> 共计
    596 字，约需阅读
    2.17
    分钟
</div>
      </header>
    
    
   

    <div class="article-entry" itemprop="articleBody">
      
        <p>沙箱，即 <code>sandbox</code>，顾名思义，就是让你的程序跑在一个隔离的环境下，不对外界的其他程序造成影响，通过创建类似沙盒的独立作业环境，在其内部运行的程序并不能对硬盘产生永久性的影响。</p>
<h3 id="使用场景"><a href="#使用场景" class="headerlink" title="使用场景"></a>使用场景</h3><ul>
<li>解析或执行不可信的 <code>JS</code></li>
<li>隔离被执行代码的执行环境</li>
<li>对执行代码中可访问对象进行限制</li>
</ul>
<h3 id="实现方式"><a href="#实现方式" class="headerlink" title="实现方式"></a>实现方式</h3><h4 id="with-new-Function"><a href="#with-new-Function" class="headerlink" title="with + new Function"></a><code>with</code> + <code>new Function</code></h4><p>在 <code>with</code> 的块级作用域下，变量访问会优先查找你传入的参数对象，之后再往上找，所以相当于你变相监控到了代码中的“变量访问”，结合 <code>proxy</code> 代理可以监听所有数据的修改和访问</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">proxyFanctory</span>(<span class="params">obj</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> target = <span class="keyword">new</span> <span class="title class_">Proxy</span>(obj, &#123;</span><br><span class="line">    <span class="title function_">get</span>(<span class="params">target, p</span>) &#123;</span><br><span class="line">      <span class="keyword">if</span> (p === <span class="title class_">Symbol</span>.<span class="property">unscopables</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">undefined</span></span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> (target[p] === <span class="literal">undefined</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">undefined</span></span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> target[p]</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="title function_">set</span>(<span class="params">target, p, value</span>) &#123;</span><br><span class="line">      target[p] = value</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> target</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">runWithSanbox</span>(<span class="params">code</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> context = <span class="title function_">proxyFanctory</span>(&#123; <span class="attr">a</span>: <span class="string">&#x27;test&#x27;</span>, <span class="attr">b</span>: &#123;&#125; &#125;)</span><br><span class="line">  <span class="keyword">const</span> codeSrc = <span class="string">`with(sandbox)&#123;<span class="subst">$&#123;code&#125;</span>&#125;`</span></span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Function</span>(<span class="string">&#x27;sandbox&#x27;</span>, codeSrc).<span class="title function_">call</span>(context, context)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">runWithSanbox</span>(</span><br><span class="line">  <span class="string">&#x27;this.b.__proto__.toString=function()&#123;console.log(&quot;__proto__.toString&quot;)&#125;;console.log(a, this)&#x27;</span></span><br><span class="line">) <span class="comment">// test Proxy &#123;a: &quot;test&quot;&#125;</span></span><br><span class="line"><span class="keyword">const</span> t = &#123;&#125;</span><br><span class="line">t.<span class="title function_">toString</span>() <span class="comment">// __proto__.toString</span></span><br></pre></td></tr></table></figure>

<h5 id="需要解决的问题"><a href="#需要解决的问题" class="headerlink" title="需要解决的问题"></a>需要解决的问题</h5><ul>
<li><code>proxy</code> 无法监听深层次数据的访问，可以通过访问原型链的方式，实现沙箱逃逸（代码分析）</li>
<li><code>window</code> 等固有对象调用（<code>iframe</code> 创建隔离的上下文）</li>
</ul>
<h4 id="借助-iframe-实现"><a href="#借助-iframe-实现" class="headerlink" title="借助 iframe 实现"></a>借助 <code>iframe</code> 实现</h4><p><code>sandbox</code> 是 <code>h5</code> 的提出的一个新属性， 启用方式就是在 <code>iframe</code> 标签中使用 <code>sandbox</code> 属性</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">iframe</span> <span class="attr">sandbox</span> <span class="attr">src</span>=<span class="string">&quot;url&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">iframe</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h5 id="限制"><a href="#限制" class="headerlink" title="限制"></a>限制</h5><ul>
<li><code>script</code> 脚本不能执行， <code>allow-scripts</code> 属性</li>
<li>不能发送 <code>ajax</code> 请求，<code>allow-same-origin</code> 允许同域请求</li>
</ul>
<p>具体参考 <a href="https://developer.mozilla.org/zh-CN/docs/Web/HTML/Element/iframe#attr-sandbox">iframe</a></p>
<h4 id="Web-Worker"><a href="#Web-Worker" class="headerlink" title="Web Worker"></a><code>Web Worker</code></h4><p><code>Web Worker</code> 子线程的形式也是一种天然的沙箱隔离</p>
<h5 id="限制-1"><a href="#限制-1" class="headerlink" title="限制"></a>限制</h5><ul>
<li>出于线程安全设计考虑，<code>Web Worker</code> 不支持 <code>DOM</code> 操作，必须通过 <code>postMessage</code> 通知 <code>UI</code> 主线程来实现。</li>
<li><code>Web Worker</code> 无法访问 <code>window</code>、<code>document</code> 之类的浏览器全局对象。</li>
</ul>
<p>通过代理将具体的渲染实现再转发给原 <code>WorkerDomNodeImpl.js</code> 逻辑来实现 <code>DOM</code> 的实际更新。</p>
<h3 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h3><ul>
<li><a href="https://juejin.cn/post/6844903954074058760">说说 JS 中的沙箱</a></li>
<li><a href="https://developer.aliyun.com/article/761449">如何“取巧”实现一个微前端沙箱？</a></li>
<li><a href="https://www.infoq.cn/article/u9dkjjleg2hp6uqhsoii">字节跳动的微前端沙盒实践</a></li>
<li><a href="https://segmentfault.com/a/1190000039795656">浅探 Web Worker 与 JavaScript 沙箱</a></li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/07/26/js%E6%B2%99%E7%AE%B1/" data-id="cm1ghkbmy0027zodzexxlcnzp" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/JavaScript/" rel="tag">JavaScript</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-浏览器渲染过程详解" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2021/07/12/%E6%B5%8F%E8%A7%88%E5%99%A8%E6%B8%B2%E6%9F%93%E8%BF%87%E7%A8%8B%E8%AF%A6%E8%A7%A3/" class="article-date">
  <time datetime="2021-07-11T16:03:29.000Z" itemprop="datePublished">2021-07-11</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2021/07/12/%E6%B5%8F%E8%A7%88%E5%99%A8%E6%B8%B2%E6%9F%93%E8%BF%87%E7%A8%8B%E8%AF%A6%E8%A7%A3/">浏览器渲染过程详解</a>
    </h1>
  


        <div style="color: #999; margin-top: 0.3rem" class="post-meta-item"> 共计
    893 字，约需阅读
    3.25
    分钟
</div>
      </header>
    
    
   

    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="渲染流程"><a href="#渲染流程" class="headerlink" title="渲染流程"></a>渲染流程</h3><ol>
<li>浏览器通过网络请求后获取 <code>html</code> 数据，通过 <code>tcp</code> 传给浏览器进程，然后浏览器进程再传递给渲染器进程</li>
<li><code>DOM</code> - <code>DOM</code> 结构： 主线程将 <code>html</code> 解析构造 <code>DOM</code> 树</li>
<li><code>style</code> - 样式： 主线程解析页面的 <code>CSS</code> 从而确定每个 <code>DOM</code> 节点的计算样式（<code>computed style</code>）。</li>
<li><code>layoutTree</code> - 布局树： <code>dom</code>+<code>style</code> 根据 <code>dom</code> 树和样式生成 <code>layoutTree</code></li>
<li><code>paint</code> - 绘制： 通过遍历 <code>Layout Tree</code> 生成绘制顺序表</li>
<li><code>laryer</code> - 布局： 主线程将 <code>layoutTree</code> 和绘制信息表传给合成器线程</li>
<li>合成器线程： 将得到的信息分图层分成更小的图块</li>
<li>栅格线程： 将更小的图块进行栅格化 <code>raster</code>，返还给合成器线程 <code>draw quads</code> 图块信息，存储在 <code>GPU</code> 中</li>
<li>合成线程会收集图块上面叫做绘画四边形（<code>draw quads</code>）的信息来构建一个合成帧（<code>compositor frame</code>）。</li>
<li>合成线程就会通过 <code>IPC</code> 向浏览器进程（<code>browser process</code>）提交（<code>commit</code>）一个渲染帧。</li>
<li>浏览器进程收到一帧的图像后传给 <code>GPU</code> 进行渲染</li>
</ol>
<h4 id="非快速滚动区域-non-fast-scrollable-region"><a href="#非快速滚动区域-non-fast-scrollable-region" class="headerlink" title="非快速滚动区域 - non-fast scrollable region"></a>非快速滚动区域 - non-fast scrollable region</h4><p>当一个页面被合成的时候，合成线程会将页面那些注册了事件监听器的区域标记为“非快速滚动区域”（<code>Non-fast Scrollable Region</code>）。当用户事件发生在这些区域时，合成线程会将输入事件发送给主线程来处理。如果输入事件不是发生在非快速滚动区域，合成线程就无须主线程的参与来合成一个新的帧。</p>
<h5 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h5><p><code>body</code> 元素绑定了事件监听器后其实是将整个页面都标记为一个非快速滚动区域，这就意味着即使你页面的某些区域压根就不在乎是不是有用户输入，当用户输入事件发生时，合成线程每次都会告知主线程并且会等待主线程处理完它才干活。因此这种情况下合成线程就丧失提供流畅用户体验的能力了（<code>smooth scrolling ability</code>）。</p>
<h5 id="解决办法"><a href="#解决办法" class="headerlink" title="解决办法"></a>解决办法</h5><p>可以为事件监听器传递 <code>passive：true</code> 选项。 这个选项会告诉浏览器您仍要在主线程中侦听事件，可是合成线程也可以继续合成新的帧。</p>
<h4 id="查找事件的目标对象（event-target）"><a href="#查找事件的目标对象（event-target）" class="headerlink" title="查找事件的目标对象（event target）"></a>查找事件的目标对象（event target）</h4><p>当合成线程向主线程发送输入事件时，主线程要做的第一件事是通过命中测试（<code>hit test</code>）去找到事件的目标对象（<code>target</code>）。具体的命中测试流程是遍历在渲染流水线中生成的绘画记录（<code>paint records</code>）来找到输入事件出现的 <code>x</code>, <code>y</code> 坐标上面描绘的对象是哪个。</p>
<h4 id="相关概念"><a href="#相关概念" class="headerlink" title="相关概念"></a>相关概念</h4><h5 id="DOM-对象"><a href="#DOM-对象" class="headerlink" title="DOM 对象"></a>DOM 对象</h5><p>既是浏览器对当前页面的内部表示，也是 <code>Web</code> 开发人员通过 <code>JavaScript</code> 与网页进行交互的数据结构以及 <code>API</code>。</p>
<h5 id="光栅化（rasterizing）"><a href="#光栅化（rasterizing）" class="headerlink" title="光栅化（rasterizing）"></a>光栅化（rasterizing）</h5><p>将以上文档结构，元素的样式，元素的几何信息以及它们的绘画顺序转化为显示器的像素的过程</p>
<h5 id="绘画四边形"><a href="#绘画四边形" class="headerlink" title="绘画四边形"></a>绘画四边形</h5><p>包含图块在内存的位置以及图层合成后图块在页面的位置之类的信息。</p>
<h5 id="合成帧"><a href="#合成帧" class="headerlink" title="合成帧"></a>合成帧</h5><p>代表页面一个帧的内容的绘制四边形集合。</p>
<h3 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h3><ul>
<li><a href="https://zhuanlan.zhihu.com/p/102149546">一文看懂 Chrome 浏览器运行机制</a></li>
<li><a href="https://www.html5rocks.com/zh/tutorials/internals/howbrowserswork/#Resources">浏览器的工作原理：新式网络浏览器幕后揭秘</a></li>
<li><a href="https://www.html5rocks.com/zh/tutorials/speed/high-performance-animations/">High Performance Animations</a></li>
<li><a href="https://www.bilibili.com/video/BV1x54y1B7RE">【干货】浏览器是如何运作的？</a></li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/07/12/%E6%B5%8F%E8%A7%88%E5%99%A8%E6%B8%B2%E6%9F%93%E8%BF%87%E7%A8%8B%E8%AF%A6%E8%A7%A3/" data-id="cm1ghkbnj0055zodzdvnwhtvw" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/JavaScript/" rel="tag">JavaScript</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-js执行流程" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2021/07/11/js%E6%89%A7%E8%A1%8C%E6%B5%81%E7%A8%8B/" class="article-date">
  <time datetime="2021-07-10T21:58:37.000Z" itemprop="datePublished">2021-07-10</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2021/07/11/js%E6%89%A7%E8%A1%8C%E6%B5%81%E7%A8%8B/">js执行流程</a>
    </h1>
  


        <div style="color: #999; margin-top: 0.3rem" class="post-meta-item"> 共计
    796 字，约需阅读
    2.89
    分钟
</div>
      </header>
    
    
   

    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="js-引擎"><a href="#js-引擎" class="headerlink" title="js 引擎"></a><code>js</code> 引擎</h3><table>
<thead>
<tr>
<th align="left">浏览器</th>
<th align="left"><code>JavaScript</code> 引擎</th>
</tr>
</thead>
<tbody><tr>
<td align="left">chrome</td>
<td align="left"><code>V8</code></td>
</tr>
<tr>
<td align="left">safari</td>
<td align="left"><code>JavaScriptCore</code></td>
</tr>
<tr>
<td align="left">Firefox</td>
<td align="left"><code>SpiderMonkey</code></td>
</tr>
<tr>
<td align="left">Edge</td>
<td align="left"><code>Chakra</code></td>
</tr>
</tbody></table>
<h3 id="js-执行过程"><a href="#js-执行过程" class="headerlink" title="js 执行过程"></a><code>js</code> 执行过程</h3><ol>
<li>对源码进行词法分析</li>
<li>进行语法分析</li>
<li>生成抽象语法树</li>
<li>生成可执行代码（可能有优化过程，此处代码可能是字节码或者机器码）</li>
<li>执行</li>
</ol>
<h4 id="词法分析"><a href="#词法分析" class="headerlink" title="词法分析"></a>词法分析</h4><p>将程序源代码分解成对编程语言来说有意义的代码块，这些代码块被称为词法单元（<code>token</code>）。</p>
<h4 id="语法分析"><a href="#语法分析" class="headerlink" title="语法分析"></a>语法分析</h4><p>根据生成的 <code>Token</code> 进行语法分析。</p>
<h3 id="V8-引擎"><a href="#V8-引擎" class="headerlink" title="V8 引擎"></a><code>V8</code> 引擎</h3><h4 id="主要模块"><a href="#主要模块" class="headerlink" title="主要模块"></a>主要模块</h4><h5 id="Parser"><a href="#Parser" class="headerlink" title="Parser"></a><code>Parser</code></h5><p>负责将 <code>JavaScript</code> 源码转换为 <code>Abstract Syntax Tree</code> (<code>AST</code>)。在 <code>V8</code> 中有两个解析器用于解析 <code>JavaScript</code> 代码，分别是 <code>Parser</code> 和 <code>Pre-Parser</code> 。</p>
<ul>
<li><code>Parser</code> 解析器又称为 <code>full parser</code>（全量解析） 或者 <code>eager parser</code>（饥饿解析）。它会解析所有立即执行的代码，包括语法检查，生成 <code>AST</code>，以及确定词法作用域。</li>
<li><code>Pre-Parser</code> 又称为惰性解析，它只解析未被立即执行的代码（如函数），不生成 <code>AST</code> ，只确定作用域，以此来提高性能。当预解析后的代码开始执行时，才进行 <code>Parser</code> 解析。</li>
</ul>
<h5 id="Ignition"><a href="#Ignition" class="headerlink" title="Ignition"></a><code>Ignition</code></h5><p><code>interpreter</code>，即解释器，负责将 <code>AST</code> 转换为 <code>Bytecode</code>，解释执行 <code>Bytecode</code>；同时收集 <code>TurboFan</code> 优化编译所需的信息，比如函数参数的类型</p>
<h5 id="TurboFan"><a href="#TurboFan" class="headerlink" title="TurboFan"></a><code>TurboFan</code></h5><p><code>compiler</code>，即编译器，利用 <code>Ignitio</code> 所收集的类型信息，将 <code>Bytecode</code> 转换为优化的机器代码</p>
<h5 id="Orinoco"><a href="#Orinoco" class="headerlink" title="Orinoco"></a><code>Orinoco</code></h5><p><code>garbage collector</code>，垃圾回收模块，负责将程序不再需要的内存空间回收；</p>
<h4 id="执行过程"><a href="#执行过程" class="headerlink" title="执行过程"></a>执行过程</h4><ol>
<li>扫描所有的源代码，进行词法分析，生成 <code>Tokens</code></li>
<li><code>Parser</code> 解析器根据 <code>Tokens</code> 生成 <code>AST</code>，存在预编译和编译</li>
<li><code>Ignition</code> 解释器将 <code>AST</code> 转换为字节码，并解释执行</li>
<li><code>TurboFan</code> 编译器负责将热点函数优化编译为机器指令执行</li>
</ol>
<p><img src="/images/brower/js_v8.jpg" alt="执行过程"></p>
<h5 id="优化及优化导致的问题修复"><a href="#优化及优化导致的问题修复" class="headerlink" title="优化及优化导致的问题修复"></a>优化及优化导致的问题修复</h5><p>当 <code>Ignition</code> 开始执行 <code>JavaScript</code> 代码后，<code>V8</code> 会一直观察 <code>JavaScript</code> 代码的执行情况，并记录执行信息，如每个函数的执行次数、每次调用函数时，传递的参数类型等。</p>
<p>如果一个函数被调用的次数超过了内设的阈值，监视器就会将当前函数标记为热点函数（<code>Hot Function</code>），并将该函数的字节码以及执行的相关信息发送给 <code>TurboFan</code>。<code>TurboFan</code> 会根据执行信息做出一些进一步优化此代码的假设，在假设的基础上将字节码编译为优化的机器代码。如果假设成立，那么当下一次调用该函数时，就会执行优化编译后的机器代码，以提高代码的执行性能；如果假设不成立，不知道你们有没有注意到上图中有一条由 <code>optimized code</code> 指向 <code>bytecode</code> 的红色指向线。此过程叫做 <code>deoptimize</code>（优化回退），将优化编译后的机器代码还原为字节码。</p>
<p><img src="/images/brower/js_v8_optimize.jpg" alt="优化过程"></p>
<h3 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h3><ul>
<li><a href="https://www.bilibili.com/video/BV1zV411z7RX">8 分钟带你了解 V8 引擎是如何运行 JS</a></li>
<li><a href="https://zhuanlan.zhihu.com/p/73768338">JavaScript 深入浅出第 4 课：V8 引擎是如何工作的？</a></li>
<li><a href="https://v8.dev/blog/launching-ignition-and-turbofan">Launching Ignition and TurboFan</a></li>
<li><a href="https://segmentfault.com/a/1190000022062181">JavaScript 引擎（V8）是如何工作的</a></li>
<li><a href="https://mlib.wang/2020/02/08/v8-parser-compiler-javascript/">V8 是如何怎么处理 JavaScript 的</a></li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/07/11/js%E6%89%A7%E8%A1%8C%E6%B5%81%E7%A8%8B/" data-id="cm1ghkbmx0024zodzd23y6jrc" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/JavaScript/" rel="tag">JavaScript</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/node/" rel="tag">node</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-react中hooks实现原理" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2021/06/28/react%E4%B8%ADhooks%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86/" class="article-date">
  <time datetime="2021-06-27T22:34:04.000Z" itemprop="datePublished">2021-06-27</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2021/06/28/react%E4%B8%ADhooks%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86/">react中hooks实现原理</a>
    </h1>
  


        <div style="color: #999; margin-top: 0.3rem" class="post-meta-item"> 共计
    971 字，约需阅读
    3.53
    分钟
</div>
      </header>
    
    
   

    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="以客户端-useState-为例"><a href="#以客户端-useState-为例" class="headerlink" title="以客户端 useState 为例"></a>以客户端 <code>useState</code> 为例</h3><ol>
<li>声明 <code>useState</code>，通过 <code>ReactCurrentDispatcher.current</code> 来实现</li>
<li><code>ReactCurrentDispatcher.current</code> 的赋值是在 <code>packages/react-reconciler/src/ReactFiberHooks</code> 文件中区分挂载、更新和重新渲染分别实现的</li>
</ol>
<h4 id="挂载"><a href="#挂载" class="headerlink" title="挂载"></a>挂载</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// packages/react-reconciler/src/ReactFiberHooks.new.js</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">mountState</span>(<span class="params">initialState</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> hook = <span class="title function_">mountWorkInProgressHook</span>()</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> initialState === <span class="string">&#x27;function&#x27;</span>) &#123;</span><br><span class="line">    initialState = <span class="title function_">initialState</span>()</span><br><span class="line">  &#125;</span><br><span class="line">  hook.<span class="property">memoizedState</span> = hook.<span class="property">baseState</span> = initialState</span><br><span class="line">  <span class="keyword">const</span> queue = (hook.<span class="property">queue</span> = &#123;</span><br><span class="line">    <span class="attr">pending</span>: <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">interleaved</span>: <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">lanes</span>: <span class="title class_">NoLanes</span>,</span><br><span class="line">    <span class="attr">dispatch</span>: <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">lastRenderedReducer</span>: basicStateReducer,</span><br><span class="line">    <span class="attr">lastRenderedState</span>: initialState,</span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="keyword">const</span> dispatch = (queue.<span class="property">dispatch</span> = dispatchAction.<span class="title function_">bind</span>(</span><br><span class="line">    <span class="literal">null</span>,</span><br><span class="line">    currentlyRenderingFiber,</span><br><span class="line">    queue</span><br><span class="line">  ))</span><br><span class="line">  <span class="keyword">return</span> [hook.<span class="property">memoizedState</span>, dispatch]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">mountWorkInProgressHook</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> hook = &#123;</span><br><span class="line">    <span class="attr">memoizedState</span>: <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">baseState</span>: <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">baseQueue</span>: <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">queue</span>: <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">next</span>: <span class="literal">null</span>,</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (workInProgressHook === <span class="literal">null</span>) &#123;</span><br><span class="line">    <span class="comment">// This is the first hook in the list</span></span><br><span class="line">    currentlyRenderingFiber.<span class="property">memoizedState</span> = workInProgressHook = hook</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// Append to the end of the list</span></span><br><span class="line">    workInProgressHook = workInProgressHook.<span class="property">next</span> = hook</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> workInProgressHook</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="更新"><a href="#更新" class="headerlink" title="更新"></a>更新</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// file: packages/react-reconciler/src/ReactFiberHooks.new.js</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">updateState</span>(<span class="params">initialState</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">updateReducer</span>(basicStateReducer, initialState)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">updateReducer</span>(<span class="params">reducer, initialArg, init</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> hook = <span class="title function_">updateWorkInProgressHook</span>()</span><br><span class="line">  <span class="keyword">const</span> queue = hook.<span class="property">queue</span></span><br><span class="line"></span><br><span class="line">  queue.<span class="property">lastRenderedReducer</span> = reducer</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> current = currentHook</span><br><span class="line"></span><br><span class="line">  <span class="comment">// The last rebase update that is NOT part of the base state.</span></span><br><span class="line">  <span class="keyword">let</span> baseQueue = current.<span class="property">baseQueue</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// The last pending update that hasn&#x27;t been processed yet.</span></span><br><span class="line">  <span class="keyword">const</span> pendingQueue = queue.<span class="property">pending</span></span><br><span class="line">  <span class="keyword">if</span> (pendingQueue !== <span class="literal">null</span>) &#123;</span><br><span class="line">    <span class="comment">// We have new updates that haven&#x27;t been processed yet.</span></span><br><span class="line">    <span class="comment">// We&#x27;ll add them to the base queue.</span></span><br><span class="line">    <span class="keyword">if</span> (baseQueue !== <span class="literal">null</span>) &#123;</span><br><span class="line">      <span class="comment">// Merge the pending queue and the base queue.</span></span><br><span class="line">      <span class="keyword">const</span> baseFirst = baseQueue.<span class="property">next</span></span><br><span class="line">      <span class="keyword">const</span> pendingFirst = pendingQueue.<span class="property">next</span></span><br><span class="line">      baseQueue.<span class="property">next</span> = pendingFirst</span><br><span class="line">      pendingQueue.<span class="property">next</span> = baseFirst</span><br><span class="line">    &#125;</span><br><span class="line">    current.<span class="property">baseQueue</span> = baseQueue = pendingQueue</span><br><span class="line">    queue.<span class="property">pending</span> = <span class="literal">null</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (baseQueue !== <span class="literal">null</span>) &#123;</span><br><span class="line">    <span class="comment">// We have a queue to process.</span></span><br><span class="line">    <span class="keyword">const</span> first = baseQueue.<span class="property">next</span></span><br><span class="line">    <span class="keyword">let</span> newState = current.<span class="property">baseState</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> newBaseState = <span class="literal">null</span></span><br><span class="line">    <span class="keyword">let</span> newBaseQueueFirst = <span class="literal">null</span></span><br><span class="line">    <span class="keyword">let</span> newBaseQueueLast = <span class="literal">null</span></span><br><span class="line">    <span class="keyword">let</span> update = first</span><br><span class="line">    <span class="keyword">do</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> updateLane = update.<span class="property">lane</span></span><br><span class="line">      <span class="keyword">if</span> (!<span class="title function_">isSubsetOfLanes</span>(renderLanes, updateLane)) &#123;</span><br><span class="line">        <span class="comment">// Priority is insufficient. Skip this update. If this is the first</span></span><br><span class="line">        <span class="comment">// skipped update, the previous update/state is the new base</span></span><br><span class="line">        <span class="comment">// update/state.</span></span><br><span class="line">        <span class="keyword">const</span> clone = &#123;</span><br><span class="line">          <span class="attr">lane</span>: updateLane,</span><br><span class="line">          <span class="attr">action</span>: update.<span class="property">action</span>,</span><br><span class="line">          <span class="attr">eagerReducer</span>: update.<span class="property">eagerReducer</span>,</span><br><span class="line">          <span class="attr">eagerState</span>: update.<span class="property">eagerState</span>,</span><br><span class="line">          <span class="attr">next</span>: <span class="literal">null</span>,</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (newBaseQueueLast === <span class="literal">null</span>) &#123;</span><br><span class="line">          newBaseQueueFirst = newBaseQueueLast = clone</span><br><span class="line">          newBaseState = newState</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          newBaseQueueLast = newBaseQueueLast.<span class="property">next</span> = clone</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// Update the remaining priority in the queue.</span></span><br><span class="line">        <span class="comment">// <span class="doctag">TODO:</span> Don&#x27;t need to accumulate this. Instead, we can remove</span></span><br><span class="line">        <span class="comment">// renderLanes from the original lanes.</span></span><br><span class="line">        currentlyRenderingFiber.<span class="property">lanes</span> = <span class="title function_">mergeLanes</span>(</span><br><span class="line">          currentlyRenderingFiber.<span class="property">lanes</span>,</span><br><span class="line">          updateLane</span><br><span class="line">        )</span><br><span class="line">        <span class="title function_">markSkippedUpdateLanes</span>(updateLane)</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// This update does have sufficient priority.</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (newBaseQueueLast !== <span class="literal">null</span>) &#123;</span><br><span class="line">          <span class="keyword">const</span> clone = &#123;</span><br><span class="line">            <span class="comment">// This update is going to be committed so we never want uncommit</span></span><br><span class="line">            <span class="comment">// it. Using NoLane works because 0 is a subset of all bitmasks, so</span></span><br><span class="line">            <span class="comment">// this will never be skipped by the check above.</span></span><br><span class="line">            <span class="attr">lane</span>: <span class="title class_">NoLane</span>,</span><br><span class="line">            <span class="attr">action</span>: update.<span class="property">action</span>,</span><br><span class="line">            <span class="attr">eagerReducer</span>: update.<span class="property">eagerReducer</span>,</span><br><span class="line">            <span class="attr">eagerState</span>: update.<span class="property">eagerState</span>,</span><br><span class="line">            <span class="attr">next</span>: <span class="literal">null</span>,</span><br><span class="line">          &#125;</span><br><span class="line">          newBaseQueueLast = newBaseQueueLast.<span class="property">next</span> = clone</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Process this update.</span></span><br><span class="line">        <span class="keyword">if</span> (update.<span class="property">eagerReducer</span> === reducer) &#123;</span><br><span class="line">          <span class="comment">// If this update was processed eagerly, and its reducer matches the</span></span><br><span class="line">          <span class="comment">// current reducer, we can use the eagerly computed state.</span></span><br><span class="line">          newState = update.<span class="property">eagerState</span></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="keyword">const</span> action = update.<span class="property">action</span></span><br><span class="line">          newState = <span class="title function_">reducer</span>(newState, action)</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      update = update.<span class="property">next</span></span><br><span class="line">    &#125; <span class="keyword">while</span> (update !== <span class="literal">null</span> &amp;&amp; update !== first)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (newBaseQueueLast === <span class="literal">null</span>) &#123;</span><br><span class="line">      newBaseState = newState</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      newBaseQueueLast.<span class="property">next</span> = newBaseQueueFirst</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Mark that the fiber performed work, but only if the new state is</span></span><br><span class="line">    <span class="comment">// different from the current state.</span></span><br><span class="line">    <span class="keyword">if</span> (!<span class="title function_">is</span>(newState, hook.<span class="property">memoizedState</span>)) &#123;</span><br><span class="line">      <span class="title function_">markWorkInProgressReceivedUpdate</span>()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    hook.<span class="property">memoizedState</span> = newState</span><br><span class="line">    hook.<span class="property">baseState</span> = newBaseState</span><br><span class="line">    hook.<span class="property">baseQueue</span> = newBaseQueueLast</span><br><span class="line"></span><br><span class="line">    queue.<span class="property">lastRenderedState</span> = newState</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Interleaved updates are stored on a separate queue. We aren&#x27;t going to</span></span><br><span class="line">  <span class="comment">// process them during this render, but we do need to track which lanes</span></span><br><span class="line">  <span class="comment">// are remaining.</span></span><br><span class="line">  <span class="keyword">const</span> lastInterleaved = queue.<span class="property">interleaved</span></span><br><span class="line">  <span class="keyword">if</span> (lastInterleaved !== <span class="literal">null</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> interleaved = lastInterleaved</span><br><span class="line">    <span class="keyword">do</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> interleavedLane = interleaved.<span class="property">lane</span></span><br><span class="line">      currentlyRenderingFiber.<span class="property">lanes</span> = <span class="title function_">mergeLanes</span>(</span><br><span class="line">        currentlyRenderingFiber.<span class="property">lanes</span>,</span><br><span class="line">        interleavedLane</span><br><span class="line">      )</span><br><span class="line">      <span class="title function_">markSkippedUpdateLanes</span>(interleavedLane)</span><br><span class="line">      interleaved = interleaved.<span class="property">next</span></span><br><span class="line">    &#125; <span class="keyword">while</span> (interleaved !== lastInterleaved)</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (baseQueue === <span class="literal">null</span>) &#123;</span><br><span class="line">    <span class="comment">// `queue.lanes` is used for entangling transitions. We can set it back to</span></span><br><span class="line">    <span class="comment">// zero once the queue is empty.</span></span><br><span class="line">    queue.<span class="property">lanes</span> = <span class="title class_">NoLanes</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> dispatch = (queue.<span class="property">dispatch</span>: any)</span><br><span class="line">  <span class="keyword">return</span> [hook.<span class="property">memoizedState</span>, dispatch]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="重渲染"><a href="#重渲染" class="headerlink" title="重渲染"></a>重渲染</h4><h4 id="dispatchAction"><a href="#dispatchAction" class="headerlink" title="dispatchAction"></a><code>dispatchAction</code></h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">dispatchAction</span>(<span class="params">fiber, queue, action</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> eventTime = <span class="title function_">requestEventTime</span>()</span><br><span class="line">  <span class="keyword">const</span> lane = <span class="title function_">requestUpdateLane</span>(fiber)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> update = &#123;</span><br><span class="line">    lane,</span><br><span class="line">    action,</span><br><span class="line">    <span class="attr">eagerReducer</span>: <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">eagerState</span>: <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">next</span>: <span class="literal">null</span>,</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> alternate = fiber.<span class="property">alternate</span></span><br><span class="line">  <span class="keyword">if</span> (</span><br><span class="line">    fiber === currentlyRenderingFiber ||</span><br><span class="line">    (alternate !== <span class="literal">null</span> &amp;&amp; alternate === currentlyRenderingFiber)</span><br><span class="line">  ) &#123;</span><br><span class="line">    didScheduleRenderPhaseUpdateDuringThisPass =</span><br><span class="line">      didScheduleRenderPhaseUpdate = <span class="literal">true</span></span><br><span class="line">    <span class="keyword">const</span> pending = queue.<span class="property">pending</span></span><br><span class="line">    <span class="keyword">if</span> (pending === <span class="literal">null</span>) &#123;</span><br><span class="line">      <span class="comment">// This is the first update. Create a circular list.</span></span><br><span class="line">      update.<span class="property">next</span> = update</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      update.<span class="property">next</span> = pending.<span class="property">next</span></span><br><span class="line">      pending.<span class="property">next</span> = update</span><br><span class="line">    &#125;</span><br><span class="line">    queue.<span class="property">pending</span> = update</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// 其它情况更新</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="basicStateReducer"><a href="#basicStateReducer" class="headerlink" title="basicStateReducer"></a><code>basicStateReducer</code></h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">basicStateReducer</span>(<span class="params">state, action</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">typeof</span> action === <span class="string">&#x27;function&#x27;</span> ? <span class="title function_">action</span>(state) : action</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>所有的 <code>hooks</code> 都是挂载在 <code>ReactCurrentDispatcher</code> 对象上的</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Test</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> [a, setA] = <span class="title function_">useState</span>()</span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;a&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title class_">ReactDOM</span>.<span class="title function_">render</span>(</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">Test</span> /&gt;</span></span>,</span><br><span class="line">  <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;root&#x27;</span>) || <span class="variable language_">document</span>.<span class="title function_">getElementsByTagName</span>(<span class="string">&#x27;body&#x27;</span>)[<span class="number">0</span>]</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 编译之后</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Test</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> _useState = (<span class="number">0</span>, _react.<span class="property">useState</span>)(<span class="number">0</span>), <span class="comment">// 等价于 _useState = _react.useState(0)</span></span><br><span class="line">    _useState2 = <span class="title function_">_slicedToArray</span>(_useState, <span class="number">2</span>),</span><br><span class="line">    a = _useState2[<span class="number">0</span>],</span><br><span class="line">    setA = _useState2[<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> _react2.<span class="property">default</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;div&#x27;</span>, <span class="literal">null</span>, a)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">_reactDom2.<span class="property">default</span>.<span class="title function_">render</span>(</span><br><span class="line">  _react2.<span class="property">default</span>.<span class="title function_">createElement</span>(<span class="title class_">Test</span>, <span class="literal">null</span>),</span><br><span class="line">  <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;root&#x27;</span>) || <span class="variable language_">document</span>.<span class="title function_">getElementsByTagName</span>(<span class="string">&#x27;body&#x27;</span>)[<span class="number">0</span>]</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p>编译后实际是把函数组件当作参数传递下去了</p>
<h3 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h3><ul>
<li><a href="https://www.jianshu.com/p/b9ac8fa849f1">React Hooks 原理</a></li>
<li><a href="https://www.cnblogs.com/cczlovexw/p/13565085.html">React Hook 的底层实现原理</a></li>
<li><a href="https://zhuanlan.zhihu.com/p/48584310">阅读源码后，来讲讲 React Hooks 是怎么实现的</a></li>
<li><a href="https://zhuanlan.zhihu.com/p/75146261">React Hook 的实现原理和最佳实践</a></li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/06/28/react%E4%B8%ADhooks%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86/" data-id="cm1ghkbn50037zodz92cs5tb1" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/JavaScript/" rel="tag">JavaScript</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/react/" rel="tag">react</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-react从dom-render到初次组件渲染完成" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2021/06/20/react%E4%BB%8Edom-render%E5%88%B0%E5%88%9D%E6%AC%A1%E7%BB%84%E4%BB%B6%E6%B8%B2%E6%9F%93%E5%AE%8C%E6%88%90/" class="article-date">
  <time datetime="2021-06-19T22:12:44.000Z" itemprop="datePublished">2021-06-19</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2021/06/20/react%E4%BB%8Edom-render%E5%88%B0%E5%88%9D%E6%AC%A1%E7%BB%84%E4%BB%B6%E6%B8%B2%E6%9F%93%E5%AE%8C%E6%88%90/">react从dom.render到初次组件渲染完成</a>
    </h1>
  


        <div style="color: #999; margin-top: 0.3rem" class="post-meta-item"> 共计
    1.3k 字，约需阅读
    4.73
    分钟
</div>
      </header>
    
    
   

    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="从-dom-render-到初次组件渲染完成"><a href="#从-dom-render-到初次组件渲染完成" class="headerlink" title="从 dom.render 到初次组件渲染完成"></a>从 <code>dom.render</code> 到初次组件渲染完成</h2><ol>
<li><code>render(element,container,callback) </code> 调用 <code>legacyRenderSubtreeIntoContainer(null,element,container,false,callback)</code></li>
<li><code>legacyRenderSubtreeIntoContainer(parentComponent,children,container,forceHydrate,callback)</code> 调用<code>legacyCreateRootFromDOMContainer(container,false)</code> 创建容器并赋值给 <code>container._reactRootContainer</code></li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// file: packages/react-dom/src/client/ReactDOMLegacy.js</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">legacyRenderSubtreeIntoContainer</span>(<span class="params"></span></span><br><span class="line"><span class="params">  parentComponent: ?React$Component&lt;any, any&gt;,</span></span><br><span class="line"><span class="params">  children: ReactNodeList,</span></span><br><span class="line"><span class="params">  container: Container,</span></span><br><span class="line"><span class="params">  forceHydrate: boolean,</span></span><br><span class="line"><span class="params">  callback: ?<span class="built_in">Function</span></span></span><br><span class="line"><span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> root = container.<span class="property">_reactRootContainer</span></span><br><span class="line">  <span class="keyword">let</span> <span class="attr">fiberRoot</span>: <span class="title class_">FiberRoot</span></span><br><span class="line">  <span class="keyword">if</span> (!root) &#123;</span><br><span class="line">    root = container.<span class="property">_reactRootContainer</span> = <span class="title function_">legacyCreateRootFromDOMContainer</span>(</span><br><span class="line">      container,</span><br><span class="line">      forceHydrate</span><br><span class="line">    )</span><br><span class="line">    fiberRoot = root.<span class="property">_internalRoot</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> callback === <span class="string">&#x27;function&#x27;</span>) &#123;</span><br><span class="line">      <span class="keyword">const</span> originalCallback = callback</span><br><span class="line">      callback = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> instance = <span class="title function_">getPublicRootInstance</span>(fiberRoot)</span><br><span class="line">        originalCallback.<span class="title function_">call</span>(instance)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 初始化同步更新</span></span><br><span class="line">    <span class="title function_">unbatchedUpdates</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="title function_">updateContainer</span>(children, fiberRoot, parentComponent, callback)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// 更新</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">getPublicRootInstance</span>(fiberRoot)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>通过 <code>unbatchedUpdates</code> 同步更新容器元素并调用回调函数</li>
</ol>
<h3 id="构建容器"><a href="#构建容器" class="headerlink" title="构建容器"></a>构建容器</h3><ol>
<li><code>legacyCreateRootFromDOMContainer</code> 调用 <code>createLegacyRoot(container)</code> 构建容器</li>
<li>调用 <code>new ReactDOMLegacyRoot(container)</code> 构建实例</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// file: packages/react-dom/src/client/ReactDOMRoot.js</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">createLegacyRoot</span>(<span class="params"></span></span><br><span class="line"><span class="params">  container: Container,</span></span><br><span class="line"><span class="params">  options?: RootOptions</span></span><br><span class="line"><span class="params"></span>): <span class="title class_">RootType</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ReactDOMLegacyRoot</span>(container, options)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>构造函数中调用 <code>createRootImpl(container, ConcurrentRoot)</code> 创建根容器并赋值给 <code>_internalRoot</code> 属性</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// file: packages/react-dom/src/client/ReactDOMRoot.js</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">ReactDOMLegacyRoot</span>(<span class="params">container: Container, options: <span class="keyword">void</span> | RootOptions</span>) &#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">_internalRoot</span> = <span class="title function_">createRootImpl</span>(container, <span class="title class_">LegacyRoot</span>, options)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title class_">ReactDOMLegacyRoot</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">render</span> = <span class="keyword">function</span> (<span class="params">children: ReactNodeList</span>): <span class="keyword">void</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> root = <span class="variable language_">this</span>.<span class="property">_internalRoot</span></span><br><span class="line">  <span class="title function_">updateContainer</span>(children, root, <span class="literal">null</span>, <span class="literal">null</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title class_">ReactDOMLegacyRoot</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">unmount</span> = <span class="keyword">function</span> (<span class="params"></span>): <span class="keyword">void</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> root = <span class="variable language_">this</span>.<span class="property">_internalRoot</span></span><br><span class="line">  <span class="keyword">const</span> container = root.<span class="property">containerInfo</span></span><br><span class="line">  <span class="title function_">updateContainer</span>(<span class="literal">null</span>, root, <span class="literal">null</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">unmarkContainerAsRoot</span>(container)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">createRootImpl</span>(<span class="params"></span></span><br><span class="line"><span class="params">  container: Container,</span></span><br><span class="line"><span class="params">  tag: RootTag,</span></span><br><span class="line"><span class="params">  options: <span class="keyword">void</span> | RootOptions</span></span><br><span class="line"><span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> root = <span class="title function_">createContainer</span>(container, tag)</span><br><span class="line">  <span class="title function_">markContainerAsRoot</span>(root.<span class="property">current</span>, container)</span><br><span class="line">  <span class="keyword">const</span> rootContainerElement =</span><br><span class="line">    container.<span class="property">nodeType</span> === <span class="variable constant_">COMMENT_NODE</span> ? container.<span class="property">parentNode</span> : container</span><br><span class="line">  <span class="title function_">listenToAllSupportedEvents</span>(rootContainerElement)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> root</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>调用 <code>createContainer(container, ConcurrentRoot)</code> 构建根元素</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// file: packages/react-reconciler/src/ReactFiberRoot.old.js</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">createContainer</span>(<span class="params"></span></span><br><span class="line"><span class="params">  containerInfo: Container,</span></span><br><span class="line"><span class="params">  tag: RootTag,</span></span><br><span class="line"><span class="params">  hydrate: boolean,</span></span><br><span class="line"><span class="params">  hydrationCallbacks: <span class="literal">null</span> | SuspenseHydrationCallbacks,</span></span><br><span class="line"><span class="params">  isStrictMode: boolean,</span></span><br><span class="line"><span class="params">  concurrentUpdatesByDefaultOverride: <span class="literal">null</span> | boolean</span></span><br><span class="line"><span class="params"></span>): <span class="title class_">OpaqueRoot</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">createFiberRoot</span>(</span><br><span class="line">    containerInfo,</span><br><span class="line">    tag,</span><br><span class="line">    hydrate,</span><br><span class="line">    hydrationCallbacks,</span><br><span class="line">    isStrictMode,</span><br><span class="line">    concurrentUpdatesByDefaultOverride</span><br><span class="line">  )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 1.  调用 `new FiberRootNode(container, ConcurrentRoot)` 构建根元素</span></span><br><span class="line"><span class="comment">// 2.  调用 `createHostRootFiber` 构建 `Fiber`</span></span><br><span class="line"><span class="comment">// 3.  初始化更新队列</span></span><br><span class="line"><span class="comment">// file: packages/react-reconciler/src/ReactFiberRoot.old.js</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">createFiberRoot</span>(<span class="params"></span></span><br><span class="line"><span class="params">  containerInfo: any,</span></span><br><span class="line"><span class="params">  tag: RootTag,</span></span><br><span class="line"><span class="params">  hydrate: boolean,</span></span><br><span class="line"><span class="params">  hydrationCallbacks: <span class="literal">null</span> | SuspenseHydrationCallbacks,</span></span><br><span class="line"><span class="params">  isStrictMode: boolean,</span></span><br><span class="line"><span class="params">  concurrentUpdatesByDefaultOverride: <span class="literal">null</span> | boolean</span></span><br><span class="line"><span class="params"></span>): <span class="title class_">FiberRoot</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> <span class="attr">root</span>: <span class="title class_">FiberRoot</span> = <span class="keyword">new</span> <span class="title class_">FiberRootNode</span>(containerInfo, tag, hydrate)</span><br><span class="line">  <span class="keyword">const</span> uninitializedFiber = <span class="title function_">createHostRootFiber</span>(</span><br><span class="line">    tag,</span><br><span class="line">    isStrictMode,</span><br><span class="line">    concurrentUpdatesByDefaultOverride</span><br><span class="line">  )</span><br><span class="line">  root.<span class="property">current</span> = uninitializedFiber</span><br><span class="line">  uninitializedFiber.<span class="property">stateNode</span> = root</span><br><span class="line">  <span class="keyword">const</span> initialState = &#123; <span class="attr">element</span>: <span class="literal">null</span> &#125;</span><br><span class="line">  uninitializedFiber.<span class="property">memoizedState</span> = initialState</span><br><span class="line">  <span class="title function_">initializeUpdateQueue</span>(uninitializedFiber)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> root</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">FiberRootNode</span>(<span class="params">containerInfo, tag, hydrate</span>) &#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">tag</span> = tag</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">containerInfo</span> = containerInfo</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">pendingChildren</span> = <span class="literal">null</span></span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">current</span> = <span class="literal">null</span></span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">pingCache</span> = <span class="literal">null</span></span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">finishedWork</span> = <span class="literal">null</span></span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">timeoutHandle</span> = noTimeout</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">context</span> = <span class="literal">null</span></span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">pendingContext</span> = <span class="literal">null</span></span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">hydrate</span> = hydrate</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">callbackNode</span> = <span class="literal">null</span></span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">callbackPriority</span> = <span class="title class_">NoLane</span></span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">eventTimes</span> = <span class="title function_">createLaneMap</span>(<span class="title class_">NoLanes</span>)</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">expirationTimes</span> = <span class="title function_">createLaneMap</span>(<span class="title class_">NoTimestamp</span>)</span><br><span class="line"></span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">pendingLanes</span> = <span class="title class_">NoLanes</span></span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">suspendedLanes</span> = <span class="title class_">NoLanes</span></span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">pingedLanes</span> = <span class="title class_">NoLanes</span></span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">expiredLanes</span> = <span class="title class_">NoLanes</span></span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">mutableReadLanes</span> = <span class="title class_">NoLanes</span></span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">finishedLanes</span> = <span class="title class_">NoLanes</span></span><br><span class="line"></span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">entangledLanes</span> = <span class="title class_">NoLanes</span></span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">entanglements</span> = <span class="title function_">createLaneMap</span>(<span class="title class_">NoLanes</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// file: packages/react-reconciler/src/ReactFiber.old.js</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">createHostRootFiber</span>(<span class="params"></span></span><br><span class="line"><span class="params">  tag: RootTag,</span></span><br><span class="line"><span class="params">  isStrictMode: boolean,</span></span><br><span class="line"><span class="params">  concurrentUpdatesByDefaultOverride: <span class="literal">null</span> | boolean</span></span><br><span class="line"><span class="params"></span>): <span class="title class_">Fiber</span> &#123;</span><br><span class="line">  <span class="keyword">let</span> mode</span><br><span class="line">  <span class="keyword">if</span> (tag === <span class="title class_">ConcurrentRoot</span>) &#123;</span><br><span class="line">    mode = <span class="title class_">ConcurrentMode</span></span><br><span class="line">    <span class="keyword">if</span> (isStrictMode === <span class="literal">true</span>) &#123;</span><br><span class="line">      mode |= <span class="title class_">StrictLegacyMode</span></span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (enableStrictEffects) &#123;</span><br><span class="line">        mode |= <span class="title class_">StrictEffectsMode</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (enableStrictEffects &amp;&amp; createRootStrictEffectsByDefault) &#123;</span><br><span class="line">      mode |= <span class="title class_">StrictLegacyMode</span> | <span class="title class_">StrictEffectsMode</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (</span><br><span class="line">      !enableSyncDefaultUpdates ||</span><br><span class="line">      (allowConcurrentByDefault &amp;&amp; concurrentUpdatesByDefaultOverride)</span><br><span class="line">    ) &#123;</span><br><span class="line">      mode |= <span class="title class_">ConcurrentUpdatesByDefaultMode</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    mode = <span class="title class_">NoMode</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (enableProfilerTimer &amp;&amp; isDevToolsPresent) &#123;</span><br><span class="line">    mode |= <span class="title class_">ProfileMode</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">createFiber</span>(<span class="title class_">HostRoot</span>, <span class="literal">null</span>, <span class="literal">null</span>, mode)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">FiberNode</span>(<span class="params"></span></span><br><span class="line"><span class="params">  tag: WorkTag,</span></span><br><span class="line"><span class="params">  pendingProps: mixed,</span></span><br><span class="line"><span class="params">  key: <span class="literal">null</span> | string,</span></span><br><span class="line"><span class="params">  mode: TypeOfMode</span></span><br><span class="line"><span class="params"></span>) &#123;</span><br><span class="line">  <span class="comment">// Instance</span></span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">tag</span> = tag</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">key</span> = key</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">elementType</span> = <span class="literal">null</span></span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">type</span> = <span class="literal">null</span></span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">stateNode</span> = <span class="literal">null</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// Fiber</span></span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">return</span> = <span class="literal">null</span></span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">child</span> = <span class="literal">null</span></span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">sibling</span> = <span class="literal">null</span></span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">index</span> = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">ref</span> = <span class="literal">null</span></span><br><span class="line"></span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">pendingProps</span> = pendingProps</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">memoizedProps</span> = <span class="literal">null</span></span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">updateQueue</span> = <span class="literal">null</span></span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">memoizedState</span> = <span class="literal">null</span></span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">dependencies</span> = <span class="literal">null</span></span><br><span class="line"></span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">mode</span> = mode</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Effects</span></span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">flags</span> = <span class="title class_">NoFlags</span></span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">subtreeFlags</span> = <span class="title class_">NoFlags</span></span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">deletions</span> = <span class="literal">null</span></span><br><span class="line"></span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">lanes</span> = <span class="title class_">NoLanes</span></span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">childLanes</span> = <span class="title class_">NoLanes</span></span><br><span class="line"></span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">alternate</span> = <span class="literal">null</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">createFiber</span>(<span class="params"></span></span><br><span class="line"><span class="params">  tag: WorkTag,</span></span><br><span class="line"><span class="params">  pendingProps: mixed,</span></span><br><span class="line"><span class="params">  key: <span class="literal">null</span> | string,</span></span><br><span class="line"><span class="params">  mode: TypeOfMode</span></span><br><span class="line"><span class="params"></span>): <span class="title class_">Fiber</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">FiberNode</span>(tag, pendingProps, key, mode)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="5">
<li>调用<code>markContainerAsRoot(root.current, container)</code>标记根元素</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// file: packages/react-dom/src/client/ReactDOMComponentTree.js</span></span><br><span class="line"><span class="keyword">const</span> randomKey = <span class="title class_">Math</span>.<span class="title function_">random</span>().<span class="title function_">toString</span>(<span class="number">36</span>).<span class="title function_">slice</span>(<span class="number">2</span>)</span><br><span class="line"><span class="keyword">const</span> internalContainerInstanceKey = <span class="string">&#x27;__reactContainer$&#x27;</span> + randomKey</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">markContainerAsRoot</span>(<span class="params">hostRoot: Fiber, node: Container</span>) &#123;</span><br><span class="line">  node[internalContainerInstanceKey] = hostRoot</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="6">
<li>调用<code>listenToAllSupportedEvents(rootContainerElement)</code> 向根元素上注册所有原生监听事件，但 <code>selectionchange</code> 事件注册在 <code>document</code> 上</li>
</ol>
<h4 id="构建的容器"><a href="#构建的容器" class="headerlink" title="构建的容器"></a>构建的容器</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> container =<span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;root&quot;</span>)</span><br><span class="line"><span class="keyword">const</span> root = container.<span class="property">_reactRootContainer</span> = &#123;</span><br><span class="line">  <span class="attr">_internalRoot</span>: &#123;</span><br><span class="line">    <span class="attr">tag</span>: <span class="title class_">RootTag</span>,</span><br><span class="line">    <span class="attr">containerInfo</span>: container,</span><br><span class="line">    <span class="attr">pendingChildren</span>: <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">current</span>: <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">pingCache</span>: <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">finishedWork</span>: <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">timeoutHandle</span>: noTimeout</span><br><span class="line">    <span class="attr">context</span>: <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">pendingContext</span>: <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">hydrate</span>: hydrate,</span><br><span class="line">    <span class="attr">callbackNode</span>: <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">callbackPriority</span>: <span class="title class_">NoLane</span>,</span><br><span class="line">    <span class="attr">eventTimes</span>: [<span class="title class_">NoLanes</span>],</span><br><span class="line">    <span class="attr">expirationTimes</span>: [<span class="title class_">NoTimestamp</span>],</span><br><span class="line">    <span class="attr">pendingLanes</span>: <span class="title class_">NoLanes</span>,</span><br><span class="line">    <span class="attr">suspendedLanes</span>: <span class="title class_">NoLanes</span>,</span><br><span class="line">    <span class="attr">pingedLanes</span>: <span class="title class_">NoLanes</span>,</span><br><span class="line">    <span class="attr">expiredLanes</span>: <span class="title class_">NoLanes</span>,</span><br><span class="line">    <span class="attr">mutableReadLanes</span>: <span class="title class_">NoLanes</span>,</span><br><span class="line">    <span class="attr">finishedLanes</span>: <span class="title class_">NoLanes</span>,</span><br><span class="line">    <span class="attr">entangledLanes</span>: <span class="title class_">NoLanes</span>,</span><br><span class="line">    <span class="attr">entanglements</span>: [<span class="title class_">NoLanes</span>],</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">current</span>: &#123;</span><br><span class="line">    <span class="attr">tag</span>: tag,</span><br><span class="line">    <span class="attr">key</span>: key,</span><br><span class="line">    <span class="attr">elementType</span>: <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">type</span>: <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">stateNode</span>: root,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Fiber</span></span><br><span class="line">    <span class="attr">return</span>: <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">child</span>: <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">sibling</span>: <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">index</span>: <span class="number">0</span>,</span><br><span class="line"></span><br><span class="line">    <span class="attr">ref</span>: <span class="literal">null</span>,</span><br><span class="line"></span><br><span class="line">    <span class="attr">pendingProps</span>: pendingProps,</span><br><span class="line">    <span class="attr">memoizedProps</span>: <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">updateQueue</span>: <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">memoizedState</span>: &#123; <span class="attr">element</span>: <span class="literal">null</span> &#125;,</span><br><span class="line">    <span class="attr">dependencies</span>: <span class="literal">null</span>,</span><br><span class="line"></span><br><span class="line">    <span class="attr">mode</span>: <span class="title class_">NoMode</span>,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Effects</span></span><br><span class="line">    <span class="attr">flags</span>: <span class="title class_">NoFlags</span>,</span><br><span class="line">    <span class="attr">subtreeFlags</span>: <span class="title class_">NoFlags</span>,</span><br><span class="line">    <span class="attr">deletions</span>: <span class="literal">null</span>,</span><br><span class="line"></span><br><span class="line">    <span class="attr">lanes</span>: <span class="title class_">NoLanes</span>,</span><br><span class="line">    <span class="attr">childLanes</span>: <span class="title class_">NoLanes</span>,</span><br><span class="line"></span><br><span class="line">    <span class="attr">alternate</span>: <span class="literal">null</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> fiberRoot = root.<span class="property">_internalRoot</span></span><br><span class="line">container[<span class="string">&#x27;__reactContainer$&#x27;</span> + randomKey] = root.<span class="property">current</span></span><br></pre></td></tr></table></figure>

<h3 id="更新容器"><a href="#更新容器" class="headerlink" title="更新容器"></a>更新容器</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// file: packages/react-reconciler/src/ReactFiberReconciler.old.js</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">updateContainer</span>(<span class="params"></span></span><br><span class="line"><span class="params">  element: ReactNodeList,</span></span><br><span class="line"><span class="params">  container: OpaqueRoot,</span></span><br><span class="line"><span class="params">  parentComponent: ?React$Component&lt;any, any&gt;,</span></span><br><span class="line"><span class="params">  callback: ?<span class="built_in">Function</span></span></span><br><span class="line"><span class="params"></span>): <span class="title class_">Lane</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> current = container.<span class="property">current</span></span><br><span class="line">  <span class="keyword">const</span> eventTime = <span class="title function_">requestEventTime</span>() <span class="comment">// 获取更新时间</span></span><br><span class="line">  <span class="keyword">const</span> lane = <span class="title function_">requestUpdateLane</span>(current) <span class="comment">// 获取更新任务的优先级</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> context = <span class="title function_">getContextForSubtree</span>(parentComponent) <span class="comment">// 获取 context</span></span><br><span class="line">  <span class="keyword">if</span> (container.<span class="property">context</span> === <span class="literal">null</span>) &#123;</span><br><span class="line">    container.<span class="property">context</span> = context</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    container.<span class="property">pendingContext</span> = context</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> update = <span class="title function_">createUpdate</span>(eventTime, lane) <span class="comment">// 构建一次更新</span></span><br><span class="line">  update.<span class="property">payload</span> = &#123; element &#125;</span><br><span class="line"></span><br><span class="line">  callback = callback === <span class="literal">undefined</span> ? <span class="literal">null</span> : callback</span><br><span class="line">  <span class="keyword">if</span> (callback !== <span class="literal">null</span>) &#123;</span><br><span class="line">    update.<span class="property">callback</span> = callback</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">enqueueUpdate</span>(current, update, lane)</span><br><span class="line">  <span class="keyword">const</span> root = <span class="title function_">scheduleUpdateOnFiber</span>(current, lane, eventTime)</span><br><span class="line">  <span class="keyword">if</span> (root !== <span class="literal">null</span>) &#123;</span><br><span class="line">    <span class="title function_">entangleTransitions</span>(root, current, lane)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> lane</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol>
<li>获取更新优先级，位数越底，优先级越高</li>
<li>获取 <code>context</code></li>
<li>通过 <code>createUpdate</code> 创建更新</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// file: packages/react-reconciler/src/ReactUpdateQueue.old.js</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">createUpdate</span>(<span class="params">eventTime: number, lane: Lane</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> update = &#123;</span><br><span class="line">    eventTime,</span><br><span class="line">    lane,</span><br><span class="line">    <span class="attr">tag</span>: <span class="title class_">UpdateState</span>,</span><br><span class="line">    <span class="attr">payload</span>: <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">callback</span>: <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">next</span>: <span class="literal">null</span>,</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> update</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>通过 <code>enqueueUpdate</code> 把更新放入更新队列</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// file: packages/react-reconciler/src/ReactUpdateQueue.old.js</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> enqueueUpdate&lt;<span class="title class_">State</span>&gt;(</span><br><span class="line">  <span class="attr">fiber</span>: <span class="title class_">Fiber</span>,</span><br><span class="line">  <span class="attr">update</span>: <span class="title class_">Update</span>&lt;<span class="title class_">State</span>&gt;,</span><br><span class="line">  <span class="attr">lane</span>: <span class="title class_">Lane</span></span><br><span class="line">) &#123;</span><br><span class="line">  <span class="keyword">const</span> updateQueue = fiber.<span class="property">updateQueue</span></span><br><span class="line">  <span class="keyword">if</span> (updateQueue === <span class="literal">null</span>) &#123;</span><br><span class="line">    <span class="comment">// 卸载时执行</span></span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">const</span> sharedQueue = updateQueue.<span class="property">shared</span></span><br><span class="line">  <span class="comment">// 正在更新</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="title function_">isInterleavedUpdate</span>(fiber, lane)) &#123;</span><br><span class="line">    <span class="keyword">const</span> interleaved = sharedQueue.<span class="property">interleaved</span></span><br><span class="line">    <span class="keyword">if</span> (interleaved === <span class="literal">null</span>) &#123;</span><br><span class="line">      <span class="comment">// 构建更新环，并放入更新队列</span></span><br><span class="line">      update.<span class="property">next</span> = update</span><br><span class="line">      <span class="title function_">pushInterleavedQueue</span>(sharedQueue)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      update.<span class="property">next</span> = interleaved.<span class="property">next</span></span><br><span class="line">      interleaved.<span class="property">next</span> = update</span><br><span class="line">    &#125;</span><br><span class="line">    sharedQueue.<span class="property">interleaved</span> = update</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> pending = sharedQueue.<span class="property">pending</span></span><br><span class="line">    <span class="keyword">if</span> (pending === <span class="literal">null</span>) &#123;</span><br><span class="line">      <span class="comment">// 构建更新环，并放入更新队列</span></span><br><span class="line">      update.<span class="property">next</span> = update</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      update.<span class="property">next</span> = pending.<span class="property">next</span></span><br><span class="line">      pending.<span class="property">next</span> = update</span><br><span class="line">    &#125;</span><br><span class="line">    sharedQueue.<span class="property">pending</span> = update</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="5">
<li>通过 <code>scheduleUpdateOnFiber</code> 调度更新</li>
</ol>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/06/20/react%E4%BB%8Edom-render%E5%88%B0%E5%88%9D%E6%AC%A1%E7%BB%84%E4%BB%B6%E6%B8%B2%E6%9F%93%E5%AE%8C%E6%88%90/" data-id="cm1ghkbn8003lzodz0roq2imc" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/JavaScript/" rel="tag">JavaScript</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/react/" rel="tag">react</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-webpack源码阅读（二）" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2021/06/17/webpack%E6%BA%90%E7%A0%81%E9%98%85%E8%AF%BB%EF%BC%88%E4%BA%8C%EF%BC%89/" class="article-date">
  <time datetime="2021-06-16T19:22:20.000Z" itemprop="datePublished">2021-06-16</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2021/06/17/webpack%E6%BA%90%E7%A0%81%E9%98%85%E8%AF%BB%EF%BC%88%E4%BA%8C%EF%BC%89/">webpack源码阅读（二）</a>
    </h1>
  


        <div style="color: #999; margin-top: 0.3rem" class="post-meta-item"> 共计
    1.2k 字，约需阅读
    4.36
    分钟
</div>
      </header>
    
    
   

    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="webpack-Compilation-执行过程"><a href="#webpack-Compilation-执行过程" class="headerlink" title="webpack Compilation 执行过程"></a>webpack Compilation 执行过程</h3><ol>
<li>构建 <code>Compilation</code> 实例</li>
<li>调用 <code>compilation.finish</code> 执行构建</li>
<li>异步调用 <code>finishModules</code> 钩子函数</li>
<li>调用 <code>compilation.seal</code> 完成构建</li>
<li>构建 <code>ChunkGraph</code> 实例，并调用 <code>ChunkGraph.setChunkGraphForModule(module, chunkGraph)</code></li>
<li>同步调用 <code>seal</code> 钩子函数</li>
<li>同步调用 <code>optimizeDependencies</code> 钩子函数，等待钩子函数执行完毕</li>
<li>同步调用 <code>afterOptimizeDependencies</code> 钩子函数</li>
<li>同步调用 <code>beforeChunks</code> 钩子函数</li>
<li>构建 <code>chunk</code></li>
<li>同步调用 <code>afterChunks</code> 钩子函数</li>
<li>同步调用 <code>optimize</code> 钩子函数</li>
<li>同步调用 <code>optimizeModules</code> 钩子函数，等待钩子函数执行完毕</li>
<li>同步调用 <code>afterOptimizeModules</code> 钩子函数</li>
<li>同步调用 <code>optimizeChunks</code> 钩子函数，等待钩子函数执行完毕</li>
<li>同步调用 <code>afterOptimizeChunks</code> 钩子函数</li>
<li>异步调用 <code>optimizeTree</code> 钩子函数</li>
<li>同步调用 <code>afterOptimizeTree</code> 钩子函数</li>
<li>异步调用 <code>optimizeChunkModules</code> 钩子函数</li>
<li>同步调用 <code>afterOptimizeChunkModules</code> 钩子函数</li>
<li>同步调用 <code>shouldRecord</code> 钩子函数</li>
<li>同步调用 <code>reviveModules</code> 钩子函数</li>
<li>同步调用 <code>beforeModuleIds</code> 钩子函数</li>
<li>同步调用 <code>moduleIds</code> 钩子函数</li>
<li>同步调用 <code>optimizeModuleIds</code> 钩子函数</li>
<li>同步调用 <code>afterOptimizeModuleIds</code> 钩子函数</li>
<li>同步调用 <code>reviveChunks</code> 钩子函数</li>
<li>同步调用 <code>beforeChunkIds</code> 钩子函数</li>
<li>同步调用 <code>chunkIds</code> 钩子函数</li>
<li>同步调用 <code>optimizeChunkIds</code> 钩子函数</li>
<li>同步调用 <code>afterOptimizeChunkIds</code> 钩子函数</li>
<li>若 <code>shouldRecord</code> 钩子函数为正，则同步调用 <code>recordModules</code> 钩子函数</li>
<li>若 <code>shouldRecord</code> 钩子函数为正，则同步调用 <code>recordChunks</code> 钩子函数</li>
<li>同步调用 <code>optimizeCodeGeneration</code> 钩子函数</li>
<li>同步调用 <code>beforeModuleHash</code> 钩子函数</li>
<li>同步调用 <code>afterModuleHash</code> 钩子函数</li>
<li>同步调用 <code>beforeCodeGeneration</code> 钩子函数</li>
<li>调用 <code>codeGeneration</code> 生成代码</li>
<li>同步调用 <code>afterCodeGeneration</code> 钩子函数</li>
<li>同步调用 <code>beforeRuntimeRequirements</code> 钩子函数</li>
<li>提取 <code>modules</code> 中的 <code>runtime</code>，对于每个 <code>module</code> 的 <code>runtime</code> 都同步调用 <code>additionalModuleRuntimeRequirements</code> 钩子函数</li>
<li>若存在对应的 <code>runtimeRequirementInModule</code> 钩子函数，则同步调用该钩子函数</li>
<li>对每个 <code>chunk</code> 同步调用 <code>additionalChunkRuntimeRequirements</code> 钩子函数</li>
<li>对每个 <code>chunk</code> 中依赖的 <code>runtime</code> 调用 <code>runtimeRequirementInChunk</code> 钩子函数</li>
<li>构建含有重复依赖的依赖树</li>
<li>每个入口文件的依赖进行扁平化处理，去掉重复依赖，然后同步调用 <code>additionalTreeRuntimeRequirements</code> 钩子函数</li>
<li>每个入口文件的依赖一次调用 <code>runtimeRequirementInTree</code> 钩子函数</li>
<li>同步调用 <code>afterRuntimeRequirements</code> 钩子函数</li>
<li>同步调用 <code>beforeHash</code> 钩子函数</li>
<li>同步调用 <code>updateHash</code> 钩子函数</li>
<li>若为非 <code>fullHashModules</code> 是同步调用 <code>contentHash</code> 钩子函数</li>
<li>同步调用 <code>fullHash</code> 钩子函数</li>
<li>对每个 <code>chunk</code> 同步调用 <code>fullHash</code> 钩子函数</li>
<li>同步调用 <code>afterHash</code> 钩子函数</li>
<li>若需要记录则同步调用 <code>shouldRecord</code> 钩子函数</li>
<li>清理 <code>chunk</code> 记录的文件</li>
<li>同步调用 <code>beforeModuleAssets</code> 钩子函数</li>
<li>针对 <code>module</code> 的每一个需要输出的资源同步调用 <code>moduleAsset</code> 钩子函数</li>
<li>同步调用 <code>shouldGenerateChunkAssets</code> 判断是否需要输出资源</li>
<li>输出资源前同步调用 <code>beforeChunkAssets</code> 钩子函数</li>
<li>针对每个 <code>chunk</code> 构建一个 <code>manifest</code> 文件</li>
<li>为每个 <code>chunk</code> 写入包含的资源</li>
<li>同步调用 <code>chunkAsset</code> 钩子函数</li>
<li>异步调用 <code>processAssets</code> 钩子函数</li>
<li>同步调用 <code>afterProcessAssets</code> 钩子函数</li>
<li>构建依赖</li>
<li>若需要记录则同步调用 <code>record</code> 钩子函数</li>
<li>同步调用 <code>needAdditionalSeal</code> 钩子函数，判读是否需要新增</li>
<li>异步调用 <code>afterSeal</code> 钩子函数</li>
<li>回调</li>
</ol>
<h4 id="Module"><a href="#Module" class="headerlink" title="Module"></a><code>Module</code></h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="comment">/** <span class="doctag">@type</span> &#123;<span class="type">string</span>&#125; */</span></span><br><span class="line">		<span class="attr">type</span>: type,</span><br><span class="line">		<span class="comment">/** <span class="doctag">@type</span> &#123;<span class="type">string</span>&#125; */</span></span><br><span class="line">		<span class="attr">context</span>: context,</span><br><span class="line">		<span class="comment">/** <span class="doctag">@type</span> &#123;<span class="type">boolean</span>&#125; */</span></span><br><span class="line">		<span class="attr">needId</span>: <span class="literal">true</span>,</span><br><span class="line"></span><br><span class="line">		<span class="comment">// Unique Id</span></span><br><span class="line">		<span class="comment">/** <span class="doctag">@type</span> &#123;<span class="type">number</span>&#125; */</span></span><br><span class="line">		<span class="attr">debugId</span>:  debugId++,</span><br><span class="line"></span><br><span class="line">		<span class="comment">// Info from Factory</span></span><br><span class="line">		<span class="comment">/** <span class="doctag">@type</span> &#123;<span class="type">ResolveOptions</span>&#125; */</span></span><br><span class="line">		<span class="attr">resolveOptions</span>: <span class="variable constant_">EMPTY_RESOLVE_OPTIONS</span>,</span><br><span class="line">		<span class="comment">/** <span class="doctag">@type</span> &#123;<span class="type">object | undefined</span>&#125; */</span></span><br><span class="line">		<span class="attr">factoryMeta</span>: <span class="literal">undefined</span>,</span><br><span class="line">		<span class="comment">// TODO refactor this -&gt; options object filled from Factory</span></span><br><span class="line">		<span class="comment">// TODO webpack 6: use an enum</span></span><br><span class="line">		<span class="comment">/** <span class="doctag">@type</span> &#123;<span class="type">boolean</span>&#125; */</span></span><br><span class="line">		<span class="attr">useSourceMap</span>: <span class="literal">false</span>,</span><br><span class="line">		<span class="comment">/** <span class="doctag">@type</span> &#123;<span class="type">boolean</span>&#125; */</span></span><br><span class="line">		<span class="attr">useSimpleSourceMap</span>: <span class="literal">false</span>,</span><br><span class="line"></span><br><span class="line">		<span class="comment">// Info from Build</span></span><br><span class="line">		<span class="comment">/** <span class="doctag">@type</span> &#123;<span class="type">WebpackError[] | undefined</span>&#125; */</span></span><br><span class="line">		<span class="attr">_warnings</span>: <span class="literal">undefined</span>,</span><br><span class="line">		<span class="comment">/** <span class="doctag">@type</span> &#123;<span class="type">WebpackError[] | undefined</span>&#125; */</span></span><br><span class="line">		<span class="attr">_errors</span>: <span class="literal">undefined</span>,</span><br><span class="line">		<span class="comment">/** <span class="doctag">@type</span> &#123;<span class="type">BuildMeta</span>&#125; */</span></span><br><span class="line">		<span class="attr">buildMeta</span>: <span class="literal">undefined</span>,</span><br><span class="line">		<span class="comment">/** <span class="doctag">@type</span> &#123;<span class="type">object</span>&#125; */</span></span><br><span class="line">		<span class="attr">buildInfo</span>: <span class="literal">undefined</span>,</span><br><span class="line">		<span class="comment">/** <span class="doctag">@type</span> &#123;<span class="type">Dependency[] | undefined</span>&#125; */</span></span><br><span class="line">		<span class="attr">presentationalDependencies</span>: <span class="literal">undefined</span>,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="chunk-具有的属性"><a href="#chunk-具有的属性" class="headerlink" title="chunk 具有的属性"></a><code>chunk</code> 具有的属性</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="comment">/** <span class="doctag">@type</span> &#123;<span class="type">number | string | null</span>&#125; */</span></span><br><span class="line">  <span class="attr">id</span>: <span class="literal">null</span>,</span><br><span class="line">  <span class="comment">/** <span class="doctag">@type</span> &#123;<span class="type">(number|string)[] | null</span>&#125; */</span></span><br><span class="line">  <span class="attr">ids</span>: <span class="literal">null</span>,</span><br><span class="line">  <span class="comment">/** <span class="doctag">@type</span> &#123;<span class="type">number</span>&#125; */</span></span><br><span class="line">  <span class="attr">debugId</span>: debugId++,</span><br><span class="line">  <span class="comment">/** <span class="doctag">@type</span> &#123;<span class="type">string</span>&#125; */</span></span><br><span class="line">  <span class="attr">name</span>: name,</span><br><span class="line">  <span class="comment">/** <span class="doctag">@type</span> &#123;<span class="type">SortableSet&lt;string&gt;</span>&#125; */</span></span><br><span class="line">  <span class="attr">idNameHints</span>: <span class="keyword">new</span> <span class="title class_">SortableSet</span>(),</span><br><span class="line">  <span class="comment">/** <span class="doctag">@type</span> &#123;<span class="type">boolean</span>&#125; */</span></span><br><span class="line">  <span class="attr">preventIntegration</span>: <span class="literal">false</span>,</span><br><span class="line">  <span class="comment">/** <span class="doctag">@type</span> &#123;<span class="type">(string | function(PathData, AssetInfo=): string)?</span>&#125; */</span></span><br><span class="line">  <span class="attr">filenameTemplate</span>: <span class="literal">undefined</span>,</span><br><span class="line">  <span class="comment">/** <span class="doctag">@private</span> <span class="doctag">@type</span> &#123;<span class="type">SortableSet&lt;ChunkGroup&gt;</span>&#125; */</span></span><br><span class="line">  <span class="attr">_groups</span>: <span class="keyword">new</span> <span class="title class_">SortableSet</span>(<span class="literal">undefined</span>, compareChunkGroupsByIndex),</span><br><span class="line">  <span class="comment">/** <span class="doctag">@type</span> &#123;<span class="type">RuntimeSpec</span>&#125; */</span></span><br><span class="line">  <span class="attr">runtime</span>: <span class="literal">undefined</span>,</span><br><span class="line">  <span class="comment">/** <span class="doctag">@type</span> &#123;<span class="type">Set&lt;string&gt;</span>&#125; */</span></span><br><span class="line">  <span class="attr">files</span>: <span class="keyword">new</span> <span class="title class_">ChunkFilesSet</span>(),</span><br><span class="line">  <span class="comment">/** <span class="doctag">@type</span> &#123;<span class="type">Set&lt;string&gt;</span>&#125; */</span></span><br><span class="line">  <span class="attr">auxiliaryFiles</span>: <span class="keyword">new</span> <span class="title class_">Set</span>(),</span><br><span class="line">  <span class="comment">/** <span class="doctag">@type</span> &#123;<span class="type">boolean</span>&#125; */</span></span><br><span class="line">  <span class="attr">rendered</span>: <span class="literal">false</span>,</span><br><span class="line">  <span class="comment">/** <span class="doctag">@type</span> &#123;<span class="type">string=</span>&#125; */</span></span><br><span class="line">  <span class="attr">hash</span>: <span class="literal">undefined</span>,</span><br><span class="line">  <span class="comment">/** <span class="doctag">@type</span> &#123;<span class="type">Record&lt;string, string&gt;</span>&#125; */</span></span><br><span class="line">  <span class="attr">contentHash</span>: <span class="title class_">Object</span>.<span class="title function_">create</span>(<span class="literal">null</span>),</span><br><span class="line">  <span class="comment">/** <span class="doctag">@type</span> &#123;<span class="type">string=</span>&#125; */</span></span><br><span class="line">  <span class="attr">renderedHash</span>: <span class="literal">undefined</span>,</span><br><span class="line">  <span class="comment">/** <span class="doctag">@type</span> &#123;<span class="type">string=</span>&#125; */</span></span><br><span class="line">  <span class="attr">chunkReason</span>: <span class="literal">undefined</span>,</span><br><span class="line">  <span class="comment">/** <span class="doctag">@type</span> &#123;<span class="type">boolean</span>&#125; */</span></span><br><span class="line">  <span class="attr">extraAsync</span>: <span class="literal">false</span>,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="ChunkGraph-具有的属性"><a href="#ChunkGraph-具有的属性" class="headerlink" title="ChunkGraph 具有的属性"></a><code>ChunkGraph</code> 具有的属性</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line"> <span class="comment">/** <span class="doctag">@private</span> <span class="doctag">@type</span> &#123;<span class="type">WeakMap&lt;Module, ChunkGraphModule&gt;</span>&#125; */</span></span><br><span class="line">		<span class="attr">_modules</span>: <span class="keyword">new</span> <span class="title class_">WeakMap</span>(),</span><br><span class="line">		<span class="comment">/** <span class="doctag">@private</span> <span class="doctag">@type</span> &#123;<span class="type">WeakMap&lt;Chunk, ChunkGraphChunk&gt;</span>&#125; */</span></span><br><span class="line">		<span class="attr">_chunks</span>:  <span class="keyword">new</span> <span class="title class_">WeakMap</span>(),</span><br><span class="line">		<span class="comment">/** <span class="doctag">@private</span> <span class="doctag">@type</span> &#123;<span class="type">WeakMap&lt;AsyncDependenciesBlock, ChunkGroup&gt;</span>&#125; */</span></span><br><span class="line">		<span class="attr">_blockChunkGroups</span>: <span class="keyword">new</span> <span class="title class_">WeakMap</span>(),</span><br><span class="line">		<span class="comment">/** <span class="doctag">@private</span> <span class="doctag">@type</span> &#123;<span class="type">Map&lt;string, string | number&gt;</span>&#125; */</span></span><br><span class="line">		<span class="attr">_runtimeIds</span>: <span class="keyword">new</span> <span class="title class_">Map</span>(),</span><br><span class="line">		<span class="comment">/** <span class="doctag">@type</span> &#123;<span class="type">ModuleGraph</span>&#125; */</span></span><br><span class="line">		<span class="attr">moduleGraph</span>: moduleGraph;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="备注"><a href="#备注" class="headerlink" title="备注"></a>备注</h4><ol>
<li>对于一份同逻辑的代码，当我们手写下一个一个的文件，它们无论是 <code>ESM</code> 还是 <code>commonJS</code> 或是 <code>AMD</code>，他们都是 <code>module</code></li>
<li>当我们写的 <code>module</code> 源文件传到 <code>webpack</code> 进行打包时，<code>webpack</code> 会根据文件引用关系生成 <code>chunk</code> 文件，<code>webpack</code> 会对这个 <code>chunk</code> 文件进行一些操作；</li>
<li><code>webpack</code> 处理好 <code>chunk</code> 文件后，最后会输出 <code>bundle</code> 文件，这个 <code>bundle</code> 文件包含了经过加载和编译的最终源文件，所以它可以直接在浏览器中运行。</li>
</ol>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/06/17/webpack%E6%BA%90%E7%A0%81%E9%98%85%E8%AF%BB%EF%BC%88%E4%BA%8C%EF%BC%89/" data-id="cm1ghkbnc0044zodz8b1g9z03" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/JavaScript/" rel="tag">JavaScript</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/webpack/" rel="tag">webpack</a></li></ul>

    </footer>
  </div>
  
</article>


  


  <nav id="page-nav">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><a class="page-number" href="/page/4/">4</a><a class="extend next" rel="next" href="/page/2/">下一页 &raquo;</a>
  </nav>
</section>
        
          <aside id="sidebar">
  
    

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/c-language/" rel="tag">C&#x2F;C++语言</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/HTML/" rel="tag">HTML</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/JavaScript/" rel="tag">JavaScript</a><span class="tag-list-count">63</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/TypeORM/" rel="tag">TypeORM</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/TypeScript/" rel="tag">TypeScript</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/antd/" rel="tag">antd</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/express/" rel="tag">express</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/form/" rel="tag">form</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/git/" rel="tag">git</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mysql/" rel="tag">mysql</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/node/" rel="tag">node</a><span class="tag-list-count">20</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/other/" rel="tag">other</a><span class="tag-list-count">11</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/react/" rel="tag">react</a><span class="tag-list-count">13</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/webpack/" rel="tag">webpack</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%8F%92%E4%BB%B6/" rel="tag">插件</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%B5%8F%E8%A7%88%E5%99%A8/" rel="tag">浏览器</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/solution/" rel="tag">算法</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/network/" rel="tag">计算机网络</a><span class="tag-list-count">8</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/read-book/" rel="tag">读书</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/source/" rel="tag">资源</a><span class="tag-list-count">3</span></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/c-language/" style="font-size: 12.5px;">C/C++语言</a> <a href="/tags/HTML/" style="font-size: 10px;">HTML</a> <a href="/tags/JavaScript/" style="font-size: 20px;">JavaScript</a> <a href="/tags/TypeORM/" style="font-size: 10px;">TypeORM</a> <a href="/tags/TypeScript/" style="font-size: 11.25px;">TypeScript</a> <a href="/tags/antd/" style="font-size: 10px;">antd</a> <a href="/tags/express/" style="font-size: 11.25px;">express</a> <a href="/tags/form/" style="font-size: 10px;">form</a> <a href="/tags/git/" style="font-size: 10px;">git</a> <a href="/tags/mysql/" style="font-size: 12.5px;">mysql</a> <a href="/tags/node/" style="font-size: 18.75px;">node</a> <a href="/tags/other/" style="font-size: 16.25px;">other</a> <a href="/tags/react/" style="font-size: 17.5px;">react</a> <a href="/tags/webpack/" style="font-size: 12.5px;">webpack</a> <a href="/tags/%E6%8F%92%E4%BB%B6/" style="font-size: 10px;">插件</a> <a href="/tags/%E6%B5%8F%E8%A7%88%E5%99%A8/" style="font-size: 10px;">浏览器</a> <a href="/tags/solution/" style="font-size: 13.75px;">算法</a> <a href="/tags/network/" style="font-size: 15px;">计算机网络</a> <a href="/tags/read-book/" style="font-size: 10px;">读书</a> <a href="/tags/source/" style="font-size: 12.5px;">资源</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/09/">九月 2024</a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/07/">七月 2024</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/03/">三月 2024</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/10/">十月 2023</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/11/">十一月 2022</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/08/">八月 2022</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/05/">五月 2022</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/01/">一月 2022</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/12/">十二月 2021</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/10/">十月 2021</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/08/">八月 2021</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/07/">七月 2021</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/06/">六月 2021</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/05/">五月 2021</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/04/">四月 2021</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/03/">三月 2021</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/02/">二月 2021</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/01/">一月 2021</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/12/">十二月 2020</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/11/">十一月 2020</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/10/">十月 2020</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/09/">九月 2020</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/08/">八月 2020</a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/07/">七月 2020</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/06/">六月 2020</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/05/">五月 2020</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/04/">四月 2020</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/08/">八月 2019</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/07/">七月 2019</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/05/">五月 2019</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/09/">九月 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/08/">八月 2018</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/07/">七月 2018</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/04/">四月 2018</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/03/">三月 2018</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/09/">九月 2017</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/03/">三月 2017</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/11/">十一月 2016</a><span class="archive-list-count">4</span></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2024/09/25/%E6%AD%A3%E5%88%99/">正则</a>
          </li>
        
          <li>
            <a href="/2024/09/25/AI/">AI</a>
          </li>
        
          <li>
            <a href="/2024/09/24/zustand/">zustand</a>
          </li>
        
          <li>
            <a href="/2024/09/22/typescript%E8%87%AA%E5%AE%9A%E4%B9%89%E5%AE%9E%E7%8E%B0/">typescript自定义实现</a>
          </li>
        
          <li>
            <a href="/2024/09/21/%E4%B8%9A%E5%8A%A1-%E5%A4%A7%E7%89%8C%E8%AF%95%E7%94%A8/">业务-大牌试用</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2024 奔跑的蜗牛<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">首页</a>
  
    <a href="/archives" class="mobile-nav-link">分类</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  
<link rel="stylesheet" href="/fancybox/jquery.fancybox.css">

  
<script src="/fancybox/jquery.fancybox.pack.js"></script>




<script src="/js/script.js"></script>


  </div>
</body>
</html>